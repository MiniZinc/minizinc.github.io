var MiniZinc=function(t){"use strict";let e=new URL("./minizinc-worker.js",document.currentScript.src);const n=[];return t.Model=class{constructor(){this.vfs={},this.toRun=[],this.unnamedCount=0}addString(t){let e=`_mzn_${this.unnamedCount++}.mzn`;for(;e in this.vfs;)e=`_mzn_${this.unnamedCount++}.mzn`;return this.addFile(e,t),e}addDznString(t){let e=`_dzn_${this.unnamedCount++}.dzn`;for(;e in this.vfs;)e=`_dzn_${this.unnamedCount++}.dzn`;return this.addFile(e,t),e}addJson(t){let e=`_json_${this.unnamedCount++}.json`;for(;e in this.vfs;)e=`_json_${this.unnamedCount++}.json`;return this.addFile(e,JSON.stringify(t)),e}addFile(t,e,n=!0){this.vfs[t]=e,n&&(t.endsWith(".mzn")||t.endsWith(".mzc")||t.endsWith(".dzn")||t.endsWith(".json")||t.endsWith(".mpc")||t.endsWith(".fzn"))&&-1===this.toRun.indexOf(t)&&this.toRun.push(t)}_run(t,s,r=null){let o=`_mzn_${this.unnamedCount++}.mpc`;for(;o in this.vfs;)o=`_mzn_${this.unnamedCount++}.mpc`;const i={...this.vfs,[o]:JSON.stringify(s)};for(;n.length<2;)n.push({worker:new Worker(e),runCount:0});let{worker:a,runCount:u}=n.pop();return a.postMessage({jsonStream:!0,files:i,args:[o,...t,...this.toRun],outputFiles:r}),{worker:a,runCount:u+1}}check(t){return new Promise(((s,r)=>{const{worker:o,runCount:i}=this._run(["--model-check-only"],t),a=[];o.onmessage=t=>{switch(t.data.type){case"error":a.push(t.data);break;case"exit":i<10?n.push({worker:o,runCount:i}):(o.terminate(),n.push({worker:new Worker(e),runCount:0})),s(a)}}}))}interface(t){return new Promise(((s,r)=>{const{worker:o,runCount:i}=this._run(["-c","--model-interface-only"],t),a=[];let u=null;o.onmessage=t=>{switch(t.data.type){case"error":a.push(t.data);break;case"interface":u=t.data;break;case"exit":i<10?n.push({worker:o,runCount:i}):(o.terminate(),n.push({worker:new Worker(e),runCount:0})),0===t.data.code?s(u):r(a)}}}))}compile(t){let s=0,r=`_fzn_${s++}.fzn`;for(;r in this.vfs;)r=`_fzn_${s++}.fzn`;const o=["-c","--fzn",r],{worker:i}=this._run(o,t,[r]);n.push({worker:new Worker(e),runCount:0});let a={},u=!1,d={};return i.onmessage=t=>{if(a[t.data.type])for(const e of a[t.data.type])e(t.data);switch(t.data.type){case"exit":u=!0,a={};break;case"statistics":d={...d,...t.data.statistics}}},{cancel(){if(!u){if(u=!0,i.terminate(),a.exit)for(const t of a.exit)t({statistics:d});a={}}},on(t,e){a[t]?a[t].add(e):a[t]=new Set([e])},off(t,e){a[t]&&a[t].delete(e)},then(t,e){const n=n=>{0===n.code?t(n.outputFiles[r]):e(n)};a.exit?a.exit.add(n):a.exit=new Set([n])}}}solve(t,s=!0){const r=["-i"];s&&(r.push("--output-mode"),r.push("json"));const{worker:o}=this._run(r,t);n.push({worker:new Worker(e),runCount:0});let i={},a=!1,u=null,d={},c="UNKNOWN";return o.onmessage=t=>{if(i[t.data.type])for(const e of i[t.data.type])e(t.data);switch(t.data.type){case"exit":o.terminate(),a=!0,i={};break;case"statistics":d={...d,...t.data.statistics};break;case"solution":u=t.data,c="SATISFIED";break;case"status":c=t.data.status}},{cancel(){if(!a){if(a=!0,o.terminate(),i.exit)for(const t of i.exit)t({status:c,solution:u,statistics:d});i={}}},on(t,e){i[t]?i[t].add(e):i[t]=new Set([e])},off(t,e){i[t]&&i[t].delete(e)},then(t,e){const n=n=>{0===n.code?t({status:c,solution:u,statistics:d}):e(n)};i.exit?i.exit.add(n):i.exit=new Set([n])}}}},t.init=function(t){if(t&&(e=t),n.length>0)throw new Error("MiniZinc.init() called after library already used/initialised");for(;n.length<2;)n.push({worker:new Worker(e),runCount:0})},t.version=function(){return new Promise(((t,s)=>{for(;n.length<2;)n.push({worker:new Worker(e),runCount:0});let{worker:r,runCount:o}=n.pop();r.postMessage({jsonStream:!1,args:["--version"]}),r.onmessage=e=>{"exit"===e.data.type&&(0===e.data.code?t(e.data.stdout):s(e.data))}}))},t}({});
