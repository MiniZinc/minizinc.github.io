<!DOCTYPE html>
<html>
<head>
    <title>Interactive Vehicle Routing</title>
    <script type="text/javascript" src="d3.min.js"></script>
    <script type="text/javascript" src="jquery.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="bootstrap.min.js"></script>

    <link rel="stylesheet" href="css/bootstrap-toggle.min.css">
    <script src="bootstrap-toggle.min.js"></script>

    <script type="text/javascript">

    var roWindow;

    function openRoView() {
        roWindow = window.open(window.location.href.substr(0, window.location.href.indexOf('#'))+"?ro","","fullscreen,location=off");
        if (roWindow && instance) {
            roWindow.postMessage({'updateInstance':instance}, "*");            
        }
    }

    var parseQueryString = function() {

        var str = window.location.search;
        var objURL = {};

        str.replace(
            new RegExp( "([^?=&]+)(=([^&]*))?", "g" ),
            function( $0, $1, $2, $3 ){
                objURL[ $1 ] = $3;
            }
        );
        return objURL;
    };
    
    var isReadonlyView = "ro" in parseQueryString();
    
    var nVehiclesPerRow = isReadonlyView ? 3 : 2;
    
    // console.log("readonly? "+isReadonlyView);

    $(document).ready(function(){
        if (isReadonlyView) {
            $("#editor-separator").remove();
            $("#editor").remove();
            $("#solver-controls").remove();
            $("#days").removeClass("col-md-4");
            $("#days").addClass("col-md-9");
            window.addEventListener("message", receiveMessage, false);
        } else {
            about();
        }
    });

    var margin = {top: 20, right: 40, bottom: 30, left: 40};
    var windowWidth = 500+margin.left+margin.right;
    var windowHeight = 500+margin.top+margin.bottom;

    var solutions;
    var objValues;

    var colors = [
    'steelblue',
    'orange',
    'red',
    'green',
    'yellow',
    'black']

    colors = [
      '#e41a1c',
      '#377eb8',
      '#4daf4a',
      '#984ea3',
      '#ff7f00',
      '#a65628'
      ]

    var status = "waiting";

    var updatingInProgress = false;

    function defaultInstance() {
        var inst = {
            'Name': "pr02.txt",
            'NumVehicles': 6,
            'NumDays': 4,
            'locX': [33.588,48.828,86.176,39.270,-23.370,48.132,-16.357,-57.703,7.147,42.950,37.085,77.759,-17.462,58.575,57.776,-22.327,-7.080,55.658,-14.307,-29.724,43.219,45.184,64.484,55.078,16.925,45.038,-76.782,36.169,29.218,65.057,42.175,25.574,31.561,66.498,46.576,65.063,-2.716,-40.002,-73.505,81.146,12.006,42.761,3.857,-7.367,35.944,52.075,30.725,41.223,68.884,76.312,63.934,29.150,85.522,31.775,-20.544,55.353,35.406,25.464,12.396,18.359,27.960,-3.192,9.332,-20.581,27.820,59.027,56.311,-51.654,2.576,15.131,66.595,19.476,-1.172,-21.204,98.846,82.593,30.017,33.228,39.490,54.498,3.058,51.831,76.416,5.243,50.592,-5.231,24.194,33.630,31.445,30.707,49.860,-35.767,-29.309,19.049,27.600,30.219],
            'locY' : [30.750,65.314,59.344,-33.057,86.853,95.593,93.311,-65.601,32.684,68.701,-2.112,55.817,-56.567,59.888,15.344,36.072,30.493,60.425,11.456,24.268,0.739,35.474,2.240,72.241,15.741,-3.723,5.939,0.256,8.936,5.225,-22.284,31.726,37.262,-54.169,-17.938,40.875,24.768,3.870,57.043,-25.714,-7.965,38.092,-23.181,24.390,-11.835,9.692,30.701,77.924,-40.546,86.670,78.540,-9.961,39.954,3.870,19.086,43.817,10.278,-0.287,0.244,20.917,-15.039,19.879,-41.351,38.177,28.729,42.310,58.734,-0.342,32.721,-3.046,34.937,20.142,20.648,13.660,1.257,72.003,-30.896,41.663,-8.539,70.813,10.248,-16.870,11.346,0.238,34.247,-2.081,25.836,37.585,-7.001,-28.168,1.038,14.142,4.889,41.974,13.934,24.786],
            'Demand' : [4,12,3,15,13,20,21,4,25,21,7,3,9,5,20,21,19,2,16,18,24,24,8,16,19,12,9,3,15,4,24,22,14,11,20,5,11,12,7,1,23,13,4,23,17,13,9,10,22,21,13,25,8,20,3,4,13,18,1,10,16,9,13,23,14,5,1,6,20,10,19,24,3,5,13,5,4,12,11,20,13,1,3,2,23,8,25,18,4,5,21,23,19,2,21],
            'Capacity' : [195,195,195,195,195,195],
            'VisitDays' : [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            'Patterns' : [{'set':[1,2,3,4]},{'set':[1,3]},{'set':[2,4]},{'set':[1]},{'set':[2]},{'set':[3]},{'set':[4]}],
            'CustomerPatterns' : [{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]}]
        };
        return inst;
    }
    function smallInstance() {
        var inst = {
            'Name': "pr02.txt",
            'NumVehicles': 3,
            'NumDays': 4,
            'locX': [-29.730,-30.664,51.642,-13.171,-67.413,48.907,5.243,-65.002,-4.175,23.029,25.482,-42.615,-76.672,-20.673,-52.039,-41.376,-91.943,-65.118,18.597,-40.942,-37.756,23.767,-43.030,-35.297,-54.755,-49.329,57.404,-22.754,-56.622,-38.562,-16.779,-11.560,-46.545,16.229,1.294,-26.404,4.352,-50.665,-22.833,-71.100,-7.849,11.877,-18.927,-11.920,29.840,12.268,-37.933,-10.442],
            'locY' : [64.136,5.463,5.469,69.336,68.323,6.274,22.260,77.234,-1.569,11.639,6.287,-26.392,99.341,57.892,6.567,50.824,27.588,30.212,96.716,83.209,-33.325,29.083,20.453,-24.896,14.368,33.374,23.822,55.408,73.340,-3.705,19.537,11.615,97.974,9.320,7.349,29.529,14.685,-23.126,-9.814,-18.616,32.074,-24.933,-23.730,11.755,11.633,-55.811,-21.613,19.999],
            'Demand' : [12,8,16,5,12,5,13,20,13,18,7,6,9,9,4,25,5,17,3,16,25,21,14,19,14,6,16,9,20,13,10,16,19,22,14,10,11,15,13,15,8,22,24,3,25,19,21],
            'Capacity' : [200,200,200],
            'VisitDays' : [4,4,4,4,4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            'Patterns' : [{'set':[1,2,3,4]},{'set':[1,3]},{'set':[2,4]},{'set':[1]},{'set':[2]},{'set':[3]},{'set':[4]}],
            'CustomerPatterns' : [{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [1]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [2,3]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]},{"set" : [4,5,6,7]}]
        };
        return inst;
    }

    function defaultSolution() {
        var inst = {
            'Name': "pr02.txt",
            'NumVehicles': 6,
            'NumDays': 4,
            'locX': [33.588,48.828,86.176,39.270,-23.370,48.132,-16.357,-57.703,7.147,42.950,37.085,77.759,-17.462,58.575,57.776,-22.327,-7.080,55.658,-14.307,-29.724,43.219,45.184,64.484,55.078,16.925,45.038,-76.782,36.169,29.218,65.057,42.175,25.574,31.561,66.498,46.576,65.063,-2.716,-40.002,-73.505,81.146,12.006,42.761,3.857,-7.367,35.944,52.075,30.725,41.223,68.884,76.312,63.934,29.150,85.522,31.775,-20.544,55.353,35.406,25.464,12.396,18.359,27.960,-3.192,9.332,-20.581,27.820,59.027,56.311,-51.654,2.576,15.131,66.595,19.476,-1.172,-21.204,98.846,82.593,30.017,33.228,39.490,54.498,3.058,51.831,76.416,5.243,50.592,-5.231,24.194,33.630,31.445,30.707,49.860,-35.767,-29.309,19.049,27.600,30.219],
            'locY' : [30.750,65.314,59.344,-33.057,86.853,95.593,93.311,-65.601,32.684,68.701,-2.112,55.817,-56.567,59.888,15.344,36.072,30.493,60.425,11.456,24.268,0.739,35.474,2.240,72.241,15.741,-3.723,5.939,0.256,8.936,5.225,-22.284,31.726,37.262,-54.169,-17.938,40.875,24.768,3.870,57.043,-25.714,-7.965,38.092,-23.181,24.390,-11.835,9.692,30.701,77.924,-40.546,86.670,78.540,-9.961,39.954,3.870,19.086,43.817,10.278,-0.287,0.244,20.917,-15.039,19.879,-41.351,38.177,28.729,42.310,58.734,-0.342,32.721,-3.046,34.937,20.142,20.648,13.660,1.257,72.003,-30.896,41.663,-8.539,70.813,10.248,-16.870,11.346,0.238,34.247,-2.081,25.836,37.585,-7.001,-28.168,1.038,14.142,4.889,41.974,13.934,24.786],
            'Demand' : [4,12,3,15,13,20,21,4,25,21,7,3,9,5,20,21,19,2,16,18,24,24,8,16,19,12,9,3,15,4,24,22,14,11,20,5,11,12,7,1,23,13,4,23,17,13,9,10,22,21,13,25,8,20,3,4,13,18,1,10,16,9,13,23,14,5,1,6,20,10,19,24,3,5,13,5,4,12,11,20,13,1,3,2,23,8,25,18,4,5,21,23,19,2,21],
            'Capacity' : [195,195,195,195,195,195],
            'VisitDays' : [4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            'Patterns' : [{'set':[1,2,3,4]},{'set':[1,3]},{'set':[2,4]},{'set':[1]},{'set':[2]},{'set':[3]},{'set':[4]}],
            'CustomerPatterns' : [{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]},{'set':[4,5,6,7]}]
        };
        inst['sol'] = 
        {"obj":12510818,"nodedata":[{"nodes":[{"id":0,"succ":[]}],"x":30.219,"y":24.786},{"nodes":[{"day":1,"id":1,"succ":5},{"day":2,"id":2,"succ":6},{"day":3,"id":3,"succ":7},{"day":4,"id":4,"succ":8}],"x":33.588,"y":30.75},{"nodes":[{"day":1,"id":5,"succ":9},{"day":2,"id":6,"succ":10},{"day":3,"id":7,"succ":15},{"day":4,"id":8,"succ":12}],"x":48.828,"y":65.314},{"nodes":[{"day":1,"id":9,"succ":13},{"day":2,"id":10,"succ":14},{"day":3,"id":11,"succ":3},{"day":4,"id":12,"succ":16}],"x":86.176,"y":59.344},{"nodes":[{"day":1,"id":13,"succ":17},{"day":2,"id":14,"succ":18},{"day":3,"id":15,"succ":19},{"day":4,"id":16,"succ":20}],"x":39.27,"y":-33.057},{"nodes":[{"day":1,"id":17,"succ":21},{"day":2,"id":18,"succ":22},{"day":3,"id":19,"succ":23},{"day":4,"id":20,"succ":24}],"x":-23.37,"y":86.853},{"nodes":[{"day":1,"id":21,"succ":25},{"day":2,"id":22,"succ":26},{"day":3,"id":23,"succ":27},{"day":4,"id":24,"succ":28}],"x":48.132,"y":95.593},{"nodes":[{"day":1,"id":25,"succ":29},{"day":2,"id":26,"succ":30},{"day":3,"id":27,"succ":31},{"day":4,"id":28,"succ":32}],"x":-16.357,"y":93.311},{"nodes":[{"day":1,"id":29,"succ":33},{"day":2,"id":30,"succ":34},{"day":3,"id":31,"succ":35},{"day":4,"id":32,"succ":36}],"x":-57.703,"y":-65.601},{"nodes":[{"day":1,"id":33,"succ":37},{"day":2,"id":34,"succ":38},{"day":3,"id":35,"succ":39},{"day":4,"id":36,"succ":40}],"x":7.147,"y":32.684},{"nodes":[{"day":1,"id":37,"succ":41},{"day":2,"id":38,"succ":42},{"day":3,"id":39,"succ":43},{"day":4,"id":40,"succ":44}],"x":42.95,"y":68.701},{"nodes":[{"day":1,"id":41,"succ":45},{"day":2,"id":42,"succ":46},{"day":3,"id":43,"succ":47},{"day":4,"id":44,"succ":48}],"x":37.085,"y":-2.112},{"nodes":[{"day":1,"id":45,"succ":49},{"day":2,"id":46,"succ":50},{"day":3,"id":47,"succ":51},{"day":4,"id":48,"succ":52}],"x":77.759,"y":55.817},{"nodes":[{"day":1,"id":49,"succ":53},{"day":2,"id":50,"succ":54},{"day":3,"id":51,"succ":55},{"day":4,"id":52,"succ":56}],"x":-17.462,"y":-56.567},{"nodes":[{"day":1,"id":53,"succ":57},{"day":2,"id":54,"succ":58},{"day":3,"id":55,"succ":59},{"day":4,"id":56,"succ":60}],"x":58.575,"y":59.888},{"nodes":[{"day":1,"id":57,"succ":69},{"day":2,"id":58,"succ":70},{"day":3,"id":59,"succ":71},{"day":4,"id":60,"succ":72}],"x":57.776,"y":15.344},{"nodes":[{"day":1,"id":61,"succ":65},{"day":2,"id":62,"succ":66},{"day":3,"id":63,"succ":67},{"day":4,"id":64,"succ":68}],"x":-22.327,"y":36.072},{"nodes":[{"day":1,"id":65,"succ":73},{"day":2,"id":66,"succ":94},{"day":3,"id":67,"succ":75},{"day":4,"id":68,"succ":96}],"x":-7.08,"y":30.493},{"nodes":[{"day":1,"id":69,"succ":89},{"day":2,"id":70,"succ":90},{"day":3,"id":71,"succ":91},{"day":4,"id":72,"succ":92}],"x":55.658,"y":60.425},{"nodes":[{"day":1,"id":73,"succ":77},{"day":2,"id":74,"succ":78},{"day":3,"id":75,"succ":79},{"day":4,"id":76,"succ":80}],"x":-14.307,"y":11.456},{"nodes":[{"day":1,"id":77,"succ":81},{"day":2,"id":78,"succ":62},{"day":3,"id":79,"succ":83},{"day":4,"id":80,"succ":64}],"x":-29.724,"y":24.268},{"nodes":[{"day":1,"id":81,"succ":85},{"day":2,"id":82,"succ":74},{"day":3,"id":83,"succ":87},{"day":4,"id":84,"succ":76}],"x":43.219,"y":0.739},{"nodes":[{"day":1,"id":85,"succ":93},{"day":2,"id":86,"succ":0},{"day":3,"id":87,"succ":95},{"day":4,"id":88,"succ":0}],"x":45.184,"y":35.474},{"nodes":[{"day":1,"id":89,"succ":103},{"day":2,"id":90,"succ":127},{"day":3,"id":91,"succ":104},{"day":4,"id":92,"succ":128}],"x":64.484,"y":2.24},{"nodes":[{"day":1,"id":93,"succ":97},{"day":2,"id":94,"succ":86},{"day":3,"id":95,"succ":98},{"day":4,"id":96,"succ":88}],"x":55.078,"y":72.241},{"nodes":[{"day":1,"id":97,"succ":99},{"day":3,"id":98,"succ":100}],"x":16.925,"y":15.741},{"nodes":[{"day":1,"id":99,"succ":101},{"day":3,"id":100,"succ":102}],"x":45.038,"y":-3.723},{"nodes":[{"day":1,"id":101,"succ":105},{"day":3,"id":102,"succ":106}],"x":-76.782,"y":5.939},{"nodes":[{"day":1,"id":103,"succ":0},{"day":3,"id":104,"succ":0}],"x":36.169,"y":0.256},{"nodes":[{"day":1,"id":105,"succ":180},{"day":3,"id":106,"succ":190}],"x":29.218,"y":8.936},{"nodes":[{"day":1,"id":107,"succ":109},{"day":3,"id":108,"succ":110}],"x":65.057,"y":5.225},{"nodes":[{"day":1,"id":109,"succ":113},{"day":3,"id":110,"succ":112}],"x":42.175,"y":-22.284},{"nodes":[{"day":1,"id":111,"succ":107},{"day":3,"id":112,"succ":114}],"x":25.574,"y":31.726},{"nodes":[{"day":1,"id":113,"succ":115},{"day":3,"id":114,"succ":116}],"x":31.561,"y":37.262},{"nodes":[{"day":1,"id":115,"succ":117},{"day":3,"id":116,"succ":118}],"x":66.498,"y":-54.169},{"nodes":[{"day":1,"id":117,"succ":119},{"day":3,"id":118,"succ":120}],"x":46.576,"y":-17.938},{"nodes":[{"day":1,"id":119,"succ":121},{"day":3,"id":120,"succ":122}],"x":65.063,"y":40.875},{"nodes":[{"day":1,"id":121,"succ":123},{"day":3,"id":122,"succ":124}],"x":-2.716,"y":24.768},{"nodes":[{"day":1,"id":123,"succ":125},{"day":3,"id":124,"succ":126}],"x":-40.002,"y":3.87},{"nodes":[{"day":1,"id":125,"succ":129},{"day":3,"id":126,"succ":130}],"x":-73.505,"y":57.043},{"nodes":[{"day":2,"id":127,"succ":155},{"day":4,"id":128,"succ":178}],"x":81.146,"y":-25.714},{"nodes":[{"day":1,"id":129,"succ":131},{"day":3,"id":130,"succ":132}],"x":12.006,"y":-7.965},{"nodes":[{"day":1,"id":131,"succ":133},{"day":3,"id":132,"succ":134}],"x":42.761,"y":38.092},{"nodes":[{"day":1,"id":133,"succ":135},{"day":3,"id":134,"succ":136}],"x":3.857,"y":-23.181},{"nodes":[{"day":1,"id":135,"succ":0},{"day":3,"id":136,"succ":0}],"x":-7.367,"y":24.39},{"nodes":[{"day":2,"id":137,"succ":139},{"day":4,"id":138,"succ":140}],"x":35.944,"y":-11.835},{"nodes":[{"day":2,"id":139,"succ":143},{"day":4,"id":140,"succ":142}],"x":52.075,"y":9.692},{"nodes":[{"day":2,"id":141,"succ":0},{"day":4,"id":142,"succ":144}],"x":30.725,"y":30.701},{"nodes":[{"day":2,"id":143,"succ":141},{"day":4,"id":144,"succ":145}],"x":41.223,"y":77.924},{"nodes":[{"day":4,"id":145,"succ":146}],"x":68.884,"y":-40.546},{"nodes":[{"day":4,"id":146,"succ":147}],"x":76.312,"y":86.67},{"nodes":[{"day":4,"id":147,"succ":148}],"x":63.934,"y":78.54},{"nodes":[{"day":4,"id":148,"succ":149}],"x":29.15,"y":-9.961},{"nodes":[{"day":4,"id":149,"succ":150}],"x":85.522,"y":39.954},{"nodes":[{"day":4,"id":150,"succ":151}],"x":31.775,"y":3.87},{"nodes":[{"day":4,"id":151,"succ":152}],"x":-20.544,"y":19.086},{"nodes":[{"day":4,"id":152,"succ":153}],"x":55.353,"y":43.817},{"nodes":[{"day":4,"id":153,"succ":156}],"x":35.406,"y":10.278},{"nodes":[{"day":1,"id":154,"succ":157}],"x":25.464,"y":-0.287},{"nodes":[{"day":2,"id":155,"succ":163}],"x":12.396,"y":0.244},{"nodes":[{"day":4,"id":156,"succ":162}],"x":18.359,"y":20.917},{"nodes":[{"day":1,"id":157,"succ":158}],"x":27.96,"y":-15.039},{"nodes":[{"day":1,"id":158,"succ":159}],"x":-3.192,"y":19.879},{"nodes":[{"day":1,"id":159,"succ":160}],"x":9.332,"y":-41.351},{"nodes":[{"day":1,"id":160,"succ":161}],"x":-20.581,"y":38.177},{"nodes":[{"day":1,"id":161,"succ":164}],"x":27.82,"y":28.729},{"nodes":[{"day":4,"id":162,"succ":0}],"x":59.027,"y":42.31},{"nodes":[{"day":2,"id":163,"succ":0}],"x":56.311,"y":58.734},{"nodes":[{"day":1,"id":164,"succ":165}],"x":-51.654,"y":-0.342},{"nodes":[{"day":1,"id":165,"succ":166}],"x":2.576,"y":32.721},{"nodes":[{"day":1,"id":166,"succ":167}],"x":15.131,"y":-3.046},{"nodes":[{"day":1,"id":167,"succ":168}],"x":66.595,"y":34.937},{"nodes":[{"day":1,"id":168,"succ":169}],"x":19.476,"y":20.142},{"nodes":[{"day":1,"id":169,"succ":170}],"x":-1.172,"y":20.648},{"nodes":[{"day":1,"id":170,"succ":171}],"x":-21.204,"y":13.66},{"nodes":[{"day":1,"id":171,"succ":0}],"x":98.846,"y":1.257},{"nodes":[{"day":2,"id":172,"succ":173}],"x":82.593,"y":72.003},{"nodes":[{"day":2,"id":173,"succ":174}],"x":30.017,"y":-30.896},{"nodes":[{"day":2,"id":174,"succ":175}],"x":33.228,"y":41.663},{"nodes":[{"day":2,"id":175,"succ":176}],"x":39.49,"y":-8.539},{"nodes":[{"day":2,"id":176,"succ":177}],"x":54.498,"y":70.813},{"nodes":[{"day":2,"id":177,"succ":179}],"x":3.058,"y":10.248},{"nodes":[{"day":4,"id":178,"succ":0}],"x":51.831,"y":-16.87},{"nodes":[{"day":2,"id":179,"succ":181}],"x":76.416,"y":11.346},{"nodes":[{"day":1,"id":180,"succ":0}],"x":5.243,"y":0.238},{"nodes":[{"day":2,"id":181,"succ":182}],"x":50.592,"y":34.247},{"nodes":[{"day":2,"id":182,"succ":183}],"x":-5.231,"y":-2.081},{"nodes":[{"day":2,"id":183,"succ":184}],"x":24.194,"y":25.836},{"nodes":[{"day":2,"id":184,"succ":185}],"x":33.63,"y":37.585},{"nodes":[{"day":2,"id":185,"succ":186}],"x":31.445,"y":-7.001},{"nodes":[{"day":2,"id":186,"succ":187}],"x":30.707,"y":-28.168},{"nodes":[{"day":2,"id":187,"succ":188}],"x":49.86,"y":1.038},{"nodes":[{"day":2,"id":188,"succ":0}],"x":-35.767,"y":14.142},{"nodes":[{"day":3,"id":189,"succ":191}],"x":-29.309,"y":4.889},{"nodes":[{"day":3,"id":190,"succ":0}],"x":19.049,"y":41.974},{"nodes":[{"day":3,"id":191,"succ":0}],"x":27.6,"y":13.934}],"routeOf":[1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,5,6,7,8,5,6,7,8,1,2,3,4,5,6,7,8,5,6,7,8,5,6,7,8,5,6,7,8,1,2,3,4,5,6,7,8,5,7,5,7,5,7,1,3,5,7,21,23,21,23,21,23,21,23,21,23,21,23,21,23,21,23,21,23,21,23,2,4,21,23,21,23,21,23,21,23,22,24,22,24,22,24,22,24,24,24,24,24,24,24,24,24,24,9,2,24,9,9,9,9,9,24,2,9,9,9,9,9,9,9,9,10,10,10,10,10,10,4,10,5,10,10,10,10,10,10,10,10,11,7,11,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"dayOf":[1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,1,3,2,4,1,3,1,3,1,3,1,3,2,4,2,4,2,4,2,4,4,4,4,4,4,4,4,4,4,1,2,4,1,1,1,1,1,4,2,1,1,1,1,1,1,1,1,2,2,2,2,2,2,4,2,1,2,2,2,2,2,2,2,2,3,3,3,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4],"succ":[5,6,7,8,9,10,15,12,13,14,3,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,69,70,71,72,65,66,67,68,73,94,75,96,89,90,91,92,77,78,79,80,81,62,83,64,85,74,87,76,93,221,95,223,103,127,104,128,97,86,98,88,99,100,101,102,105,106,216,218,180,190,109,110,113,112,107,114,115,116,117,118,119,120,121,122,123,124,125,126,129,130,155,178,131,132,133,134,135,136,236,238,139,140,143,142,237,144,141,145,146,147,148,149,150,151,152,153,156,157,163,162,158,159,160,161,164,239,217,165,166,167,168,169,170,171,224,173,174,175,176,177,179,219,181,220,182,183,184,185,186,187,188,225,191,222,226,1,2,11,4,61,82,63,84,154,172,189,227,228,229,230,231,232,233,234,235,111,137,108,138,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,192],"NumDays":4};
        return inst;
    }

    function bigInstance() {
    var inst =
    {'Name': "pr07.txt",
'NumVehicles': 5,
'NumDays': 6,
'locX': [-92.700,71.179,31.537,-4.694,-30.194,12.677,-32.355,19.910,13.202,54.877,15.063,-50.598,-29.730,17.542,11.127,33.752,-56.012,57.874,10.718,53.088,1.569,31.531,-66.833,-70.740,32.538,-51.453,36.456,-31.207,-10.388,14.722,47.095,43.781,53.546,26.801,63.385,47.192,-16.315,78.900,79.822,12.878,-67.981,9.198,-35.950,28.766,11.469,-22.760,-65.674,7.239,-29.785,-89.050,-46.887,-14.972,-17.035,31.635,-3.577,33.008,-92.950,-9.137,-39.960,28.430,-28.540,31.415,-49.426,-72.827,60.083,10.870,25.122,-46.997,16.058,25.409,68.323,10.629],
'locY': [-59.180,12.543,66.638,25.537,67.773,-57.471,-20.966,48.975,-19.135,-41.168,-25.171,-16.418,17.078,1.575,77.216,71.259,-10.394,-16.290,-18.787,-18.750,7.532,48.944,-37.854,62.244,23.096,-36.444,-22.638,43.494,34.491,-10.834,-21.387,34.766,-67.487,46.515,11.981,-5.475,-11.267,17.651,22.272,16.919,-3.754,-18.597,-19.141,45.276,68.231,45.496,-23.120,1.599,-11.285,16.211,-3.363,30.621,49.774,53.619,13.342,58.960,63.263,-22.931,6.195,-19.214,-3.485,36.859,60.602,-27.765,-45.905,-3.900,7.672,-17.474,33.020,-11.700,-5.145,9.326],
'Demand': [20,6,19,10,18,1,15,23,13,12,7,25,5,1,25,10,2,7,11,4,6,15,7,8,10,9,4,6,22,17,9,25,10,18,21,10,23,23,11,1,23,16,10,12,12,3,22,21,13,15,13,20,10,25,7,15,2,23,5,25,9,2,24,13,20,13,15,4,20,8,19],
'Capacity': [200,200,200,200,200],
'VisitDays': [6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
'Patterns': [{'set':[1,2,3,4,5,6]},{'set':[1,3,5]},{'set':[2,4,6]},{'set':[1,4]},{'set':[2,5]},{'set':[3,6]},{'set':[1]},{'set':[2]},{'set':[3]},{'set':[4]},{'set':[5]},{'set':[6]}],
'CustomerPatterns': [{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[1]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[2,3]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[4,5,6]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]},{'set':[7,8,9,10,11,12]}]
    };
    return inst;
    }

    function bigSolution() {
    var inst = bigInstance();
    inst.sol =
    {"obj":5762762,"nodedata":[{"nodes":[{"id":0,"succ":[]}],"x":10.629,"y":9.326,"demand":0},{"nodes":[{"day":1,"id":1,"succ":130},{"day":2,"id":2,"succ":98},{"day":3,"id":3,"succ":122},{"day":4,"id":4,"succ":34},{"day":5,"id":5,"succ":132},{"day":6,"id":6,"succ":184}],"x":-92.7,"y":-59.18,"demand":20},{"nodes":[{"day":1,"id":7,"succ":103},{"day":2,"id":8,"succ":165},{"day":3,"id":9,"succ":105},{"day":4,"id":10,"succ":158},{"day":5,"id":11,"succ":209},{"day":6,"id":12,"succ":159}],"x":71.179,"y":12.543,"demand":6},{"nodes":[{"day":1,"id":13,"succ":118},{"day":2,"id":14,"succ":177},{"day":3,"id":15,"succ":93},{"day":4,"id":16,"succ":94},{"day":5,"id":17,"succ":95},{"day":6,"id":18,"succ":198}],"x":31.537,"y":66.638,"demand":19},{"nodes":[{"day":1,"id":19,"succ":43},{"day":2,"id":20,"succ":74},{"day":3,"id":21,"succ":0},{"day":4,"id":22,"succ":0},{"day":5,"id":23,"succ":0},{"day":6,"id":24,"succ":196}],"x":-4.694,"y":25.537,"demand":10},{"nodes":[{"day":1,"id":25,"succ":124},{"day":2,"id":26,"succ":201},{"day":3,"id":27,"succ":125},{"day":4,"id":28,"succ":22},{"day":5,"id":29,"succ":207},{"day":6,"id":30,"succ":90}],"x":-30.194,"y":67.773,"demand":18},{"nodes":[{"day":1,"id":31,"succ":61},{"day":2,"id":32,"succ":56},{"day":3,"id":33,"succ":143},{"day":4,"id":34,"succ":58},{"day":5,"id":35,"succ":65},{"day":6,"id":36,"succ":42}],"x":12.677,"y":-57.471,"demand":1},{"nodes":[{"day":1,"id":37,"succ":115},{"day":2,"id":38,"succ":187},{"day":3,"id":39,"succ":63},{"day":4,"id":40,"succ":76},{"day":5,"id":41,"succ":35},{"day":6,"id":42,"succ":72}],"x":-32.355,"y":-20.966,"demand":15},{"nodes":[{"day":1,"id":43,"succ":85},{"day":2,"id":44,"succ":179},{"day":3,"id":45,"succ":119},{"day":4,"id":46,"succ":16},{"day":5,"id":47,"succ":178},{"day":6,"id":48,"succ":0}],"x":19.91,"y":48.975,"demand":23},{"nodes":[{"day":1,"id":49,"succ":109},{"day":2,"id":50,"succ":62},{"day":3,"id":51,"succ":110},{"day":4,"id":52,"succ":64},{"day":5,"id":53,"succ":111},{"day":6,"id":54,"succ":66}],"x":13.202,"y":-19.135,"demand":13},{"nodes":[{"day":1,"id":55,"succ":151},{"day":2,"id":56,"succ":104},{"day":3,"id":57,"succ":152},{"day":4,"id":58,"succ":204},{"day":5,"id":59,"succ":107},{"day":6,"id":60,"succ":36}],"x":54.877,"y":-41.168,"demand":12},{"nodes":[{"day":1,"id":61,"succ":49},{"day":2,"id":62,"succ":32},{"day":3,"id":63,"succ":51},{"day":4,"id":64,"succ":202},{"day":5,"id":65,"succ":53},{"day":6,"id":66,"succ":108}],"x":15.063,"y":-25.171,"demand":7},{"nodes":[{"day":1,"id":67,"succ":121},{"day":2,"id":68,"succ":175},{"day":3,"id":69,"succ":99},{"day":4,"id":70,"succ":212},{"day":5,"id":71,"succ":188},{"day":6,"id":72,"succ":6}],"x":-50.598,"y":-16.418,"demand":25},{"nodes":[{"day":1,"id":73,"succ":97},{"day":2,"id":74,"succ":181},{"day":3,"id":75,"succ":191},{"day":4,"id":76,"succ":203},{"day":5,"id":77,"succ":141},{"day":6,"id":78,"succ":0}],"x":-29.73,"y":17.078,"demand":5},{"nodes":[{"day":1,"id":79,"succ":0},{"day":2,"id":80,"succ":0},{"day":3,"id":81,"succ":0},{"day":4,"id":82,"succ":0},{"day":5,"id":83,"succ":0},{"day":6,"id":84,"succ":54}],"x":17.542,"y":1.575,"demand":1},{"nodes":[{"day":1,"id":85,"succ":91},{"day":2,"id":86,"succ":92},{"day":3,"id":87,"succ":27},{"day":4,"id":88,"succ":28},{"day":5,"id":89,"succ":180},{"day":6,"id":90,"succ":96}],"x":11.127,"y":77.216,"demand":25},{"nodes":[{"day":1,"id":91,"succ":13},{"day":2,"id":92,"succ":14},{"day":3,"id":93,"succ":87},{"day":4,"id":94,"succ":88},{"day":5,"id":95,"succ":89},{"day":6,"id":96,"succ":18}],"x":33.752,"y":71.259,"demand":10},{"nodes":[{"day":1,"id":97,"succ":67},{"day":2,"id":98,"succ":68},{"day":3,"id":99,"succ":183},{"day":4,"id":100,"succ":70},{"day":5,"id":101,"succ":208},{"day":6,"id":102,"succ":192}],"x":-56.012,"y":-10.394,"demand":2},{"nodes":[{"day":1,"id":103,"succ":112},{"day":2,"id":104,"succ":8},{"day":3,"id":105,"succ":113},{"day":4,"id":106,"succ":215},{"day":5,"id":107,"succ":114},{"day":6,"id":108,"succ":60}],"x":57.874,"y":-16.29,"demand":7},{"nodes":[{"day":1,"id":109,"succ":142},{"day":3,"id":110,"succ":185},{"day":5,"id":111,"succ":174}],"x":10.718,"y":-18.787,"demand":11},{"nodes":[{"day":1,"id":112,"succ":133},{"day":3,"id":113,"succ":146},{"day":5,"id":114,"succ":147}],"x":53.088,"y":-18.75,"demand":4},{"nodes":[{"day":1,"id":115,"succ":0},{"day":3,"id":116,"succ":193},{"day":5,"id":117,"succ":0}],"x":1.569,"y":7.532,"demand":6},{"nodes":[{"day":1,"id":118,"succ":154},{"day":3,"id":119,"succ":15},{"day":5,"id":120,"succ":17}],"x":31.531,"y":48.944,"demand":15},{"nodes":[{"day":1,"id":121,"succ":1},{"day":3,"id":122,"succ":131},{"day":5,"id":123,"succ":5}],"x":-66.833,"y":-37.854,"demand":7},{"nodes":[{"day":1,"id":124,"succ":73},{"day":3,"id":125,"succ":189},{"day":5,"id":126,"succ":182}],"x":-70.74,"y":62.244,"demand":8},{"nodes":[{"day":1,"id":127,"succ":7},{"day":3,"id":128,"succ":45},{"day":5,"id":129,"succ":47}],"x":32.538,"y":23.096,"demand":10},{"nodes":[{"day":1,"id":130,"succ":37},{"day":3,"id":131,"succ":39},{"day":5,"id":132,"succ":176}],"x":-51.453,"y":-36.444,"demand":9},{"nodes":[{"day":1,"id":133,"succ":145},{"day":3,"id":134,"succ":57},{"day":5,"id":135,"succ":117}],"x":36.456,"y":-22.638,"demand":4},{"nodes":[{"day":1,"id":136,"succ":25},{"day":3,"id":137,"succ":195},{"day":5,"id":138,"succ":77}],"x":-31.207,"y":43.494,"demand":6},{"nodes":[{"day":1,"id":139,"succ":136},{"day":3,"id":140,"succ":21},{"day":5,"id":141,"succ":23}],"x":-10.388,"y":34.491,"demand":22},{"nodes":[{"day":1,"id":142,"succ":79},{"day":3,"id":143,"succ":81},{"day":5,"id":144,"succ":210}],"x":14.722,"y":-10.834,"demand":17},{"nodes":[{"day":1,"id":145,"succ":55},{"day":3,"id":146,"succ":134},{"day":5,"id":147,"succ":135}],"x":47.095,"y":-21.387,"demand":9},{"nodes":[{"day":1,"id":148,"succ":0},{"day":3,"id":149,"succ":9},{"day":5,"id":150,"succ":168}],"x":43.781,"y":34.766,"demand":25},{"nodes":[{"day":1,"id":151,"succ":31},{"day":3,"id":152,"succ":33},{"day":5,"id":153,"succ":59}],"x":53.546,"y":-67.487,"demand":10},{"nodes":[{"day":1,"id":154,"succ":148},{"day":3,"id":155,"succ":197},{"day":5,"id":156,"succ":120}],"x":26.801,"y":46.515,"demand":18},{"nodes":[{"day":2,"id":157,"succ":160},{"day":4,"id":158,"succ":213},{"day":6,"id":159,"succ":206}],"x":63.385,"y":11.981,"demand":21},{"nodes":[{"day":2,"id":160,"succ":80},{"day":4,"id":161,"succ":106},{"day":6,"id":162,"succ":12}],"x":47.192,"y":-5.475,"demand":10},{"nodes":[{"day":2,"id":163,"succ":0},{"day":5,"id":164,"succ":144}],"x":-16.315,"y":-11.267,"demand":23},{"nodes":[{"day":2,"id":165,"succ":167},{"day":5,"id":166,"succ":11}],"x":78.9,"y":17.651,"demand":23},{"nodes":[{"day":2,"id":167,"succ":157},{"day":5,"id":168,"succ":166}],"x":79.822,"y":22.272,"demand":11},{"nodes":[{"day":2,"id":169,"succ":44},{"day":5,"id":170,"succ":156}],"x":12.878,"y":16.919,"demand":1},{"nodes":[{"day":2,"id":171,"succ":2},{"day":5,"id":172,"succ":71}],"x":-67.981,"y":-3.754,"demand":23},{"nodes":[{"day":2,"id":173,"succ":50},{"day":5,"id":174,"succ":0}],"x":9.198,"y":-18.597,"demand":16},{"nodes":[{"day":2,"id":175,"succ":38},{"day":5,"id":176,"succ":41}],"x":-35.95,"y":-19.141,"demand":10},{"nodes":[{"day":2,"id":177,"succ":0},{"day":5,"id":178,"succ":150}],"x":28.766,"y":45.276,"demand":12},{"nodes":[{"day":2,"id":179,"succ":86},{"day":5,"id":180,"succ":29}],"x":11.469,"y":68.231,"demand":12},{"nodes":[{"day":2,"id":181,"succ":26},{"day":5,"id":182,"succ":138}],"x":-22.76,"y":45.496,"demand":3},{"nodes":[{"day":3,"id":183,"succ":3},{"day":6,"id":184,"succ":190}],"x":-65.674,"y":-23.12,"demand":22},{"nodes":[{"day":3,"id":185,"succ":0},{"day":6,"id":186,"succ":0}],"x":7.239,"y":1.599,"demand":21},{"nodes":[{"day":2,"id":187,"succ":163},{"day":5,"id":188,"succ":164}],"x":-29.785,"y":-11.285,"demand":13},{"nodes":[{"day":3,"id":189,"succ":137},{"day":6,"id":190,"succ":102}],"x":-89.05,"y":16.211,"demand":15},{"nodes":[{"day":3,"id":191,"succ":69},{"day":6,"id":192,"succ":194}],"x":-46.887,"y":-3.363,"demand":13},{"nodes":[{"day":3,"id":193,"succ":75},{"day":6,"id":194,"succ":186}],"x":-14.972,"y":30.621,"demand":20},{"nodes":[{"day":3,"id":195,"succ":140},{"day":6,"id":196,"succ":30}],"x":-17.035,"y":49.774,"demand":10},{"nodes":[{"day":3,"id":197,"succ":149},{"day":6,"id":198,"succ":200}],"x":31.635,"y":53.619,"demand":25},{"nodes":[{"day":6,"id":199,"succ":78}],"x":-3.577,"y":13.342,"demand":7},{"nodes":[{"day":6,"id":200,"succ":48}],"x":33.008,"y":58.96,"demand":15},{"nodes":[{"day":2,"id":201,"succ":171}],"x":-92.95,"y":63.263,"demand":2},{"nodes":[{"day":4,"id":202,"succ":40}],"x":-9.137,"y":-22.931,"demand":23},{"nodes":[{"day":4,"id":203,"succ":100}],"x":-39.96,"y":6.195,"demand":5},{"nodes":[{"day":4,"id":204,"succ":214}],"x":28.43,"y":-19.214,"demand":25},{"nodes":[{"day":5,"id":205,"succ":101}],"x":-28.54,"y":-3.485,"demand":9},{"nodes":[{"day":6,"id":206,"succ":24}],"x":31.415,"y":36.859,"demand":2},{"nodes":[{"day":5,"id":207,"succ":126}],"x":-49.426,"y":60.602,"demand":24},{"nodes":[{"day":5,"id":208,"succ":123}],"x":-72.827,"y":-27.765,"demand":13},{"nodes":[{"day":5,"id":209,"succ":153}],"x":60.083,"y":-45.905,"demand":20},{"nodes":[{"day":5,"id":210,"succ":83}],"x":10.87,"y":-3.9,"demand":13},{"nodes":[{"day":5,"id":211,"succ":129}],"x":25.122,"y":7.672,"demand":15},{"nodes":[{"day":4,"id":212,"succ":4}],"x":-46.997,"y":-17.474,"demand":4},{"nodes":[{"day":4,"id":213,"succ":46}],"x":16.058,"y":33.02,"demand":20},{"nodes":[{"day":4,"id":214,"succ":82}],"x":25.409,"y":-11.7,"demand":8},{"nodes":[{"day":4,"id":215,"succ":10}],"x":68.323,"y":-5.145,"demand":19}],"routeOf":[7,2,15,16,11,30,13,8,3,10,23,12,1,20,9,10,29,12,1,2,9,10,29,12,7,2,9,10,29,12,13,8,3,16,11,30,7,2,15,16,11,30,1,20,9,10,23,12,13,8,15,16,11,30,13,8,3,16,23,30,13,8,15,16,11,30,7,2,15,16,17,30,7,2,15,16,29,6,13,8,3,16,17,30,1,20,9,10,29,12,1,20,9,10,29,12,7,2,15,16,11,30,13,8,3,10,23,30,13,15,11,13,3,23,7,15,23,1,9,29,7,15,11,7,9,29,13,9,23,7,15,11,13,3,23,7,9,29,7,9,29,13,3,17,13,3,23,1,3,23,13,3,23,1,3,29,8,10,12,8,10,12,2,17,8,23,8,23,20,29,2,17,8,11,2,11,20,23,20,29,2,29,15,30,15,30,2,17,9,30,15,30,15,30,9,12,3,12,6,12,2,16,16,16,11,12,29,11,23,17,23,16,10,16,10,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],"dayOf":[1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,1,3,5,2,4,6,2,4,6,2,5,2,5,2,5,2,5,2,5,2,5,2,5,2,5,2,5,2,5,3,6,3,6,2,5,3,6,3,6,3,6,3,6,3,6,6,6,2,4,4,4,5,6,5,5,5,5,5,4,4,4,4,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6],"succ":[130,98,122,34,132,184,103,165,105,158,209,159,118,177,93,94,95,198,43,74,254,255,274,196,124,201,125,22,207,90,61,56,143,58,65,42,115,187,63,76,35,72,85,179,119,16,178,257,109,62,110,64,111,66,151,104,152,204,107,36,49,32,51,202,53,108,121,175,99,212,188,6,97,181,191,203,141,251,258,253,248,261,262,54,91,92,27,28,180,96,13,14,87,88,89,18,67,68,183,70,208,192,112,8,113,215,114,60,142,185,174,133,146,147,252,193,268,154,15,17,1,131,5,73,189,182,7,45,47,37,39,176,145,57,117,25,195,77,136,21,23,79,81,210,55,134,135,246,9,168,31,33,59,148,197,120,160,213,206,80,106,12,247,144,167,11,157,166,44,156,2,71,50,256,38,41,265,150,86,29,26,138,3,190,260,275,163,164,137,102,69,194,75,186,140,30,149,200,78,48,171,40,100,214,101,24,126,123,153,83,129,4,46,82,10,19,20,155,249,250,199,139,173,128,161,205,162,127,259,116,52,172,263,264,169,266,267,211,269,270,271,272,273,170,84,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,216],"NumDays":6};
    return inst;
    }

    var instance;

    var days;
    var depot;
    var locations;
    
    var visitedOnDay;
    var tours;
    var avgLoad;

    var nonEmptyTours;

    var previousLines;

    var solutions;
    
    var editDay;

    var unavailableVehicles;

    function distance(v0,v1) {
        var d = Math.sqrt(Math.pow(v0.x-v1.x,2)+Math.pow(v0.y-v1.y,2));
        return d;
    }
    
    function updateLoadAndTourLength() {
        if (editDay != -1) {
            d3.selectAll("#load-heading").html("Load");
            d3.selectAll(".load-column")
            .html(function(d) {
                for (var i=0; i<tours[editDay].length; i++) {
                    var vehicleNumber = Math.trunc((tours[editDay][i].routeNumber-1) / instance.NumDays);
                    if (vehicleNumber==d) {
                        return tours[editDay][i].load;
                    }
                }
                return "unused";
            });
            d3.selectAll(".tour-length-column")
            .html(function(d) {
                for (var i=0; i<tours[editDay].length; i++) {
                    var vehicleNumber = Math.trunc((tours[editDay][i].routeNumber-1) / instance.NumDays);
                    if (vehicleNumber==d) {
                        return tours[editDay][i].dist.toFixed(2);
                    }
                }
                return "0";
            });
        } else {
            if (tours.length > 0) {
                d3.selectAll("#load-heading").html("Average load");
                d3.selectAll(".load-column")
                .html(function(d) {
                    var al = 0;
                    var usedDays = 0;
                    for (var i=0; i<instance.NumDays; i++) {
                        var usedThisDay=false;
                        for (var j=0; j<tours[i].length; j++) {
                            var vehicleNumber = Math.trunc((tours[i][j].routeNumber-1) / instance.NumDays);
                            if (vehicleNumber==d) {
                                usedThisDay=true;
                                al += tours[i][j].load;
                            }
                        }
                        if (usedThisDay)
                            usedDays++;
                    }
                    return usedDays==0 ? 0 : (al/usedDays).toFixed(2);
                });
                d3.selectAll(".tour-length-column")
                .html(function(d) {
                    var tl = 0;
                    for (var i=0; i<instance.NumDays; i++) {
                        for (var j=0; j<tours[i].length; j++) {
                            var vehicleNumber = Math.trunc((tours[i][j].routeNumber-1) / instance.NumDays);
                            if (vehicleNumber==d) {
                                tl += tours[i][j].dist;
                            }
                        }
                    }
                    return tl.toFixed(2);
                });
            }
        }        
    }
    
    function addCircles(groups) {
        var tooltip = d3.select("#tooltip");
        groups
        .append("circle")
        .classed("customer", true)
        .style("stroke", "black")
        .style("fill", "grey")
        .style("opacity", 0.3)
        .attr("r", radius)
        .attr("cx",  function(d) { return xRangecoords(d.x)})
        .attr("cy",  function(d) { return yRangecoords(d.y)})
        .on("mouseover", function(d,i) {
          var matrix = this.getScreenCTM()
            .translate(+ this.getAttribute("cx"), + this.getAttribute("cy"));
          tooltip.html(i)
            .style("left", (window.pageXOffset + matrix.e + 5) + "px")
            .style("top", (window.pageYOffset + matrix.f - 20) + "px");
            tooltip.transition().duration(300).style("opacity", .9);
        })
        .on("mouseout", function(d) {
          tooltip.transition().duration(300).style("opacity", 0);
        });
        groups.append("circle")
        .style("stroke", "black")
        .style("fill", "black")
        .attr("r", 1.3*radius)
        .attr("cx",  xRangecoords(instance.locX[instance.locX.length-1]))
        .attr("cy",  yRangecoords(instance.locY[instance.locY.length-1]));        
    }

    function updateUnavailableVehicles() {
        // console.log(unavailableVehicles);
        d3.selectAll(".availability").selectAll("button")
        .data(unavailableVehicles)
        .classed("btn-danger", function(d,i,j) {
            // console.log("update "+i+" "+j+" "+unavailableVehicles[i][j])
            return unavailableVehicles[i][j];
        });
        d3.selectAll(".availability").selectAll("span")
        .data(unavailableVehicles)
        .classed("glyphicon-remove", function(d,i,j) {
            return unavailableVehicles[i][j];
        })
        .classed("glyphicon-ok", function(d,i,j) {
            return !unavailableVehicles[i][j];
        });
        if (roWindow) {
            roWindow.postMessage({'updateUnavailableVehicles':unavailableVehicles}, "*");
        }
    }

    function updateInstance(inst) {
        d3.select("#solve-button").html("Solve");
        d3.select("#stats").style('visibility','visible');
        
        if (roWindow) {
            roWindow.postMessage({'updateInstance':inst}, "*"); 
        }
        
        instance = inst;
        
        xRangecoords = d3.scale.linear().range([0, windowWidth]).domain([
          Math.min(d3.min(instance.locX),d3.min(instance.locY)),
          Math.max(d3.max(instance.locX),d3.max(instance.locY))]);

        yRangecoords = xRangecoords;

        windowHeight = xRangecoords(d3.max(instance.locY));
        days = [{},{},{},{},{},{},{}];
        depot;
        locations = [];
        
        visitedOnDay = [{},{},{},{},{},{},{}];
        tours = [];
        unavailableVehicles = [[],[],[],[],[],[],[]];
        for (var i=0; i<instance.NumDays; i++) {
            for (var j=0; j<instance.NumVehicles; j++) {
                unavailableVehicles[i][j]=false;
            }
        }

        nonEmptyTours = [];
        for (var i=0; i<instance.NumDays; i++) {
            nonEmptyTours.push(i);
        }
        
        previousLines = [];
        solutions = [];
        objValues = [];

        locations.push({'id':0, 'x':instance.locX[instance.locX.length-1], 'y':instance.locY[instance.locY.length-1]});
        for (i=0; i<instance.locX.length-1; i++) {
            locations.push({'id':i+1, 'x':instance.locX[i], 'y':instance.locY[i]});
        }
        depot = {'id': "depot", 'x':instance.locX[instance.locX.length-1], 'y':instance.locY[instance.locY.length-1]};

        d3.selectAll("#viz").selectAll("tr").remove();
        d3.select("#vehicle-table tbody").selectAll("tr").remove();

        var nestedTours = [];
        for (var i=0; i<nonEmptyTours.length; i++) {
            if (i % nVehiclesPerRow == 0) {
                nestedTours.push([]);
            }
            nestedTours[nestedTours.length-1].push(nonEmptyTours[i]);
        }
        

        var tableRows =
            d3.select("#viz").selectAll("tr")
            .data(nestedTours)
            .enter()
            .append("tr");

        window.groupDivs = tableRows.selectAll("td").data(function(d){return d;})
        .enter()
        .append("td").append("div");
        
        d3.select("#viz").selectAll("td").insert("div","div")
        .classed("day-heading",true)
        .html(function(d,i) { return "Day "+(i+1); });

        if (!isReadonlyView) {
            d3.select("#viz").selectAll("td")
            .insert("div",".day-heading")
            .classed("btn-toolbar", true)
            .style({"display":"inline-block","vertical-align":"middle","margin-right":"5px"})
            .property("role","toolbar")
            .append("div")
            .classed("btn-group btn-group-sm edit-icons",true);

            var editButton = d3.selectAll(".edit-icons")
            .append("button")
            .property("type","button")
            .classed("btn btn-default editor-button",true);
        
            editButton
            .append("span")
            .classed("glyphicon glyphicon-pencil", true);
        
            editButton
            .on("click", function(d) {
                d3.event.preventDefault();
                if (status=="waiting")
                    createEditor(d,true);
            });

            var resolveButton = d3.selectAll(".edit-icons")
            .append("button")
            .property("type","button")
            .classed("btn btn-default resolve-button",true);
        
            resolveButton
            .append("span")
            .classed("glyphicon glyphicon-repeat", true);
        
            resolveButton
            .on("click", function(d){
                d3.event.preventDefault();
               // console.log("click " + (d+1));
               if (status == "waiting")
                   freeze(d+1);
             });

            d3.selectAll(".edit-icons")
            .append("button")
            .property("type","button")
            .classed("btn btn-default freeze-button",true)
            .property("id",function(d) { return "freezeButton"+d; })
            .on("click", function(d) {
                d3.event.preventDefault();
                var toElem = d3.select("#freezeButton"+d);
                var toggle = toElem.classed("btn-danger");
                toElem.classed("btn-danger",!toggle);
            })
            .append("span")
            .classed("glyphicon glyphicon-ban-circle", true);
        }
        var wellWidth = $('#days').width();
         // parseInt(d3.select("#days").style('width'));
        // console.log("Width: "+wellWidth);
        
        groupDivs
        .classed("svg-container",true)
        .style("width",(wellWidth/nVehiclesPerRow)+"px")
        .style("height",(wellWidth/nVehiclesPerRow)+"px")
        groupDivs
        .append("svg:svg")
        .attr("viewBox", "0 0 "+(1*(margin.left+windowWidth)+margin.right)+
                         " "+(windowHeight+margin.top+margin.bottom))
        .append("g")
        .classed("vrp-canvas",true)
        .attr("transform", function(d) {
            return "translate(" + margin.left + "," + margin.top + ")"});
        
        var tdHeight = $("#days td").height();
        $('#days').height(Math.round((instance.NumDays+0.5)/nVehiclesPerRow)*tdHeight);
        $('#editor').height(Math.round((instance.NumDays+0.5)/nVehiclesPerRow)*tdHeight);
        
        groupDivs
        .property("draggable",true)
        .on("dragstart",function(d) { d3.event.dataTransfer.setData("text",d); });

        d3.select("#viz_edit")
        .on("dragover", function(d) { d3.event.preventDefault(); })
        .on("drop", function(d) { d3.event.preventDefault(); createEditor(parseInt(d3.event.dataTransfer.getData("text")),false);});
        
        groupDivs.selectAll("svg").classed("svg-content-responsive", true);

        d3.select(".tooltip").style("opacity", 0);

        d3.selectAll(".vrp-canvas")
        .selectAll('.circle')
        .data(locations)
        .enter()
        .call(addCircles);

        var vehicles = [];
        for (var i=0; i<instance.NumVehicles; i++) {
            vehicles.push(i);
        }
            
        
        d3.select("#n_cust").html(instance.locX.length-1);
        var totalDemand = 0;
        for (var i=0; i<instance.Demand.length; i++) {
            totalDemand += instance.Demand[i]*instance.VisitDays[i];
        }
        d3.select("#total_demand").html(totalDemand);
        
        var vehicleRows = d3.select("#vehicle-table tbody").selectAll("tr")
        .data(vehicles)
        .enter()
        .append("tr");
        
        vehicleRows
        .append("td")
        .append("button")
        .property("type","button")
        .classed("btn btn-default btn-sm mybtn-outline",true)
        .on("click", function(d) {
            freezeVehicle(d);
        })
        .style("color",function(d){ return colors[d%colors.length];})
        .style("border",function(d){ return "2px solid "+colors[d%colors.length];})
        .html(function(d){return d+1;});
        
        vehicleRows
        .append("td")
        .html(function(d){return instance.Capacity[d];});
        vehicleRows
        .append("td")
        .classed("load-column",true);
        vehicleRows
        .append("td")
        .classed("tour-length-column",true);
        vehicleRows
        .append("td")
        .classed("vehicle-status",true)
        .append("div")
        .classed("checkbox vehicle-checkbox",true)
        .append("label")
        .append("input")
        .classed("vehicle-toggle",true)
        .attr("id",function(d) { return "vehicle-toggle-"+d; })
        .property("type","checkbox")
        .property("data-toggle","toggle")
        .property("checked",false)
        .html("Enabled");
        $(".vehicle-toggle").bootstrapToggle({
            'on':"Unavailable", 'off':"Available",
            'size':'small',
            'offstyle':'default',
            'onstyle':'danger'
        });
        $(".vehicle-toggle").change(function(d) {
            var vehicle = parseInt(d.currentTarget.id.substr(15));
            unavailableVehicles[editDay][vehicle]=$(this).prop('checked');
            updateUnavailableVehicles();
        })
        
        d3.selectAll(".vehicle-status")
        .append("div")
        .classed("availability",true)
        .selectAll("button")
        .data(nonEmptyTours)
        .enter()
        .append("button")
        .property("type","button")
        .classed("btn btn-default btn-xs",true)
        .on("click", function(d,i,j) {
            unavailableVehicles[i][j] = !unavailableVehicles[i][j];
            updateUnavailableVehicles();
        })        
        .append("span")
        .classed("glyphicon glyphicon-ok", true);
        
        d3.select("#obj-graph-svg").remove();
        
        window.objSVG = d3.select("#obj-graph")
        .append("svg:svg")
        .attr("id","obj-graph-svg")
        .attr("viewBox", "0 0 1000 310");
        
        window.objXScale = d3.scale.linear().range([0,1000]);
        window.objYScale = d3.scale.linear().range([300,0]);
        window.objXAxis = d3.svg.axis().scale(objXScale).orient("bottom").ticks(0);
        window.objYAxis = d3.svg.axis().scale(objYScale).orient("left");
        
        objSVG.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(60,300)")
        .call(objXAxis);

        objSVG.append("g")
        .attr("class", "y axis")
        .attr("transform", "translate(60,0)")
        .call(objYAxis);

        window.objGroup = objSVG.append("g")
        .attr("transform", "translate(60,0)")
        .attr("id","objGroup");
                
        createEditor(editDay,true);

        if (typeof instance['sol'] != 'undefined') {
            addSolution(instance['sol']);
        }

    }


    //Params
    var radius = 5;
    var radius2 = 12;
    
    function gotoSolution(solnumber) {
      // console.log("updating");
      updatingInProgress = true;

      var nodes = solutions[solnumber].nodedata;
      var numDays = solutions[solnumber].NumDays;

      d3.select("#obj").html(Math.round(solutions[solnumber].obj/10.0)/100.0);

      days = [{},{},{},{},{},{},{}];
      visitedOnDay = [{},{},{},{},{},{},{}];
      tours = [];
            
      for (var i=0; i<nodes.length; i++) {
        if (nodes[i].nodes[0].id!=0) {
          for (var j=0; j<nodes[i].nodes.length; j++) {
            node = nodes[i].nodes[j];
            day = days[node.day-1];
            visitedOnDay[node.day-1][i] = true;
            if (node.id in day) {
              day[node.id].demand=nodes[i].demand;
              day[node.id].s=node.succ;
              day[node.id].x=nodes[i].x;
              day[node.id].y=nodes[i].y;
            } else {
              day[node.id] = {'s':node.succ, 'x':instance.locX[i-1], 'y':instance.locY[i-1], 'demand':instance.Demand[i-1]};
            }
            if (node.succ != 0) {
              if (node.succ in day) {
                day[node.succ].p=node.id;
              } else {
                day[node.succ] = {'p':node.id};
              }
            }
          }
        }
      }
      for (var i = 0 ; i < 7 ; i++) {
        tours.push([]);
      }
      for (var i=0; i<days.length; i++) {
        for (var nid in days[i]) {
          if (!('p' in days[i][nid])) {
            var newTour = {};
            newTour.nodes = [depot, {'id':nid,'x':days[i][nid].x,'y':days[i][nid].y}];
            newTour.routeNumber = solutions[solnumber].routeOf[nid-1];
            newTour.load = days[i][nid].demand;
            newTour.dist = distance(depot,days[i][nid]);
            prev = nid;
            succ = days[i][nid].s;
            while (succ != 0) {
              newTour.nodes.push({'id':succ,'x':days[i][succ].x,'y':days[i][succ].y});
              newTour.load += days[i][succ].demand;
              newTour.dist += distance(days[i][prev],days[i][succ]);
              prev = succ;
              succ = days[i][succ].s;
            }
            newTour.dist += distance(days[i][prev],depot);
            newTour.nodes.push(depot);
            tours[i].push(newTour);
          }
        }
      }
      
      //**Create path **//
      var line = d3.svg.line()
        // .interpolate("cardinal")
        .x(function(d) {return xRangecoords(d.x);})
        .y(function(d) {return yRangecoords(d.y);});
            
      var lines = d3.selectAll(".vrp-canvas").selectAll('.line')
            .data(function(d){ if (d<instance.NumDays) return tours[d]; else return tours[editDay]; },
                  function(d,i){ return d.routeNumber;});

      var changedLines = lines.filter(function(d,i,j) {
          // console.log(d);
          // console.log(previousLines[j][i]);
          if (previousLines[j][d.routeNumber] === undefined) {
              // console.log("previous undefined line "+d.routeNumber);
              return true;
          }
          var eq = arraysEqual(d.nodes,previousLines[j][d.routeNumber].nodes);
          // if (!eq) {
          //   console.log("Changed line "+i+" "+j);
          //     console.log(JSON.stringify(d.nodes));
          //     console.log(JSON.stringify(previousLines[j][d.routeNumber].nodes));
          // }
          // console.log(eq);
          return (!eq);
      });

      // changedLines.each(function(d,i) { console.log("changed line "+i); console.log(d); });

//      lines.enter().each(function(d,i) { console.log("enter "+d+" "+i); });
      // lines.exit().each(function(d,i,j) { console.log("exit "+d+" "+i+" "+j); });

      lines
      .enter()
        .insert("path", "circle")
        .attr("class","line")
        .attr("fill","none")
        .attr("stroke-width",5)
        .attr("stroke-linejoin","round")
        .style("opacity", 0.3)
        .attr("d", function(d){return line(d.nodes);})
        .attr('stroke', function(d,i){
          var vehicleNumber = Math.trunc((d.routeNumber-1) / numDays) + 1;
          return colors[(vehicleNumber-1)%colors.length];
        })
        // .on("click", function(i) { return function(d,j) {
        //     console.log("click route " + d.routeNumber);
        //     if (status == "waiting")
        //         freezeRoute(d.routeNumber);
        // } }(i))
        .on("click", function(d,i,j) {
            d3.event.preventDefault();
            // console.log("click "+d.routeNumber+" "+i+" "+j);
            if (status == "waiting" && j==instance.NumDays)
                freezeRoute(d.routeNumber);
        })
        .on("mouseover", function(d,i) {
            d3.select(this)
              .style("opacity", 1)
              // .attr("stroke-width",10)
        })
        .on("mouseout", function(d,i) {
            d3.select(this)
              .style("opacity", 0.3)
              .attr("stroke-width",5)
        });

      lines.exit().remove();

      previousLines = [];
      for (var i=0; i<instance.NumDays; i++) {
        var tour_i = {};
        for (var j=0; j<tours[i].length; j++) {
          tour_i[tours[i][j].routeNumber] = tours[i][j];
        }
        previousLines.push(tour_i);
      }
      if (editDay != -1) {
        var tour_i = {};
        for (var j=0; j<tours[editDay].length; j++) {
          tour_i[tours[editDay][j].routeNumber] = tours[editDay][j];
        }
        previousLines.push(tour_i);
      }

        changedLines
              .style("opacity", 1.0)
              .transition()
              .duration(500)
              .attr("d", function(d){return line(d.nodes);})
              .attr('stroke', function(d,i){
                var vehicleNumber = Math.trunc((d.routeNumber-1) / numDays) + 1;
                return colors[(vehicleNumber-1)%colors.length];
              })
              .transition()
              .duration(300)
              .attr("stroke-width",5)
              .style("opacity", 0.3);

      var circle = d3.selectAll(".vrp-canvas")
        .selectAll(".customer")
        .style("opacity", function(d,i,j) {
            var dayNumber = j+1;
            if (dayNumber > instance.NumDays) {
                dayNumber = editDay+1;
            }
            if (i in visitedOnDay[dayNumber-1])
                return 1.0;
            else
                return 0.3;
        });

      objXScale.domain([0,Math.max(50,objValues.length)]);
      objYScale.domain([0,d3.max(objValues)]);
      var objLine = d3.svg.line()
        .x(function(d,i){return window.objXScale(i);})
        .y(function(d,i){
            // console.log("objline "+window.objXScale(i)+ " "+window.objYScale(d));
            return window.objYScale(d);});
        
      // console.log("Obj SVG");
      // console.log(objSVG);
        
      var lineGraph = objGroup.select("path");
      if (lineGraph.empty()) {
          lineGraph = objGroup.append("path")
          .attr("class","line")
          .style("stroke","blue")
          .style("fill","none");
      }
      lineGraph.attr("d",objLine(objValues));
      // console.log("Line graph");
      // console.log(lineGraph);
      objSVG.selectAll("g.x.axis").call(window.objXAxis);
      objSVG.selectAll("g.y.axis").call(window.objYAxis);

      updateLoadAndTourLength();
      // console.log("update done");
      updatingInProgress = false;
    }

    var ws;
    window.onload = function() {
        ws = new WebSocket("ws://s-cah-mwallace.infotech.monash.edu:8123");
        ws.onmessage = function(e) {
            var val = JSON.parse(e.data);
            if ('nodedata' in val)
                addSolution(val);
            else if ('controlmsg' in val && val.controlmsg == "solving done")
                solvingDone();
            else
                console.log("unknown message: " + e.data);
        }
    }

    function createEditor(day, clicked) {
        if (previousLines.length > instance.NumDays) {
            previousLines.pop();
        }
        if (clicked && day==editDay) {
            editDay = -1;
            d3.selectAll(".editor-button").classed("btn-primary", false);
            d3.selectAll(".freeze-button").classed("btn-danger", false);
            d3.selectAll(".vehicle-checkbox").style("display","none");
            d3.selectAll(".availability").style("display","inherit");
            d3.select("#viz_edit").select("svg").remove();
            updateLoadAndTourLength();
            return;
        }

        // console.log("Create editor for day "+day);
        editDay = day;

        var tour_i = {};
        for (var j=0; j<tours[editDay].length; j++) {
          tour_i[tours[editDay][j].routeNumber] = tours[editDay][j];
        }
        previousLines.push(tour_i);

        d3.selectAll(".vehicle-checkbox").style("display","inherit");
        d3.selectAll(".availability").style("display","none");
        
        for (var i=0; i<instance.NumVehicles; i++) {
            if (unavailableVehicles[day][i]) {
                $("#vehicle-toggle-"+i).prop('checked',true).change();
            } else {
                $("#vehicle-toggle-"+i).prop('checked',false).change();
            }
        }
        
        d3.selectAll(".editor-button")
        .classed("btn-primary", function(d,i) { return i==editDay; });
        
        d3.selectAll(".freeze-button")
        .classed("btn-danger", function(d,i) { return i!=editDay; });
        
        d3.select("#viz_edit").select("svg").remove();

        var wellWidth = $('#editor').width();

        d3.selectAll(".svg-edit-container")
        .style("width",(wellWidth)+"px")
        .style("height",(wellWidth)+"px");

        updateLoadAndTourLength();

        d3.select("#viz_edit")
        .append("svg:svg")
        .attr("viewBox", "0 0 "+(1*(margin.left+windowWidth)+margin.right)+
                         " "+(windowHeight+margin.top+margin.bottom))
        .append("g")
        .classed("vrp-canvas",true)
        .attr("transform", function(d) {
            return "translate(" + margin.left + "," + margin.top + ")"});

        d3.select("#viz_edit").selectAll(".vrp-canvas")
        .selectAll('.circle')
        .data(locations)
        .enter()
        .call(addCircles);
        gotoSolution(solutions.length-1);
    }

    function solvingDone() {
      // console.log("Solving done!\n");
        status = "waiting";
        d3.select("#spinner").classed("spinner-loader",false);
        // d3.select("#viz").style('background','green');
    }

    function defaultParameters() {
        var params = { 'fixedDays': []
                     , 'fixedRoutes': []
                     , 'objectiveToBeat': enforceObjective() ? currentObjective() : 0
                     , 'enable_lns': do_lns() ? 1 : 0
                     , 'timeout': getTimeout()
                     , 'forbiddenRoutes': []
                     , 'searchHeuristic': random_search() ? "random" : "naive"
                     , 'previousSucc': currentSucc()
                     , 'previousRouteOf': currentRouteOf()
                     };
        d3.selectAll(".freeze-button").each(function(d,i) {
            if (d3.select(this).classed("btn-danger")) {
                params.fixedDays.push(i+1);
            }
        });
        for (var d=0; d<instance.NumDays; d++) {
            for (var v=0; v<instance.NumVehicles; v++) {
                if (unavailableVehicles[d][v]) {
                    var routeNumber = instance.NumDays*v+d+1;
                    params.forbiddenRoutes.push(routeNumber);
                }
            }
        }
        console.log("Forbidden routes");
        console.log(params.forbiddenRoutes);
        if (params.forbiddenRoutes.length > 0) {
            if (params.searchHeuristic=="random") {
                params.searchHeuristic = "route_random";
            } else {
                params.searchHeuristic = "route";
            }
        }
        // console.log("Freeze "+params.fixedDays);
        // console.log("Break routes "+params.forbiddenRoutes);
        for (var attrname in instance) { if (attrname != 'sol') { params[attrname] = instance[attrname]; } }
        return params;
    }

    function currentSucc() {
        var n = solutions.length;
        if (n == 0) return [];
        return solutions[n-1].succ;
    }

    function currentRouteOf() {
        var n = solutions.length;
        if (n == 0) return [];
        return solutions[n-1].routeOf;
    }

    function currentObjective() {
        var n = solutions.length;
        if (n == 0) return 0;
        return solutions[n-1].obj;
    }

    function enforceObjective() {
        return document.getElementById("enforceobjective").checked;
    }
    function do_lns() {
        return document.getElementById("do_lns").checked;
    }
    function random_search() {
        return document.getElementById("random_search").checked;
    }

    function getTimeout() {
        return document.getElementById("timeout").value;
    }


    function sendMessage(parameters) {
        d3.select("#spinner").classed("spinner-loader",true);
        // d3.select("#viz").style('background','red');
        status = "solving";
        ws.send(JSON.stringify(parameters));
    }

    function send() {
        sendMessage(defaultParameters());
    }

    function freeze(day) {
        d3.select("#spinner").classed("spinner-loader",true);
        // d3.select("#viz").style('background','red');
        status = "solving";
        var params = defaultParameters();
        var frozenDays = [];
        for (var i = 1 ; i <= params.NumDays ; i++)
            if (i != day)
                frozenDays.push(i);
        params.fixedDays = frozenDays;
        sendMessage(params);
        // ws.send("freeze day " + day);
    }

    function freezeRoute(route) {
        // d3.select("#viz").style('background','red');
        d3.select("#spinner").classed("spinner-loader",true);
        status = "solving";
        var params = defaultParameters();
        var frozenRoutes = [];
        for (var i = 1 ; i <= params.NumDays * params.NumVehicles ; i++)
            if (i != route)
                frozenRoutes.push(i);
        params.fixedRoutes = frozenRoutes;
        sendMessage(params);
    }
    
    function freezeVehicle(d) {
        d3.select("#spinner").classed("spinner-loader",true);
        status = "solving";
        var params = defaultParameters();
        var frozenRoutes = [];
        if (editDay==-1) {
            // freeze all vehicles but d on all days
            for (var day=0; day<params.NumDays; day++) {
                for (var v=0; v<params.NumVehicles; v++) {
                    if (v != d)
                        frozenRoutes.push(v*params.NumDays+day+1);
                }
            }
        } else {
            // freeze all vehicles but d on editDay
            var route = instance.NumDays*d+editDay+1;
            for (var i = 1 ; i <= params.NumDays * params.NumVehicles ; i++)
                if (i != route)
                    frozenRoutes.push(i);
        }
        params.fixedRoutes = frozenRoutes;
        sendMessage(params);
    }

    var updateTimer = null;
    
    function addSolution(val) {
      d3.select("#solve-button").html("Improve");
      // console.log("addSolution");
      // console.log(val);
      // console.log(currentRouteOf());
      // console.log(val.routeOf);
      // if (!arraysEqual(currentRouteOf(), val.routeOf))
      //     console.log("LOOK HERE!!!");
      var dataset = val;
            
      for (i=1; i<dataset.nodedata.length; i++) {
        dataset.nodedata[i].x = instance.locX[i-1];
        dataset.nodedata[i].y = instance.locY[i-1];
        dataset.nodedata[i].demand = instance.Demand[i-1];
      }
      dataset.nodedata[0].x = instance.locX[instance.locX.length-1];
      dataset.nodedata[0].y = instance.locY[instance.locY.length-1];
      dataset.nodedata[0].demand = 0;
      solutions.push(dataset);
      if (updateTimer == null)
        updateTimer = setTimeout(updateDisplay, 200);
    }

    function receiveMessage(event) {
        if ('updateInstance' in event.data) {
            updateInstance(event.data['updateInstance']);
        } else if ('updateUnavailableVehicles' in event.data) {
            unavailableVehicles = event.data['updateUnavailableVehicles'];
            updateUnavailableVehicles();
        } else {
            addSolution(event.data);
        }
    }

    function updateDisplay() {
      if (roWindow) {
          // console.log("update remote display");
          roWindow.postMessage(solutions[solutions.length-1], "*"); 
      }
      // console.log("updating for " + solutions[solutions.length-1].obj);
      objValues.push(solutions[solutions.length-1].obj/1000.0);
      gotoSolution(solutions.length-1);
      updateTimer = null;
    }

    function arraysEqual(a,b) {
        // So dirty
        return JSON.stringify(a) == JSON.stringify(b);
        // if (a.length != b.length)
        //     return false;
        // for (var i = 0 ; i < a.length ; i++)
        //     if (a[i] != b[i])
        //         return false;
        // return true;
    }
 
    function exportSolution() {
        var nw = window.open();
        nw.document.write(JSON.stringify(solutions[solutions.length-1]));
    }
 
    var popOverVisible = false;
 
    function help() {
        var doShow = popOverVisible ? 'hide' : 'show';
        if (popOverVisible) {
            d3.select("#help-menu").html("Help!");
            d3.select(".fadeMe").remove();
        } else {
            d3.select("body").append("div").classed("fadeMe",true)
            .on("click",function(){help();});
            d3.select("#help-menu").html("Hide help");
        }
        popOverVisible = !popOverVisible;
        $("#load-data-link").popover({
            'content' : 'Click here to load data sets',
            'trigger':'manual',
            'placement':'bottom',
            'container':'body'            
        }).popover(doShow);
        $(".mybtn-outline").first().popover({
            'content' : 'Improve individual route',
            'trigger':'manual',
            'placement':'left'
        }).popover(doShow);
        $("#solve-button").popover({
            'content' : 'Find a solution',
            'trigger':'manual',
            'placement':'right'
        }).popover(doShow);
        $("#enforceobjective").parent().parent().parent().popover({
            'content' : 'If selected, the solver needs to improve on the current solution',
            'trigger':'manual',
            'placement':'left'
        }).popover(doShow);
        $("#do_lns").parent().parent().parent().popover({
            'content' : 'Perform large neighbourhood search (good for improving days or multiple days)',
            'trigger':'manual',
            'placement':'bottom'
        }).popover(doShow);
        $("#random_search").parent().parent().parent().popover({
            'content' : 'Randomize the solving process',
            'trigger':'manual',
            'placement':'top'
        }).popover(doShow);
        $("#viz tr td").first().popover({
            'content' : 'Drag to editor pane on the right to edit individual day',
            'trigger':'manual',
            'container':'body'
        }).popover(doShow);
        $(".resolve-button").first().popover({
            'content' : 'Solve only this day',
            'trigger':'manual',
            'placement':'bottom',
            'container':'body'
        }).popover(doShow);
        $(".freeze-button").eq(1).popover({
            'content' : 'Freeze this day (do not modify when solving)',
            'trigger':'manual',
            'placement':'bottom',
            'container':'body'
        }).popover(doShow);
        $(".availability button").eq(1).popover({
            'content' : 'Disable vehicle for a particular day',
            'trigger' : 'manual',
            'placement':'top',
            'container':'body'
        }).popover(doShow);
        $(".vehicle-checkbox").eq(1).popover({
            'content' : 'Disable vehicle',
            'trigger' : 'manual',
            'placement':'top',
            'container':'body'
        }).popover(doShow);
    }
 
    function about() {
        $("#modalhelp").modal();
    }
 
    </script>

</head>
<style>
body {
  font: 16px sans-serif;
}

.modal-body h4 {
    font-weight:bold;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.dot {
  stroke: #000;
}

/* Customize container */
/*@media (min-width: 768px) {
  .container {
    width: 1800px;
  }
}
*/
body {
  padding-top: 70px;
  padding-bottom: 30px;
}

.theme-dropdown .dropdown-menu {
  position: static;
  display: block;
  margin-bottom: 20px;
}

.theme-showcase > p > .btn {
  margin: 5px 0;
}

.theme-showcase .navbar .container {
  width: auto;
}

.tooltip {
  position: absolute;
  width: 200px;
  height: 50px;
  font-size: 14px;
  pointer-events: none;
}
.svg-container-div {
    display: inline-block;
}
.svg-container {
    position: relative;
    margin: auto;
/*    width: 500px;
    height: 500px;
*/    overflow: hidden;
  }
.svg-edit-container {
  position: relative;
  margin: auto;
/*  border-style:solid;*/
  width: 700px;
  height: 700px;
}

#days, #editor {
    height: 800px;
}

@-moz-keyframes spinner-loader {
  0% {
    -moz-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -moz-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@-webkit-keyframes spinner-loader {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
@keyframes spinner-loader {
  0% {
    -moz-transform: rotate(0deg);
    -ms-transform: rotate(0deg);
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  100% {
    -moz-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
/* :not(:required) hides this rule from IE9 and below */
.spinner-loader:not(:required) {
  -moz-animation: spinner-loader 1500ms infinite linear;
  -webkit-animation: spinner-loader 1500ms infinite linear;
  animation: spinner-loader 1500ms infinite linear;
  -moz-border-radius: 0.5em;
  -webkit-border-radius: 0.5em;
  border-radius: 0.5em;
  -moz-box-shadow: rgba(0, 0, 51, 0.3) 1.5em 0 0 0, rgba(0, 0, 51, 0.3) 1.1em 1.1em 0 0, rgba(0, 0, 51, 0.3) 0 1.5em 0 0, rgba(0, 0, 51, 0.3) -1.1em 1.1em 0 0, rgba(0, 0, 51, 0.3) -1.5em 0 0 0, rgba(0, 0, 51, 0.3) -1.1em -1.1em 0 0, rgba(0, 0, 51, 0.3) 0 -1.5em 0 0, rgba(0, 0, 51, 0.3) 1.1em -1.1em 0 0;
  -webkit-box-shadow: rgba(0, 0, 51, 0.3) 1.5em 0 0 0, rgba(0, 0, 51, 0.3) 1.1em 1.1em 0 0, rgba(0, 0, 51, 0.3) 0 1.5em 0 0, rgba(0, 0, 51, 0.3) -1.1em 1.1em 0 0, rgba(0, 0, 51, 0.3) -1.5em 0 0 0, rgba(0, 0, 51, 0.3) -1.1em -1.1em 0 0, rgba(0, 0, 51, 0.3) 0 -1.5em 0 0, rgba(0, 0, 51, 0.3) 1.1em -1.1em 0 0;
  box-shadow: rgba(0, 0, 51, 0.3) 1.5em 0 0 0, rgba(0, 0, 51, 0.3) 1.1em 1.1em 0 0, rgba(0, 0, 51, 0.3) 0 1.5em 0 0, rgba(0, 0, 51, 0.3) -1.1em 1.1em 0 0, rgba(0, 0, 51, 0.3) -1.5em 0 0 0, rgba(0, 0, 51, 0.3) -1.1em -1.1em 0 0, rgba(0, 0, 51, 0.3) 0 -1.5em 0 0, rgba(0, 0, 51, 0.3) 1.1em -1.1em 0 0;
}

#spinner {
    display: inline-block;
    vertical-align: middle;
    font-size: 10px;
    width: 1em;
    height: 1em;
    margin: 1.5em;
    overflow: hidden;
    text-indent: 100%;    
}

.day-heading {
    font-size: 16pt;
    display:inline-block;
    vertical-align: middle;
}

.edit-icons {
    font-size: small;
}

.btn:focus,.btn:active:focus,.btn.active:focus,
.btn.focus,.btn:active.focus,.btn.active.focus {
    outline: none;
    box-shadow: none;
}

#vehicle-table tbody td {
    vertical-align: middle;
}

.mybtn-outline {
    background: none;
/*    padding: 12px 22px;*/
}

div.fadeMe {
    opacity: 0.5;
    background: #000;
    width: 100%;
    height: 100%;
    z-index:1040;
    top:0;
    left:0;
    position:fixed;
}

// .svg-content-responsive {
//     display: inline-block;
//     position: absolute;
//     top: 10px;
//     left: 10px;
// }
</style>
<body role="document">
    
<nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <!-- <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button> -->
          <span class="navbar-brand">Interactive Vehicle Routing</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a id="load-data-link" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Load data<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#" onclick="updateInstance(smallInstance());">Data set 1</a></li>
                <li><a href="#" onclick="updateInstance(defaultInstance());">Data set 2</a></li>
                <li><a href="#" onclick="updateInstance(defaultSolution());">Solution set 2</a></li>
                <li><a href="#" onclick="updateInstance(bigInstance());">Data set 3</a></li>
                <li><a href="#" onclick="updateInstance(bigSolution());">Solution set 3</a></li>
              </ul>
            </li>
            <li><a href="#" id="help-menu" onclick="help()">Help!</a></li>
            <li><a href="#" id="help-menu" onclick="about()">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
        <!-- <div class="navbar-text navbar-right">www.minizinc.org</div> -->
      </div>
</nav>
    <div class="container-fluid theme-showcase" role="main">
        <div class="row">
            <div id="days" class="col-md-4 well">
                <table id="viz"></table>
                <div class="tooltip" style="opacity:0"></div>
            </div>
            <div id="editor-separator" class="col-md-1">
            </div>
        <!-- <div id="viz" class="svg-container"></div> -->
            <div id="editor" class="col-md-4 well">
                <div id="viz_edit" class="svg-edit-container"></div>
            </div>
            <div id="stats" class="col-md-3" style="visibility:hidden">
                <h2 class="sub-header">Statistics</h2>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead></thead>
                        <tbody>
                            <tr><td>Number of customers</td><td style="text-align:right" id="n_cust"></td></tr>
                            <tr><td>Total demand</td><td style="text-align:right" id="total_demand"></td></tr>
                            <tr><td>Total tour length</td><td style="text-align:right" id="obj"></td></tr>
                            <tr><td colspan="2"><div id="obj-graph" style="width:95%"></div></td></tr>
                        </tbody>
                    </table>
                </div>
                <h2 class="sub-header">Vehicles</h2>
                <div class="table-responsive">
                    <table id="vehicle-table" class="table table-striped">
                        <thead><tr><td></td><td>Capacity</td><td id="load-heading">Load</td><td>Tour length</td><td>Status</td></tr></thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <div id="solver-controls">
                <h2 class="sub-header">Solver</h2>
                <div class="table-responsive">
            <div style="display:inline-block"><a id="solve-button" class="btn btn-lg btn-success" href="#" role="button" onclick="send();">Solve</a></div>
            <div style="display:inline-block" id="spinner"></div>
            <div>
                <!-- <a class="btn btn-danger" href="#" role="button" onclick="brokenRoutes=[11,15,19];">Crash</a> -->
                <!-- <a class="btn btn-primary" href="#" role="button" onclick="exportSolution();">Export solution</a> -->
                <div style="display:inline-block" class="checkbox"><label><input id="enforceobjective" type="checkbox" data-toggle="toggle"  checked=true>Enforce improvement</label></div>
                <div style="display:inline-block" class="checkbox"><label><input id="do_lns" type="checkbox" data-toggle="toggle"  checked=true>LNS</label></div>
                <div style="display:inline-block" class="checkbox"><label><input id="random_search" type="checkbox" data-toggle="toggle">Random</label></div>
            </div>
            <div>
                <div class="input-group">
                    <span class="input-group-addon">Timeout (ms)</span>
                    <input class="form-control" id="timeout" type="number" value="5000">
                </div>
            </div>
            </div>
            <div style="margin-top:50px;">
                <a href="http://www.minizinc.org/">
                <img src="../MiniZn_logo.jpg" height="80"></img>
                </a>
                <span style="margin-left:30px"></span>
                <a href="http://www.gecode.org/">
                <img src="gecode-logo-120.png" height="80"></img>
                </a>
            </div>
            </div>
        </div>
    </div>
    <div id="modalhelp" class="modal" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h2 class="modal-title">Interactive Optimisation for Vehicle Routing</h4>
                </div>
                <div class="modal-body">
                    <h4>The problem</h4>
                    <p>In this demo, we are solving multi-day vehicle routing problems. The task is to manage a fleet
                        of trucks that need to visit customers over the course of several days. All trucks start at
                        the same depot (marked in the middle as a black circle). Customers follow a certain visiting pattern,
                        e.g. some customers need to be visited each day, while others require fewer visits.
                    </p>
                    <p>Each customer has a fixed demand (e.g. the weight or size of the delivery), while each truck has a fixed capacity.
                       The goal is to minimise the total travel distance, visiting all customers as required by
                       their visiting patterns, and respecting the capacity constraints of the trucks.
                    </p>
                    <h4>Interactivity</h4>
                    <p>Our experience is that many optimisation problems can only be solved satisfactorily if
                        <em>expert users</em> are able to <em>interact</em> with the optimisation tools:
                        <ul>
                            <li>When requirements change (e.g. a vehicle becomes unavailable), experts may need
                                to explore different options and guide the tool towards a fix for the problem.
                            <li>Many problems have no clear definition of solution quality, e.g. when there are
                                conflicting objectives (minimise the travel distance or the number of trucks?).
                                Experts may want to explore, evaluate and combine different
                                <em>what-if scenarios</em> to come up with an acceptable compromise.
                            <li>Some optimisation problems require <em>human sign-off</em>, in particular
                                when important, far-reaching decisions have to be made (e.g. planning medical
                                procedures or long-term strategic projects). It is important to provide interactive
                                feedback and exploration of the solution space so that expert users can feel
                                confident about the solution they are proposing to implement.
                        </ul>
                    </p>
                    <p>The interactive interface in this demo allows you to optimise individual days or
                        individual routes in cooperation with our backend solving technology. You can also disable
                        individual trucks on individual days and work together with the solver to come up with a new
                        plan.
                    </p>
                    <p>Our technology is not limited to solving Vehicle Routing Problems. We just chose this application
                        because it demonstrates nicely what we are doing. The same ideas can be applied to other
                        optimisation domains such as production scheduling, timetabling, or staff rostering problems.
                    </p>
                    <h4>Try it out!</h4>
                    <p>To get started, load a scenario from the <em>Load data</em> menu. At any time, click
                        the <em>Help!</em> button to find out about all the user interface elements.
                    </p>
                    <h4>Technology</h4>
                    <p>The demo is based on technology developed at Monash University and NICTA/Data61.</p>
                    <a style="float:right; margin-left: 10px;" href="http://www.minizinc.org/">
                    <img src="../MiniZn_logo.jpg" height="60"></img>
                    </a>
                    <p>
                        The vehicle routing problem is modelled in <a href="http://www.minizinc.org/">MiniZinc</a>,
                        an expressive constraint modelling language. The model represents the requirements of vehicle
                        routing in a high-level, easily maintainable way. It also expresses how the user can interact
                        with the problem at the specification level, defining what it means to e.g. fix a day, update
                        a single route, or disable a vehicle.
                    </p>
                    <p>
                        <a style="float:right; margin-left: 10px;" href="http://www.gecode.org/">
                        <img src="gecode-logo-120.png" height="60"></img>
                        </a>
                        The MiniZinc model is executed using <a href="http://www.gecode.org/">Gecode</a>, an efficient,
                        open-source solver based on Constraint Programming algorithms. The solver iteratively improves an
                        existing solution by keeping parts of it fixed and searching through the remaining options
                        (a technique called <em>Large Neighbourhood Search</em>).
                    </p>
                    <p>The front-end is implemented in JavaScript and HTML, which is interacting through a WebSocket-based
                        interface with a web service implemented in Haskell.
                    </p>
                    <h4>Contact</h4>
                    <p>Guido Tack<br>Email: <a href="mailto:guido.tack@monash.edu">guido.tack@monash.edu</a><br>
                        Phone: +61 (3) 9903 1214
                    </p>
                </div>
                <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
