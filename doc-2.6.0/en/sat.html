

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.7. Boolean Satisfiability Modelling in MiniZinc &mdash; The MiniZinc Handbook 2.5.6</title>
  

  
  
  
  
    <link rel="canonical" href="http://www.minizinc.org/doc-latest/en/sat.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="static/style.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2.8. FlatZinc and Flattening" href="flattening.html" />
    <link rel="prev" title="2.6. Effective Modelling Practices in MiniZinc" href="efficient.html" />
    <link rel="apple-touch-icon" sizes="57x57" href="static/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="static/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="static/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="static/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="static/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="static/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="static/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="static/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="static/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="static/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="static/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/favicon/favicon-16x16.png">
    <link rel="manifest" href="static/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="static/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">


  
  <script src="static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="http://www.minizinc.org">
          
            
            <img src="static/MiniZn_logo_2.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
              <div class="version">
                2.5.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            <a href="index.html" class="reference internal icon icon-home"> The MiniZinc Handbook </a>
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="part_1_overview.html">1. Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="part_2_tutorial.html">2. A MiniZinc Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="modelling.html">2.1. Basic Modelling in MiniZinc</a></li>
<li class="toctree-l2"><a class="reference internal" href="modelling2.html">2.2. More Complex Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="predicates.html">2.3. Predicates and Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="optiontypes.html">2.4. Option Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="mzn_search.html">2.5. Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="efficient.html">2.6. Effective Modelling Practices in MiniZinc</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.7. Boolean Satisfiability Modelling in MiniZinc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modelling-integers">2.7.1. Modelling Integers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modelling-disequality">2.7.2. Modelling Disequality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modelling-cardinality">2.7.3. Modelling Cardinality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flattening.html">2.8. FlatZinc and Flattening</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="part_3_user_manual.html">3. User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="part_4_reference.html">4. Reference Manual</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">The MiniZinc Handbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="part_2_tutorial.html">2. A MiniZinc Tutorial</a> &raquo;</li>
        
      <li>2.7. Boolean Satisfiability Modelling in MiniZinc</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="boolean-satisfiability-modelling-in-minizinc">
<span id="sec-sat"></span><h1>2.7. Boolean Satisfiability Modelling in MiniZinc<a class="headerlink" href="#boolean-satisfiability-modelling-in-minizinc" title="Permalink to this headline">¶</a></h1>
<p>MiniZinc can be used to model Boolean satisfiability
problems where the variables are restricted to be Boolean (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">bool</span><span class="s"></span></code>).
MiniZinc can be used with efficient Boolean satisfiability
solvers to solve the resulting models efficiently.</p>
<div class="section" id="modelling-integers">
<h2>2.7.1. Modelling Integers<a class="headerlink" href="#modelling-integers" title="Permalink to this headline">¶</a></h2>
<p>Many times although we wish to use a Boolean satisfiability solver we may
need to model some integer parts of our problem.</p>
<p>There are three common ways of modelling an integer variables
<span class="math notranslate nohighlight">\(I\)</span> in the range <span class="math notranslate nohighlight">\(0 \dots m\)</span> where <span class="math notranslate nohighlight">\(m = 2^{k}-1\)</span>
using Boolean
variables.</p>
<ul>
<li><p class="first">Binary: <span class="math notranslate nohighlight">\(I\)</span> is represented by <span class="math notranslate nohighlight">\(k\)</span> binary variables
<span class="math notranslate nohighlight">\(i_0, \ldots, i_{k-1}\)</span> where
<span class="math notranslate nohighlight">\(I = 2^{k-1} i_{k-1} + 2^{k-2} i_{k-2} + \cdots + 2 i_1 + i_0\)</span>.
This can be represented in MiniZinc as</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">k</span><span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="s">  </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">i</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nb">pow</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">:</span><span class="s"> </span><span class="nv">I</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">k</span><span class="o">-</span><span class="m">1</span><span class="p">)(</span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">])</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nv">j</span><span class="p">));</span><span class="s"></span>
</pre></div>
</div>
</li>
<li><p class="first">Unary: where <span class="math notranslate nohighlight">\(I\)</span> is represented by <span class="math notranslate nohighlight">\(m\)</span> binary variables
<span class="math notranslate nohighlight">\(i_1, \ldots, i_m\)</span>
and <span class="math notranslate nohighlight">\(i = \sum_{j=1}^m \mathtt{bool2int}(i_j)\)</span>.  Since there is massive redundancy in
the unary representation we usually require that
<span class="math notranslate nohighlight">\(i_j \rightarrow i_{j-1}, 1 &lt; j \leq m\)</span>. This can be represented in MiniZinc as</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">m</span><span class="p">]</span><span class="s">  </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">i</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">2</span><span class="o">..</span><span class="nv">m</span><span class="p">)(</span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">-&gt;</span><span class="s"> </span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="o">-</span><span class="m">1</span><span class="p">]);</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">:</span><span class="s"> </span><span class="nv">I</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">m</span><span class="p">)(</span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">]);</span><span class="s"></span>
</pre></div>
</div>
</li>
<li><p class="first">Value: where <span class="math notranslate nohighlight">\(I\)</span> is represented by <span class="math notranslate nohighlight">\(m+1\)</span> binary variables
<span class="math notranslate nohighlight">\(i_0, \ldots, i_m\)</span> where
<span class="math notranslate nohighlight">\(I = k \Leftrightarrow i_k\)</span>, and at most one of <span class="math notranslate nohighlight">\(i_0, \ldots, i_m\)</span> is true.
This can be represented in MiniZinc as</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">]</span><span class="s">  </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">i</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">)(</span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">:</span><span class="s"> </span><span class="nv">I</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">)(</span><span class="nv">I</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">&lt;-&gt;</span><span class="s"> </span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">]);</span><span class="s"></span>
</pre></div>
</div>
</li>
</ul>
<p>There are advantages and disadvantages to each representation.  It depends
on what operations on integers are to required in the model as to which is
preferable.</p>
</div>
<div class="section" id="modelling-disequality">
<h2>2.7.2. Modelling Disequality<a class="headerlink" href="#modelling-disequality" title="Permalink to this headline">¶</a></h2>
<p>Let us consider modelling a latin squares problem. A latin square
is an <span class="math notranslate nohighlight">\(n \times n\)</span> grid of numbers from <span class="math notranslate nohighlight">\(1..n\)</span> such that
each number appears exactly once in every row and column.
An integer model for latin squares is shown in <a class="reference internal" href="#ex-latin"><span class="std std-numref">Listing 2.7.1</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-latin">
<div class="code-block-caption"><span class="caption-number">Listing 2.7.1 </span><span class="caption-text">Integer model for Latin Squares (<a class="reference download internal" href="downloads/latin.mzn" download=""><tt class="xref download docutils literal">latin.mzn</tt></a>).</span><a class="headerlink" href="#ex-latin" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s"> </span><span class="c">% size of latin square</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">:</span><span class="s"> </span><span class="nv">a</span><span class="p">;</span><span class="s"></span>

<span class="k">include</span><span class="s"> &quot;alldifferent.mzn&quot;</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="s"></span>
<span class="s">             </span><span class="nf">alldifferent</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">             </span><span class="nf">alldifferent</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">j</span><span class="p">,</span><span class="nv">i</span><span class="p">])</span><span class="s"></span>
<span class="s">           </span><span class="p">);</span><span class="s"></span>
<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>
<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">n</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot; &quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span><span class="s"></span>
<span class="s">         </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="s"> </span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The only constraint on the integers is in fact disequality, which is encoded
in the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">alldifferent</span><span class="s"></span></code> constraint.
The value representation is the best way of representing disequality.
A Boolean only model for latin squares is shown in
<a class="reference internal" href="#ex-latinbool"><span class="std std-numref">Listing 2.7.2</span></a>.
Note each integer array element <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"></span></code> is replaced by an array of
Booleans.
We use the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">exactlyone</span><span class="s"></span></code> predicate to encode that each value is used
exactly once in every row and every column, as well as to encode that exactly
one of the Booleans corresponding to integer array element <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"></span></code> is true.</p>
<div class="literal-block-wrapper docutils container" id="ex-latinbool">
<div class="code-block-caption"><span class="caption-number">Listing 2.7.2 </span><span class="caption-text">Boolean model for Latin Squares (<a class="reference download internal" href="downloads/latinbool.mzn" download=""><tt class="xref download docutils literal">latinbool.mzn</tt></a>).</span><a class="headerlink" href="#ex-latinbool" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s"> </span><span class="c">% size of latin square</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">a</span><span class="p">;</span><span class="s"></span>

<span class="k">predicate</span><span class="s"> </span><span class="nf">atmostone</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="p">)(</span><span class="s"></span>
<span class="s">            </span><span class="p">(</span><span class="o">not</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">j</span><span class="p">]));</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">exactlyone</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">          </span><span class="nf">atmostone</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="k">exists</span><span class="p">(</span><span class="nv">x</span><span class="p">);</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="s"></span>
<span class="s">             </span><span class="nf">exactlyone</span><span class="p">(</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">             </span><span class="nf">exactlyone</span><span class="p">(</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">             </span><span class="nf">exactlyone</span><span class="p">(</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">k</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"></span>
<span class="s">           </span><span class="p">);</span><span class="s"></span>
<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>
<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nb">fix</span><span class="p">(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">])</span><span class="s"> </span><span class="k">then</span><span class="s"></span>
<span class="s">            </span><span class="nb">show</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">n</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot; &quot; </span><span class="k">endif</span><span class="s"> </span>
<span class="s">         </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="s"> </span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="modelling-cardinality">
<h2>2.7.3. Modelling Cardinality<a class="headerlink" href="#modelling-cardinality" title="Permalink to this headline">¶</a></h2>
<p>Let us consider modelling the Light Up puzzle. The puzzle consists of a
rectangular grid of squares which are blank, or filled. Every filled square
may contain a number from 1 to 4, or may have no number. The aim is to place
lights
in the blank squares so that</p>
<ul class="simple">
<li>Each blank square is “illuminated”, that is can see a light through an
uninterrupted line of blank squares</li>
<li>No two lights can see each other</li>
<li>The number of lights adjacent to a numbered filled square
is exactly the number in the filled square.</li>
</ul>
<p>An example of a Light Up puzzle is shown in <a class="reference internal" href="#fig-lightup"><span class="std std-numref">Fig. 2.7.1</span></a>
with its solution in <a class="reference internal" href="#fig-lightup-sol"><span class="std std-numref">Fig. 2.7.2</span></a>.</p>
<div class="figure" id="id1">
<span id="fig-lightup"></span><img alt="images/lightup.svg" src="images/lightup.svg" /><p class="caption"><span class="caption-number">Fig. 2.7.1 </span><span class="caption-text">An example of a Light Up puzzle</span></p>
</div>
<div class="figure" id="id2">
<span id="fig-lightup-sol"></span><img alt="images/lightup2.svg" src="images/lightup2.svg" /><p class="caption"><span class="caption-number">Fig. 2.7.2 </span><span class="caption-text">The completed solution of the Light Up puzzle</span></p>
</div>
<p>It is natural to model this problem
using Boolean variables to determine which
squares contain a light and which do not, but there is some integer
arithmetic to consider for the filled squares.</p>
<div class="literal-block-wrapper docutils container" id="ex-lightup">
<div class="code-block-caption"><span class="caption-number">Listing 2.7.3 </span><span class="caption-text">SAT Model for the Light Up puzzle (<a class="reference download internal" href="downloads/lightup.mzn" download=""><tt class="xref download docutils literal">lightup.mzn</tt></a>).</span><a class="headerlink" href="#ex-lightup" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">h</span><span class="p">;</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">H</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">h</span><span class="p">;</span><span class="s"> </span><span class="c">% board height</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">w</span><span class="p">;</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">w</span><span class="p">;</span><span class="s"> </span><span class="c">% board width</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">H</span><span class="p">,</span><span class="nv">W</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="o">..</span><span class="m">5</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="p">;</span><span class="s">       </span><span class="c">% board</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">;</span><span class="s">                  </span><span class="c">% empty square</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">N</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">4</span><span class="p">;</span><span class="s">         </span><span class="c">% filled and numbered square</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">F</span><span class="s"> </span><span class="o">=</span><span class="s">  </span><span class="m">5</span><span class="p">;</span><span class="s">                  </span><span class="c">% filled unnumbered square</span><span class="s"></span>

<span class="c">% position (i1,j1) is visible to (i2,j2)</span><span class="s"></span>
<span class="k">test</span><span class="s"> </span><span class="nf">visible</span><span class="p">(</span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">i1</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">j1</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">i2</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">j2</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s">    </span><span class="p">((</span><span class="nv">i1</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">i2</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">min</span><span class="p">(</span><span class="nv">j1</span><span class="p">,</span><span class="nv">j2</span><span class="p">)</span><span class="s">..</span><span class="nb">max</span><span class="p">(</span><span class="nv">j1</span><span class="p">,</span><span class="nv">j2</span><span class="p">))(</span><span class="nv">b</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="p">))</span><span class="s"></span>
<span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="p">((</span><span class="nv">j1</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">j2</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">min</span><span class="p">(</span><span class="nv">i1</span><span class="p">,</span><span class="nv">i2</span><span class="p">)</span><span class="s">..</span><span class="nb">max</span><span class="p">(</span><span class="nv">i1</span><span class="p">,</span><span class="nv">i2</span><span class="p">))(</span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="p">));</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">H</span><span class="p">,</span><span class="nv">W</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">l</span><span class="p">;</span><span class="s"> </span><span class="c">% is there a light</span><span class="s"></span>

<span class="c">% filled squares have no lights</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">E</span><span class="p">)(</span><span class="nv">l</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">);</span><span class="s"></span>
<span class="c">% lights next to filled numbered square agree</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">N</span><span class="p">)(</span><span class="s"></span>
<span class="s">    </span><span class="nf">bool_sum_eq</span><span class="p">([</span><span class="s"> </span><span class="nv">l</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j1</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="o">..</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="nv">j1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">j</span><span class="o">-</span><span class="m">1</span><span class="o">..</span><span class="nv">j</span><span class="o">+</span><span class="m">1</span><span class="s"> </span><span class="k">where</span><span class="s"></span>
<span class="s">                             </span><span class="nb">abs</span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">i</span><span class="p">)</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nb">abs</span><span class="p">(</span><span class="nv">j1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">j</span><span class="p">)</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">                             </span><span class="nv">i1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">j1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="p">],</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]));</span><span class="s"></span>
<span class="c">% each blank square is illuminated</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="p">)(</span><span class="s"></span>
<span class="s">             </span><span class="k">exists</span><span class="p">(</span><span class="nv">j1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nf">visible</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j1</span><span class="p">))(</span><span class="nv">l</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j1</span><span class="p">])</span><span class="s"> </span><span class="o">\/</span><span class="s"></span>
<span class="s">             </span><span class="k">exists</span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nf">visible</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j</span><span class="p">))(</span><span class="nv">l</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span>
<span class="s">           </span><span class="p">);</span><span class="s"></span>
<span class="c">% no two lights see each other</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i1</span><span class="p">,</span><span class="nv">i2</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j1</span><span class="p">,</span><span class="nv">j2</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span>
<span class="s">                  </span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">i2</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">j1</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">j2</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span>
<span class="s">                  </span><span class="o">/\</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i2</span><span class="p">,</span><span class="nv">j2</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">visible</span><span class="p">(</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j1</span><span class="p">,</span><span class="nv">i2</span><span class="p">,</span><span class="nv">j2</span><span class="p">))(</span><span class="s"></span>
<span class="s">             </span><span class="o">not</span><span class="s"> </span><span class="nv">l</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j1</span><span class="p">]</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="nv">l</span><span class="p">[</span><span class="nv">i2</span><span class="p">,</span><span class="nv">j2</span><span class="p">]</span><span class="s"></span>
<span class="s">           </span><span class="p">);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>
<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"></span>
<span class="s">         </span><span class="k">else</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nb">fix</span><span class="p">(</span><span class="nv">l</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;L&quot; </span><span class="k">else</span><span class="s"> &quot;.&quot; </span><span class="k">endif</span><span class="s"></span>
<span class="s">         </span><span class="k">endif</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">w</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot; &quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span><span class="s"></span>
<span class="s">         </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>A model for the problem is given in <a class="reference internal" href="#ex-lightup"><span class="std std-numref">Listing 2.7.3</span></a>.
A data file for the problem shown in <a class="reference internal" href="#fig-lightup"><span class="std std-numref">Fig. 2.7.1</span></a>
is shown in <a class="reference internal" href="#fig-lightupdzn"><span class="std std-numref">Listing 2.7.4</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="fig-lightupdzn">
<div class="code-block-caption"><span class="caption-number">Listing 2.7.4 </span><span class="caption-text">Datafile for the Light Up puzzle instance shown in <a class="reference internal" href="#fig-lightup"><span class="std std-numref">Fig. 2.7.1</span></a>.</span><a class="headerlink" href="#fig-lightupdzn" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">h</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">7</span><span class="p">;</span><span class="s"></span>
<span class="nv">w</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">7</span><span class="p">;</span><span class="s"></span>
<span class="nv">b</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="s"> </span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="s"></span>
<span class="s">     </span><span class="p">|</span><span class="s">  </span><span class="m">0</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="s"></span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="s"></span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="s"></span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="s"></span>
<span class="s">     </span><span class="p">|</span><span class="s">  </span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="s"> </span><span class="p">|];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The model makes use of a Boolean sum predicate</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span><span class="s"> </span><span class="nf">bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>which requires that the sum of an array of Boolean equals some fixed
integer. There are a number of ways of modelling such
<em>cardinality</em> constraints using Booleans.</p>
<ul class="simple">
<li>Adder networks: we can use a network of adders to
build a binary Boolean representation of the sum of the Booleans</li>
<li>Sorting networks: we can use a sorting network to sort
the array of Booleans to create a unary representation of the sum
of the Booleans</li>
<li>Binary decision diagrams: we can create a binary decision diagram
(BDD) that encodes the cardinality constraint.</li>
</ul>
<div class="literal-block-wrapper docutils container" id="ex-bboolsum">
<div class="code-block-caption"><span class="caption-number">Listing 2.7.5 </span><span class="caption-text">Cardinality constraints by binary adder networks (<a class="reference download internal" href="downloads/bboolsum.mzn" download=""><tt class="xref download docutils literal">bboolsum.mzn</tt></a>).</span><a class="headerlink" href="#ex-bboolsum" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% the sum of booleans x = s</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">false</span><span class="s"> </span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"></span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">)</span><span class="s"></span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">then</span><span class="s"></span>
<span class="s">          </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="c">% cp = number of bits required for representing 0..c</span><span class="s"></span>
<span class="s">                </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">cp</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">floor</span><span class="p">(</span><span class="nb">log2</span><span class="p">(</span><span class="nb">int2float</span><span class="p">(</span><span class="nv">c</span><span class="p">))),</span><span class="s"></span>
<span class="s">                </span><span class="c">% z is sum of x in binary </span><span class="s"></span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">z</span><span class="s">  </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">          </span><span class="nf">binary_sum</span><span class="p">(</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="nv">z</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span>
<span class="s">          </span><span class="c">% z == s</span><span class="s"></span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">cp</span><span class="p">)(</span><span class="nv">z</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="p">((</span><span class="nv">s</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="nb">pow</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nv">i</span><span class="p">))</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="p">))</span><span class="s"> </span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">then</span><span class="s"></span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="p">)</span><span class="s"></span>
<span class="s">     </span><span class="k">else</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>

<span class="k">include</span><span class="s"> &quot;binarysum.mzn&quot;</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="ex-binarysum">
<div class="code-block-caption"><span class="caption-number">Listing 2.7.6 </span><span class="caption-text">Code for building binary addition networks (<a class="reference download internal" href="downloads/binarysum.mzn" download=""><tt class="xref download docutils literal">binarysum.mzn</tt></a>).</span><a class="headerlink" href="#ex-binarysum" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% the sum of bits x = s in binary. </span><span class="s"></span>
<span class="c">%            s[0], s[1], ..., s[k] where 2^k &gt;= length(x) &gt; 2^(k-1)</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">binary_sum</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span>
<span class="s">                     </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="o">=</span><span class="s"></span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"></span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="k">then</span><span class="s"> </span>
<span class="s">             </span><span class="nv">s</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">xor</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="s"></span>
<span class="s">     </span><span class="k">else</span><span class="s"> </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">ll</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">l</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">),</span><span class="s"></span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">ll</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">f</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">ll</span><span class="s"> </span><span class="p">],</span><span class="s"> </span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">ll</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">ll</span><span class="o">+</span><span class="m">1</span><span class="o">..</span><span class="m">2</span><span class="o">*</span><span class="nv">ll</span><span class="p">],</span><span class="s"></span>
<span class="s">                </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">ll</span><span class="o">*</span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">l</span><span class="p">]</span><span class="s"> </span><span class="k">endif</span><span class="p">,</span><span class="s"></span>
<span class="s">                </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">cp</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">floor</span><span class="p">(</span><span class="nb">log2</span><span class="p">(</span><span class="nb">int2float</span><span class="p">(</span><span class="nv">ll</span><span class="p">))),</span><span class="s"></span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">fs</span><span class="p">,</span><span class="s"></span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">ts</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">                </span><span class="nf">binary_sum</span><span class="p">(</span><span class="nv">f</span><span class="p">,</span><span class="s"> </span><span class="nv">fs</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">binary_sum</span><span class="p">(</span><span class="nv">t</span><span class="p">,</span><span class="s"> </span><span class="nv">ts</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">                </span><span class="nf">binary_add</span><span class="p">(</span><span class="nv">fs</span><span class="p">,</span><span class="s"> </span><span class="nv">ts</span><span class="p">,</span><span class="s"> </span><span class="nv">b</span><span class="p">,</span><span class="s"> </span><span class="nv">s</span><span class="p">)</span><span class="s"></span>
<span class="s">     </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>

<span class="c">% add two binary numbers x, and y and carry in bit ci to get binary s</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">binary_add</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"></span>
<span class="s">                     </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">,</span><span class="s"></span>
<span class="s">                     </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">ci</span><span class="p">,</span><span class="s"></span>
<span class="s">                     </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">    </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">l</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">),</span><span class="s"> </span>
<span class="s">          </span><span class="kt">int</span><span class="p">:</span><span class="nv">n</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">s</span><span class="p">),</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s">  </span>
<span class="s">    </span><span class="nb">assert</span><span class="p">(</span><span class="nv">l</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">y</span><span class="p">),</span><span class="s"></span>
<span class="s">          &quot;length of binary_add input args must be same&quot;</span><span class="p">,</span><span class="s"></span>
<span class="s">    </span><span class="nb">assert</span><span class="p">(</span><span class="nv">n</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">n</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">l</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="s"> &quot;length of binary_add output &quot; </span><span class="o">++</span><span class="s"></span>
<span class="s">                         &quot;must be equal or one more than inputs&quot;</span><span class="p">,</span><span class="s"></span>
<span class="s">    </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">l</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">    </span><span class="nf">full_adder</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="s"> </span><span class="nv">y</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="s"> </span><span class="nv">ci</span><span class="p">,</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="m">0</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">l</span><span class="p">)(</span><span class="nf">full_adder</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="s"> </span><span class="nv">y</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="p">],</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="nv">i</span><span class="p">]))</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">    </span><span class="k">if</span><span class="s"> </span><span class="nv">n</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">n</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="nv">l</span><span class="p">]</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="nv">l</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">endif</span><span class="s"> </span><span class="p">));</span><span class="s"></span>
<span class="s">    </span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">full_adder</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">ci</span><span class="p">,</span><span class="s"></span>
<span class="s">                     </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">co</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">          </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">xy</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">xor</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span>
<span class="s">          </span><span class="nv">s</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">xy</span><span class="s"> </span><span class="o">xor</span><span class="s"> </span><span class="nv">ci</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">co</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">((</span><span class="nv">x</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">y</span><span class="p">)</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="p">(</span><span class="nv">ci</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">xy</span><span class="p">));</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>We can implement <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">bool_sum_eq</span><span class="s"></span></code> using binary adder networks
using the code shown in <a class="reference internal" href="#ex-bboolsum"><span class="std std-numref">Listing 2.7.5</span></a>.
The predicate <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">binary_sum</span><span class="s"></span></code>
defined in <a class="reference internal" href="#ex-binarysum"><span class="std std-numref">Listing 2.7.6</span></a>
creates a binary representation
of the sum of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> by splitting the list into two,
summing up each half to create a binary representation
and then summing these two binary numbers using <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">binary_add</span><span class="s"></span></code>.
If the list <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> is odd the last bit is saved to use as a carry in
to the binary addition.</p>
<div class="literal-block-wrapper docutils container" id="ex-uboolsum">
<div class="code-block-caption"><span class="caption-number">Listing 2.7.7 </span><span class="caption-text">Cardinality constraints by sorting networks (<a class="reference download internal" href="downloads/uboolsum.mzn" download=""><tt class="xref download docutils literal">uboolsum.mzn</tt></a>).</span><a class="headerlink" href="#ex-uboolsum" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% the sum of booleans x = s</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">false</span><span class="s"> </span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">)</span><span class="s"></span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">then</span><span class="s"></span>
<span class="s">          </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="c">% cp = nearest power of 2 &gt;= c</span><span class="s"></span>
<span class="s">                </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">cp</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">pow</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nb">ceil</span><span class="p">(</span><span class="nb">log2</span><span class="p">(</span><span class="nb">int2float</span><span class="p">(</span><span class="nv">c</span><span class="p">)))),</span><span class="s"></span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">y</span><span class="p">,</span><span class="s"> </span><span class="c">% y is padded version of x</span><span class="s"></span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">z</span><span class="s">  </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">y</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">c</span><span class="o">+</span><span class="m">1</span><span class="o">..</span><span class="nv">cp</span><span class="p">)(</span><span class="nv">y</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">          </span><span class="nf">oesort</span><span class="p">(</span><span class="nv">y</span><span class="p">,</span><span class="s"> </span><span class="nv">z</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">z</span><span class="p">[</span><span class="nv">s</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">z</span><span class="p">[</span><span class="nv">s</span><span class="o">+</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="s"></span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="p">)</span><span class="s"></span>
<span class="s">     </span><span class="k">else</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>

<span class="k">include</span><span class="s"> &quot;oesort.mzn&quot;</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="ex-oesort">
<div class="code-block-caption"><span class="caption-number">Listing 2.7.8 </span><span class="caption-text">Odd-even merge sorting networks (<a class="reference download internal" href="downloads/oesort.mzn" download=""><tt class="xref download docutils literal">oesort.mzn</tt></a>).</span><a class="headerlink" href="#ex-oesort" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">%% odd-even sort</span><span class="s"></span>
<span class="c">%% y is the sorted version of x, all trues before falses</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">oesort</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">y</span><span class="p">)</span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">card</span><span class="p">(</span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">))</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span>
<span class="s">  </span><span class="k">elseif</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nf">comparator</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="nv">x</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="s"></span>
<span class="s">  </span><span class="k">else</span><span class="s"></span>
<span class="s">    </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span>
<span class="s">      </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">xf</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">],</span><span class="s"></span>
<span class="s">      </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">xl</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">+</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">],</span><span class="s"></span>
<span class="s">      </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">tf</span><span class="p">,</span><span class="s"></span>
<span class="s">      </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">tl</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">    </span><span class="nf">oesort</span><span class="p">(</span><span class="nv">xf</span><span class="p">,</span><span class="nv">tf</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">oesort</span><span class="p">(</span><span class="nv">xl</span><span class="p">,</span><span class="nv">tl</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">oemerge</span><span class="p">(</span><span class="nv">tf</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="nv">tl</span><span class="p">,</span><span class="s"> </span><span class="nv">y</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>

<span class="c">%% odd-even merge</span><span class="s"></span>
<span class="c">%% y is the sorted version of x, all trues before falses</span><span class="s"></span>
<span class="c">%% assumes first half of x is sorted, and second half of x</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">oemerge</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">y</span><span class="p">)</span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">card</span><span class="p">(</span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">))</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span>
<span class="s">  </span><span class="k">elseif</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nf">comparator</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="nv">x</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="s"></span>
<span class="s">  </span><span class="k">else</span><span class="s"></span>
<span class="s">    </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">xo</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s">            </span><span class="p">[</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="p">],</span><span class="s"></span>
<span class="s">          </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">xe</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s">            </span><span class="p">[</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="p">],</span><span class="s"></span>
<span class="s">          </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">to</span><span class="p">,</span><span class="s"></span>
<span class="s">          </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">te</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">      </span><span class="nf">oemerge</span><span class="p">(</span><span class="nv">xo</span><span class="p">,</span><span class="nv">to</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">oemerge</span><span class="p">(</span><span class="nv">xe</span><span class="p">,</span><span class="nv">te</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">      </span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">to</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">      </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">)(</span><span class="s"></span>
<span class="s">        </span><span class="nf">comparator</span><span class="p">(</span><span class="nv">te</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="nv">to</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">2</span><span class="o">*</span><span class="nv">i</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">2</span><span class="o">*</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">]))</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span>
<span class="s">      </span><span class="nv">y</span><span class="p">[</span><span class="nv">c</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">te</span><span class="p">[</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"></span>
<span class="s">  </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>
<span class="s"> </span>
<span class="c">% comparator o1 = max(i1,i2), o2 = min(i1,i2)</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">comparator</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">i1</span><span class="p">,</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">i2</span><span class="p">,</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">o1</span><span class="p">,</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">o2</span><span class="p">)</span><span class="o">=</span><span class="s"></span>
<span class="s">          </span><span class="p">(</span><span class="nv">o1</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">i2</span><span class="p">))</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="p">(</span><span class="nv">o2</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">i2</span><span class="p">));</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>We can implement <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">bool_sum_eq</span><span class="s"></span></code> using unary sorting networks
using the code shown in <a class="reference internal" href="#ex-uboolsum"><span class="std std-numref">Listing 2.7.7</span></a>.
The cardinality constraint is defined by expanding the input
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> to have length a power of 2, and sorting the resulting bits
using an odd-even merge sorting network.
The odd-even merge sorter shown in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">ex</span><span class="o">-</span><span class="nv">oesort</span><span class="s"></span></code> works
recursively by splitting
the input list in 2, sorting each list and merging the two
sorted lists.</p>
<div class="literal-block-wrapper docutils container" id="ex-bddsum">
<div class="code-block-caption"><span class="caption-number">Listing 2.7.9 </span><span class="caption-text">Cardinality constraints by binary decision diagrams (<a class="reference download internal" href="downloads/bddsum.mzn" download=""><tt class="xref download docutils literal">bddsum.mzn</tt></a>).</span><a class="headerlink" href="#ex-bddsum" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% the sum of booleans x = s</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">),</span><span class="s"></span>
<span class="s">           </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">)]</span><span class="s"> </span>
<span class="s">     </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">     </span><span class="nf">rec_bool_sum_eq</span><span class="p">(</span><span class="nv">y</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="nv">s</span><span class="p">);</span><span class="s"></span>

<span class="k">predicate</span><span class="s"> </span><span class="nf">rec_bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">f</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">false</span><span class="s"> </span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"></span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">f</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">)</span><span class="s"></span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">f</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span><span class="s"></span>
<span class="s">          </span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="nv">f</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">rec_bool_sum_eq</span><span class="p">(</span><span class="nv">x</span><span class="p">,</span><span class="nv">f</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="nv">s</span><span class="o">-</span><span class="m">1</span><span class="p">))</span><span class="s"> </span><span class="o">\/</span><span class="s"></span>
<span class="s">          </span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="nv">f</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">rec_bool_sum_eq</span><span class="p">(</span><span class="nv">x</span><span class="p">,</span><span class="nv">f</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="nv">s</span><span class="p">))</span><span class="s"></span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">f</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span><span class="s"></span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">f</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="p">)</span><span class="s"></span>
<span class="s">     </span><span class="k">else</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>We can implement <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">bool_sum_eq</span><span class="s"></span></code> using binary decision diagrams
using the code shown in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">ex</span><span class="p">:</span><span class="nv">bddsum</span><span class="s"></span></code>.
The cardinality constraint is broken into two cases:
either the first element <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"></span></code> is <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="l">true</span><span class="s"></span></code>,
and the sum of the remaining bits
is <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s</span><span class="o">-</span><span class="m">1</span><span class="s"></span></code>, or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"></span></code> is <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="l">false</span><span class="s"></span></code> and the sum of the remaining bits
is <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s</span><span class="s"></span></code>. For efficiency this relies on common subexpression elimination
to avoid creating many equivalent constraints.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="flattening.html" class="btn btn-neutral float-right" title="2.8. FlatZinc and Flattening" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="efficient.html" class="btn btn-neutral" title="2.6. Effective Modelling Practices in MiniZinc" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, 2017, 2018, 2019, 2020 Peter J. Stuckey, Kim Marriott, Guido Tack.

    </p>
  </div>
<a rel="license" href="http://creativecommons.org/licenses/by-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nd/4.0/80x15.png" /></a>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.5.6',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="static/jquery.js"></script>
      <script type="text/javascript" src="static/underscore.js"></script>
      <script type="text/javascript" src="static/doctools.js"></script>
      <script type="text/javascript" src="static/js/doc-links.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>