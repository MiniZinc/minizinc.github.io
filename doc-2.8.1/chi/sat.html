<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.8. 在MiniZinc中对布尔可满足性问题建模 &mdash; The MiniZinc Handbook 2.8.1</title>
      <link rel="stylesheet" href="static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="static/style.css" type="text/css" />
    <link rel="canonical" href="http://www.minizinc.org/doc-latest/en/sat.html"/>
  <!--[if lt IE 9]>
    <script src="static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="static/jquery.js?v=5d32c60e"></script>
        <script src="static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="static/documentation_options.js?v=7e412534"></script>
        <script src="static/doctools.js?v=888ff710"></script>
        <script src="static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="static/js/doc-links.js?v=34cd1aa9"></script>
    <script src="static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2.9. FlatZinc和展平" href="flattening.html" />
    <link rel="prev" title="2.7. MiniZinc中的有效建模实践" href="efficient.html" />
    <link rel="apple-touch-icon" sizes="57x57" href="static/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="static/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="static/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="static/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="static/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="static/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="static/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="static/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="static/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="static/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="static/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/favicon/favicon-16x16.png">
    <link rel="manifest" href="static/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="static/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <a href="https://www.minizinc.org">
    
      <img src="static/MiniZn_logo_2.svg" class="logo" alt="Logo"/>
  </a>
      <div class="version">
        2.8.1
      </div>

  
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
  
    
  
  <a href="index.html" class="reference internal icon icon-home"> The MiniZinc Handbook </a>
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="part_1_overview.html">1. Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="part_2_tutorial.html">2. Minizinc 指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="modelling.html">2.1. MiniZinc基本模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="modelling2.html">2.2. 更多复杂模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="predicates.html">2.3. 谓词和函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="optiontypes.html">2.4. 选项类型</a></li>
<li class="toctree-l2"><a class="reference internal" href="tuple_and_record_types.html">2.5. Tuple and record types</a></li>
<li class="toctree-l2"><a class="reference internal" href="mzn_search.html">2.6. 搜索</a></li>
<li class="toctree-l2"><a class="reference internal" href="efficient.html">2.7. MiniZinc中的有效建模实践</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.8. 在MiniZinc中对布尔可满足性问题建模</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">2.8.1. 整型建模</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">2.8.2. 非等式建模</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">2.8.3. 势约束建模</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flattening.html">2.9. FlatZinc和展平</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="part_3_user_manual.html">3. User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="part_4_reference.html">4. Reference Manual</a></li>
</ul>

  

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">The MiniZinc Handbook</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="part_2_tutorial.html"><span class="section-number">2. </span>Minizinc 指南</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.8. </span>在MiniZinc中对布尔可满足性问题建模</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="minizinc">
<span id="sec-sat"></span><h1><span class="section-number">2.8. </span>在MiniZinc中对布尔可满足性问题建模<a class="headerlink" href="#minizinc" title="Link to this heading"></a></h1>
<p>MiniZinc 可以被用来给布尔可满足性问题建模，这种问题的变量被限制为是布尔型 (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">bool</span></code>)。MiniZinc 可以使用有效率的布尔可满足性求解器来有效地解决求得的模型。</p>
<section id="id1">
<h2><span class="section-number">2.8.1. </span>整型建模<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>很多时候，尽管我们想要使用一个布尔可满足性求解器，我们可能也需要给问题的 整数部分建模。
有三种通用的方式使用布尔型变量对定义域为范围 <span class="math notranslate nohighlight">\(0 \dots m\)</span> 内的整型变量 <span class="math notranslate nohighlight">\(I\)</span> 建模，其中 <span class="math notranslate nohighlight">\(m = 2^{k}-1\)</span> 。</p>
<ul>
<li><p>二元： <span class="math notranslate nohighlight">\(I\)</span> 被表示为 <span class="math notranslate nohighlight">\(k\)</span> 个二元变量 <span class="math notranslate nohighlight">\(i_0, \ldots, i_{k-1}\)</span> ，其中 <span class="math notranslate nohighlight">\(I = 2^{k-1} i_{k-1} + 2^{k-2} i_{k-2} + \cdots + 2 i_1 + i_0\)</span> 。在MiniZinc 中，这可表示为</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">k</span><span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="s">  </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">i</span><span class="p">;</span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nb">pow</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nv">k</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">:</span><span class="s"> </span><span class="nv">I</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">k</span><span class="o">-</span><span class="m">1</span><span class="p">)(</span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">])</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nv">j</span><span class="p">));</span>
</pre></div>
</div>
</li>
<li><p>一元: <span class="math notranslate nohighlight">\(I\)</span> 被表示为 <span class="math notranslate nohighlight">\(m\)</span> 个二元变量 <span class="math notranslate nohighlight">\(i_1, \ldots, i_m\)</span> 且 <span class="math notranslate nohighlight">\(i = \sum_{j=1}^m \mathtt{bool2int}(i_j)\)</span> 。由于在一元表 示中有大量的冗余表示，我们通常要求 <span class="math notranslate nohighlight">\(i_j \rightarrow i_{j-1}, 1 &lt; j \leq m\)</span> 。在MiniZinc中，这可表示为</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">m</span><span class="p">]</span><span class="s">  </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">i</span><span class="p">;</span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">2</span><span class="o">..</span><span class="nv">m</span><span class="p">)(</span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">-&gt;</span><span class="s"> </span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="o">-</span><span class="m">1</span><span class="p">]);</span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">:</span><span class="s"> </span><span class="nv">I</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">m</span><span class="p">)(</span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">]);</span>
</pre></div>
</div>
</li>
<li><p>值: 其中 <span class="math notranslate nohighlight">\(I\)</span> 被表示为 <span class="math notranslate nohighlight">\(m+1\)</span> 个二元变量 <span class="math notranslate nohighlight">\(i_0, \ldots, i_m\)</span> ，其中 <span class="math notranslate nohighlight">\(i = k \Leftrightarrow i_k\)</span> 并且 <span class="math notranslate nohighlight">\(i_0, \ldots, i_m\)</span> 中最多有一个为真。在MiniZinc中，这可表示为</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">]</span><span class="s">  </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">i</span><span class="p">;</span>
<span class="k">constraint</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">)(</span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="p">;</span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">:</span><span class="s"> </span><span class="nv">I</span><span class="p">;</span>
<span class="k">constraint</span><span class="s"> </span><span class="nf">foall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">m</span><span class="p">)(</span><span class="nv">I</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">&lt;-&gt;</span><span class="s"> </span><span class="nv">i</span><span class="p">[</span><span class="nv">j</span><span class="p">]);</span>
</pre></div>
</div>
</li>
</ul>
<p>每种表示都有其优点和缺点。这取决于模型中需要对整数做什么样的操作，而这些 操作在哪一种表示上更为方便。</p>
</section>
<section id="id2">
<h2><span class="section-number">2.8.2. </span>非等式建模<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>接下来，让我们考虑如何为一个拉丁方问题建模。一个拉丁方问题是在 <span class="math notranslate nohighlight">\(n \times n\)</span> 个网 格上放置 <span class="math notranslate nohighlight">\(1..n\)</span> 之间的数值使得每个数在每行每列都仅出现一次。图 <a class="reference internal" href="#ex-latin"><span class="std std-numref">Listing 2.8.1</span></a> 中给出了拉丁方问题的的一个整数模型。</p>
<div class="literal-block-wrapper docutils container" id="ex-latin">
<div class="code-block-caption"><span class="caption-number">Listing 2.8.1 </span><span class="caption-text">拉丁方问题的整数模型 (<a class="reference download internal" download="" href="downloads/c3c8d397c56b1ff5ee521b78fb93ff8c/latin.mzn"><tt class="xref download docutils literal">latin.mzn</tt></a>). <span class="mzn-playground-button"><a href="playground-latin.html" target="_blank" title="Open in Playground">&#9654;</a></span></span><a class="headerlink" href="#ex-latin" title="Link to this code"></a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s"> </span><span class="c">% 拉丁方的大小</span>
<span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">:</span><span class="s"> </span><span class="nv">a</span><span class="p">;</span>

<span class="k">include</span><span class="s"> &quot;alldifferent.mzn&quot;</span><span class="p">;</span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span>
<span class="s">             </span><span class="nf">alldifferent</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span>
<span class="s">             </span><span class="nf">alldifferent</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">j</span><span class="p">,</span><span class="nv">i</span><span class="p">])</span>
<span class="s">           </span><span class="p">);</span>
<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span>
<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">n</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot; &quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span>
<span class="s">         </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="s"> </span><span class="p">];</span>
</pre></div>
</div>
</div>
<p>整型变量直接的唯一的约束实际上是非等式，而它在约束 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">alldifferent</span></code>  中被编码。 数值表示是表达非等式的最佳方式。图 <a class="reference internal" href="#ex-latinbool"><span class="std std-numref">Listing 2.8.2</span></a> 给出了一个关于拉丁方问题的只含有布尔型 变量的模型。注意每个整型数组元素 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span></code> 被替换为一个布尔型数组。我们使用谓词 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">exactlyone</span></code> 来约束每个数值在每行每列都仅出现一次，也用来约束有且仅有一个布尔型 变量对应于整型数组元素 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span></code> 为真。</p>
<div class="literal-block-wrapper docutils container" id="ex-latinbool">
<div class="code-block-caption"><span class="caption-number">Listing 2.8.2 </span><span class="caption-text">拉丁方问题的布尔型模型 (<a class="reference download internal" download="" href="downloads/4b26725f3d7ae89bc8bf1af893e9a78b/latinbool.mzn"><tt class="xref download docutils literal">latinbool.mzn</tt></a>). <span class="mzn-playground-button"><a href="playground-latinbool.html" target="_blank" title="Open in Playground">&#9654;</a></span></span><a class="headerlink" href="#ex-latinbool" title="Link to this code"></a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s"> </span><span class="c">% 拉丁方的大小</span>
<span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">a</span><span class="p">;</span>

<span class="k">predicate</span><span class="s"> </span><span class="nf">atmostone</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="p">)(</span>
<span class="s">            </span><span class="p">(</span><span class="o">not</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">j</span><span class="p">]));</span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">exactlyone</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span>
<span class="s">          </span><span class="nf">atmostone</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="k">exists</span><span class="p">(</span><span class="nv">x</span><span class="p">);</span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span>
<span class="s">             </span><span class="nf">exactlyone</span><span class="p">(</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span>
<span class="s">             </span><span class="nf">exactlyone</span><span class="p">(</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">k</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span>
<span class="s">             </span><span class="nf">exactlyone</span><span class="p">(</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">a</span><span class="p">[</span><span class="nv">k</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span>
<span class="s">           </span><span class="p">);</span>
<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span>
<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nb">fix</span><span class="p">(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="p">])</span><span class="s"> </span><span class="k">then</span>
<span class="s">            </span><span class="nb">show</span><span class="p">(</span><span class="nv">k</span><span class="p">)</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">n</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot; &quot; </span><span class="k">endif</span><span class="s"> </span>
<span class="s">         </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="s"> </span><span class="p">];</span>
</pre></div>
</div>
</div>
</section>
<section id="id3">
<h2><span class="section-number">2.8.3. </span>势约束建模<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<p>让我们来看下如何对点灯游戏建模。这个游戏由一个矩形网格组成，每个网格为空 白或者被填充。每个被填充的方格可能包含1到4之间的数字，或者没有数字。我们的 目标是放置灯泡在空白网格使得</p>
<ul class="simple">
<li><p>每个空白的网格是“被照亮的”，也就是说它可以透过一行没有被打断的空白网格 看到光亮。</p></li>
<li><p>任何两个灯泡都不能看到彼此。</p></li>
<li><p>一个有数值的填充的网格相邻的灯泡个数必须等于这个网格中的数值。</p></li>
</ul>
<p><a class="reference internal" href="#fig-lightup"><span class="std std-numref">Fig. 2.8.1</span></a> 给出了点灯游戏的一个例子以及 <a class="reference internal" href="#fig-lightup-sol"><span class="std std-numref">Fig. 2.8.2</span></a> 给出了它的解。</p>
<figure class="align-default" id="id4">
<span id="fig-lightup"></span><img alt="images/lightup.svg" src="images/lightup.svg" /><figcaption>
<p><span class="caption-number">Fig. 2.8.1 </span><span class="caption-text">点灯游戏的一个例子展示</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id5">
<span id="fig-lightup-sol"></span><img alt="images/lightup2.svg" src="images/lightup2.svg" /><figcaption>
<p><span class="caption-number">Fig. 2.8.2 </span><span class="caption-text">点灯游戏的完整的解</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>这个问题很自然地可以使用布尔型变量建模。布尔型变量用来决定哪一个网格包含有一个点灯以及哪一个没有。同时我们也有一些作用于填充的网格上的整数算术运算要 考虑。</p>
<div class="literal-block-wrapper docutils container" id="ex-lightup">
<div class="code-block-caption"><span class="caption-number">Listing 2.8.3 </span><span class="caption-text">点灯游戏的SAT模型 (<a class="reference download internal" download="" href="downloads/64e5c915eec698b7eee613d2b2b65db0/lightup.mzn"><tt class="xref download docutils literal">lightup.mzn</tt></a>). <span class="mzn-playground-button"><a href="playground-lightup.html" target="_blank" title="Open in Playground">&#9654;</a></span></span><a class="headerlink" href="#ex-lightup" title="Link to this code"></a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">h</span><span class="p">;</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">H</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">h</span><span class="p">;</span><span class="s"> </span><span class="c">% 板高度</span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">w</span><span class="p">;</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">w</span><span class="p">;</span><span class="s"> </span><span class="c">% 板宽度</span>
<span class="kt">array</span><span class="p">[</span><span class="nv">H</span><span class="p">,</span><span class="nv">W</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="o">..</span><span class="m">5</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="p">;</span><span class="s">       </span><span class="c">% 板</span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">;</span><span class="s">                  </span><span class="c">% 空白格</span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">N</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">4</span><span class="p">;</span><span class="s">         </span><span class="c">% 填充并含有数字的网格</span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">F</span><span class="s"> </span><span class="o">=</span><span class="s">  </span><span class="m">5</span><span class="p">;</span><span class="s">                  </span><span class="c">% 填充但不含有数字的网格</span>

<span class="c">% 位置 (i1,j1) 对位置 (i2,j2) 可见 </span>
<span class="k">test</span><span class="s"> </span><span class="nf">visible</span><span class="p">(</span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">i1</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">j1</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">i2</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">j2</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s">    </span><span class="p">((</span><span class="nv">i1</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">i2</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">min</span><span class="p">(</span><span class="nv">j1</span><span class="p">,</span><span class="nv">j2</span><span class="p">)</span><span class="s">..</span><span class="nb">max</span><span class="p">(</span><span class="nv">j1</span><span class="p">,</span><span class="nv">j2</span><span class="p">))(</span><span class="nv">b</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="p">))</span>
<span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="p">((</span><span class="nv">j1</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">j2</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">min</span><span class="p">(</span><span class="nv">i1</span><span class="p">,</span><span class="nv">i2</span><span class="p">)</span><span class="s">..</span><span class="nb">max</span><span class="p">(</span><span class="nv">i1</span><span class="p">,</span><span class="nv">i2</span><span class="p">))(</span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="p">));</span>

<span class="kt">array</span><span class="p">[</span><span class="nv">H</span><span class="p">,</span><span class="nv">W</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">l</span><span class="p">;</span><span class="s"> </span><span class="c">% is there a light</span>

<span class="c">% 填充的网格没有灯泡</span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">E</span><span class="p">)(</span><span class="nv">l</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">);</span>
<span class="c">% lights next to filled numbered square agree</span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">N</span><span class="p">)(</span>
<span class="s">    </span><span class="nf">bool_sum_eq</span><span class="p">([</span><span class="s"> </span><span class="nv">l</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j1</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="o">..</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="nv">j1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">j</span><span class="o">-</span><span class="m">1</span><span class="o">..</span><span class="nv">j</span><span class="o">+</span><span class="m">1</span><span class="s"> </span><span class="k">where</span>
<span class="s">                             </span><span class="nb">abs</span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">i</span><span class="p">)</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nb">abs</span><span class="p">(</span><span class="nv">j1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">j</span><span class="p">)</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="o">/\</span>
<span class="s">                             </span><span class="nv">i1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">j1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="p">],</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]));</span>
<span class="c">% 每个空白网格是被照亮的</span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="p">)(</span>
<span class="s">             </span><span class="k">exists</span><span class="p">(</span><span class="nv">j1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nf">visible</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">i</span><span class="p">,</span><span class="nv">j1</span><span class="p">))(</span><span class="nv">l</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j1</span><span class="p">])</span><span class="s"> </span><span class="o">\/</span>
<span class="s">             </span><span class="k">exists</span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nf">visible</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">,</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j</span><span class="p">))(</span><span class="nv">l</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span>
<span class="s">           </span><span class="p">);</span>
<span class="c">% 任何两个灯泡看不到彼此</span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i1</span><span class="p">,</span><span class="nv">i2</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j1</span><span class="p">,</span><span class="nv">j2</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="s"> </span><span class="k">where</span><span class="s"> </span>
<span class="s">                  </span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">i2</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">j1</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">j2</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span>
<span class="s">                  </span><span class="o">/\</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i2</span><span class="p">,</span><span class="nv">j2</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">visible</span><span class="p">(</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j1</span><span class="p">,</span><span class="nv">i2</span><span class="p">,</span><span class="nv">j2</span><span class="p">))(</span>
<span class="s">             </span><span class="o">not</span><span class="s"> </span><span class="nv">l</span><span class="p">[</span><span class="nv">i1</span><span class="p">,</span><span class="nv">j1</span><span class="p">]</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="nv">l</span><span class="p">[</span><span class="nv">i2</span><span class="p">,</span><span class="nv">j2</span><span class="p">]</span>
<span class="s">           </span><span class="p">);</span>

<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span>
<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">b</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span>
<span class="s">         </span><span class="k">else</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nb">fix</span><span class="p">(</span><span class="nv">l</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;L&quot; </span><span class="k">else</span><span class="s"> &quot;.&quot; </span><span class="k">endif</span>
<span class="s">         </span><span class="k">endif</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">w</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot; &quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span>
<span class="s">         </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">H</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">W</span><span class="p">];</span>
</pre></div>
</div>
</div>
<p>图 <a class="reference internal" href="#ex-lightup"><span class="std std-numref">Listing 2.8.3</span></a> 中给出了这个问题的一个模型。图 <a class="reference internal" href="#fig-lightup"><span class="std std-numref">Fig. 2.8.1</span></a> 中给出的问题的数据文件在图 <a class="reference internal" href="#fig-lightupdzn"><span class="std std-numref">Listing 2.8.4</span></a> 中给出。</p>
<div class="literal-block-wrapper docutils container" id="fig-lightupdzn">
<div class="code-block-caption"><span class="caption-number">Listing 2.8.4 </span><span class="caption-text">点灯游戏的 <a class="reference internal" href="#fig-lightup"><span class="std std-numref">Fig. 2.8.1</span></a> 中实例的数据文件 <span class="mzn-playground-button"><a href="playground-lightup.html" target="_blank" title="Open in Playground">&#9654;</a></span></span><a class="headerlink" href="#fig-lightupdzn" title="Link to this code"></a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">h</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">7</span><span class="p">;</span>
<span class="nv">w</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">7</span><span class="p">;</span>
<span class="nv">b</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="s"> </span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span>
<span class="s">     </span><span class="p">|</span><span class="s">  </span><span class="m">0</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">1</span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span>
<span class="s">     </span><span class="p">|</span><span class="s">  </span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="m">1</span><span class="s"> </span><span class="p">|];</span>
</pre></div>
</div>
</div>
<p>模型利用了一个布尔型求和谓词</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span><span class="s"> </span><span class="nf">bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">);</span>
</pre></div>
</div>
<p>使得一个布尔型数组的和等于一个固定的整数。多种方式都能使用布尔型变量给 <em>cardinality</em> 约束建模。</p>
<ul class="simple">
<li><p>加法器网络：我们可以使用包含加法器的一个网络给布尔型总和建立一个二元布 尔型表达式</p></li>
<li><p>排序网络：我们可以通过使用一个排序网络去分类布尔型数组来创建一个布尔型 总和的一元表达式</p></li>
<li><p>二元决策图：我们可以创建一个二维决策图（BDD）来编码势约束。</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="ex-bboolsum">
<div class="code-block-caption"><span class="caption-number">Listing 2.8.5 </span><span class="caption-text">使用二元加法器网络表示势约束 (<a class="reference download internal" download="" href="downloads/ea5afcbca280e16fb665b2d25584aff8/bboolsum.mzn"><tt class="xref download docutils literal">bboolsum.mzn</tt></a>). <span class="mzn-playground-button"><a href="playground-bboolsum.html" target="_blank" title="Open in Playground">&#9654;</a></span></span><a class="headerlink" href="#ex-bboolsum" title="Link to this code"></a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% 布尔型变量x的总和 = s</span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">false</span><span class="s"> </span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">)</span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">then</span>
<span class="s">          </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="c">% cp = number of bits required for representing 0..c</span>
<span class="s">                </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">cp</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">floor</span><span class="p">(</span><span class="nb">log2</span><span class="p">(</span><span class="nb">int2float</span><span class="p">(</span><span class="nv">c</span><span class="p">))),</span>
<span class="s">                </span><span class="c">% z is sum of x in binary </span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">z</span><span class="s">  </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">          </span><span class="nf">binary_sum</span><span class="p">(</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="nv">z</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span>
<span class="s">          </span><span class="c">% z == s</span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">cp</span><span class="p">)(</span><span class="nv">z</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="p">((</span><span class="nv">s</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="nb">pow</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nv">i</span><span class="p">))</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="p">))</span><span class="s"> </span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">then</span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="p">)</span>
<span class="s">     </span><span class="k">else</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span>

<span class="k">include</span><span class="s"> &quot;binarysum.mzn&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="ex-binarysum">
<div class="code-block-caption"><span class="caption-number">Listing 2.8.6 </span><span class="caption-text">创建二元求和网络的代码 (<a class="reference download internal" download="" href="downloads/1521a72ae04d7c3bcb94eced6620556e/binarysum.mzn"><tt class="xref download docutils literal">binarysum.mzn</tt></a>). <span class="mzn-playground-button"><a href="playground-binarysum.html" target="_blank" title="Open in Playground">&#9654;</a></span></span><a class="headerlink" href="#ex-binarysum" title="Link to this code"></a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% 位 x 的的总和 = 二元表示的 s。</span>
<span class="c">%            s[0], s[1], ..., s[k] 其中 2^k &gt;= length(x) &gt; 2^(k-1)</span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">binary_sum</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span>
<span class="s">                     </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="o">=</span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="k">then</span><span class="s"> </span>
<span class="s">             </span><span class="nv">s</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">xor</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
<span class="s">     </span><span class="k">else</span><span class="s"> </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">ll</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">l</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">),</span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">ll</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">f</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">ll</span><span class="s"> </span><span class="p">],</span><span class="s"> </span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">ll</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">ll</span><span class="o">+</span><span class="m">1</span><span class="o">..</span><span class="m">2</span><span class="o">*</span><span class="nv">ll</span><span class="p">],</span>
<span class="s">                </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">ll</span><span class="o">*</span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">l</span><span class="p">]</span><span class="s"> </span><span class="k">endif</span><span class="p">,</span>
<span class="s">                </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">cp</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">floor</span><span class="p">(</span><span class="nb">log2</span><span class="p">(</span><span class="nb">int2float</span><span class="p">(</span><span class="nv">ll</span><span class="p">))),</span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">fs</span><span class="p">,</span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">ts</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">                </span><span class="nf">binary_sum</span><span class="p">(</span><span class="nv">f</span><span class="p">,</span><span class="s"> </span><span class="nv">fs</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">binary_sum</span><span class="p">(</span><span class="nv">t</span><span class="p">,</span><span class="s"> </span><span class="nv">ts</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span>
<span class="s">                </span><span class="nf">binary_add</span><span class="p">(</span><span class="nv">fs</span><span class="p">,</span><span class="s"> </span><span class="nv">ts</span><span class="p">,</span><span class="s"> </span><span class="nv">b</span><span class="p">,</span><span class="s"> </span><span class="nv">s</span><span class="p">)</span>
<span class="s">     </span><span class="k">endif</span><span class="p">;</span>

<span class="c">% 把两个二元数值 x 和 y 加起来，位 ci 用来表示进位，来得到二元 s </span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">binary_add</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span>
<span class="s">                     </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">,</span>
<span class="s">                     </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">ci</span><span class="p">,</span>
<span class="s">                     </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span>
<span class="s">    </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">l</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">),</span><span class="s"> </span>
<span class="s">          </span><span class="kt">int</span><span class="p">:</span><span class="nv">n</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">s</span><span class="p">),</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s">  </span>
<span class="s">    </span><span class="nb">assert</span><span class="p">(</span><span class="nv">l</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">y</span><span class="p">),</span>
<span class="s">          &quot;length of binary_add input args must be same&quot;</span><span class="p">,</span>
<span class="s">    </span><span class="nb">assert</span><span class="p">(</span><span class="nv">n</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">n</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">l</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="s"> &quot;length of binary_add output &quot; </span><span class="o">++</span>
<span class="s">                         &quot;must be equal or one more than inputs&quot;</span><span class="p">,</span>
<span class="s">    </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">l</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">    </span><span class="nf">full_adder</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="s"> </span><span class="nv">y</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="s"> </span><span class="nv">ci</span><span class="p">,</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="m">0</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span>
<span class="s">    </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">l</span><span class="p">)(</span><span class="nf">full_adder</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="s"> </span><span class="nv">y</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="p">],</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="nv">i</span><span class="p">]))</span><span class="s"> </span><span class="o">/\</span>
<span class="s">    </span><span class="k">if</span><span class="s"> </span><span class="nv">n</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">n</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="nv">l</span><span class="p">]</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nv">c</span><span class="p">[</span><span class="nv">l</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">endif</span><span class="s"> </span><span class="p">));</span>
<span class="s">    </span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">full_adder</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">ci</span><span class="p">,</span>
<span class="s">                     </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">co</span><span class="p">)</span><span class="s"> </span><span class="o">=</span>
<span class="s">          </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">xy</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">xor</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span>
<span class="s">          </span><span class="nv">s</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">xy</span><span class="s"> </span><span class="o">xor</span><span class="s"> </span><span class="nv">ci</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">co</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">((</span><span class="nv">x</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">y</span><span class="p">)</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="p">(</span><span class="nv">ci</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">xy</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>我们可以使用图 <a class="reference internal" href="#ex-bboolsum"><span class="std std-numref">Listing 2.8.5</span></a> 给出的二元加法器网络代码实现 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">bool_sum_eq</span></code> 。图 <a class="reference internal" href="#ex-binarysum"><span class="std std-numref">Listing 2.8.6</span></a> 中定义的 谓词 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">binary_sum</span></code> 创建了一个 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span></code> 总和的二维表示法。它把列表分为两部分，把每一部分 分别加起来得到它们的一个二元表示，然后用 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">binary_add</span></code> 把这两个二元数值加起来。 如果 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span></code>  列大小是奇数，则最后一位被保存起来作为二元加法时的进位来使用。</p>
<div class="literal-block-wrapper docutils container" id="ex-uboolsum">
<div class="code-block-caption"><span class="caption-number">Listing 2.8.7 </span><span class="caption-text">使用二元加法器网络表示势约束 (<a class="reference download internal" download="" href="downloads/d531d7a95afd82663b6cfea596fbd993/uboolsum.mzn"><tt class="xref download docutils literal">uboolsum.mzn</tt></a>). <span class="mzn-playground-button"><a href="playground-uboolsum.html" target="_blank" title="Open in Playground">&#9654;</a></span></span><a class="headerlink" href="#ex-uboolsum" title="Link to this code"></a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% 布尔型变量 x的总和 = s</span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">false</span><span class="s"> </span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">)</span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">then</span>
<span class="s">          </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="c">% cp = nearest power of 2 &gt;= c</span>
<span class="s">                </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">cp</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">pow</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="nb">ceil</span><span class="p">(</span><span class="nb">log2</span><span class="p">(</span><span class="nb">int2float</span><span class="p">(</span><span class="nv">c</span><span class="p">)))),</span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">y</span><span class="p">,</span><span class="s"> </span><span class="c">% y is padded version of x</span>
<span class="s">                </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">cp</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">z</span><span class="s">  </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">y</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">c</span><span class="o">+</span><span class="m">1</span><span class="o">..</span><span class="nv">cp</span><span class="p">)(</span><span class="nv">y</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span>
<span class="s">          </span><span class="nf">oesort</span><span class="p">(</span><span class="nv">y</span><span class="p">,</span><span class="s"> </span><span class="nv">z</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">z</span><span class="p">[</span><span class="nv">s</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">z</span><span class="p">[</span><span class="nv">s</span><span class="o">+</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="p">)</span>
<span class="s">     </span><span class="k">else</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span>

<span class="k">include</span><span class="s"> &quot;oesort.mzn&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="ex-oesort">
<div class="code-block-caption"><span class="caption-number">Listing 2.8.8 </span><span class="caption-text">奇偶归并排序网络 (<a class="reference download internal" download="" href="downloads/3b232be5e7f8373ddf3820757887379e/oesort.mzn"><tt class="xref download docutils literal">oesort.mzn</tt></a>). <span class="mzn-playground-button"><a href="playground-oesort.html" target="_blank" title="Open in Playground">&#9654;</a></span></span><a class="headerlink" href="#ex-oesort" title="Link to this code"></a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">%% odd-even sort</span>
<span class="c">%% y is the sorted version of x, all trues before falses</span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">oesort</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">y</span><span class="p">)</span><span class="o">=</span>
<span class="s">  </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">card</span><span class="p">(</span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">))</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span>
<span class="s">  </span><span class="k">elseif</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nf">comparator</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="nv">x</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
<span class="s">  </span><span class="k">else</span>
<span class="s">    </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span>
<span class="s">      </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">xf</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">],</span>
<span class="s">      </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">xl</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">+</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">],</span>
<span class="s">      </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">tf</span><span class="p">,</span>
<span class="s">      </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">tl</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">    </span><span class="nf">oesort</span><span class="p">(</span><span class="nv">xf</span><span class="p">,</span><span class="nv">tf</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">oesort</span><span class="p">(</span><span class="nv">xl</span><span class="p">,</span><span class="nv">tl</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">oemerge</span><span class="p">(</span><span class="nv">tf</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="nv">tl</span><span class="p">,</span><span class="s"> </span><span class="nv">y</span><span class="p">)</span>
<span class="s">  </span><span class="k">endif</span><span class="p">;</span>

<span class="c">%% odd-even merge</span>
<span class="c">%% y is the sorted version of x, all trues before falses</span>
<span class="c">%% assumes first half of x is sorted, and second half of x</span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">oemerge</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">y</span><span class="p">)</span><span class="o">=</span>
<span class="s">  </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">card</span><span class="p">(</span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">))</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span>
<span class="s">  </span><span class="k">elseif</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nf">comparator</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="nv">x</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
<span class="s">  </span><span class="k">else</span>
<span class="s">    </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">xo</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s">            </span><span class="p">[</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="p">],</span>
<span class="s">          </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">xe</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s">            </span><span class="p">[</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="p">],</span>
<span class="s">          </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">to</span><span class="p">,</span>
<span class="s">          </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">te</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">      </span><span class="nf">oemerge</span><span class="p">(</span><span class="nv">xo</span><span class="p">,</span><span class="nv">to</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">oemerge</span><span class="p">(</span><span class="nv">xe</span><span class="p">,</span><span class="nv">te</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span>
<span class="s">      </span><span class="nv">y</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">to</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">/\</span>
<span class="s">      </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">-</span><span class="m">1</span><span class="p">)(</span>
<span class="s">        </span><span class="nf">comparator</span><span class="p">(</span><span class="nv">te</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="nv">to</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">2</span><span class="o">*</span><span class="nv">i</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="m">2</span><span class="o">*</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">]))</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span>
<span class="s">      </span><span class="nv">y</span><span class="p">[</span><span class="nv">c</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">te</span><span class="p">[</span><span class="nv">c</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">]</span>
<span class="s">  </span><span class="k">endif</span><span class="p">;</span>
<span class="s"> </span>
<span class="c">% comparator o1 = max(i1,i2), o2 = min(i1,i2)</span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">comparator</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">i1</span><span class="p">,</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">i2</span><span class="p">,</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">o1</span><span class="p">,</span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">o2</span><span class="p">)</span><span class="o">=</span>
<span class="s">          </span><span class="p">(</span><span class="nv">o1</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">i2</span><span class="p">))</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="p">(</span><span class="nv">o2</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">i1</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">i2</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>我们可以使用图 <a class="reference internal" href="#ex-uboolsum"><span class="std std-numref">Listing 2.8.7</span></a> 中给出的一元排序网络代码来实现 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">bool_sum_eq</span></code> 。势约束通过扩展输入 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span></code> 长度为2 的次幂，然后使用奇偶归并排序网络给得到的位排序来实现。奇偶归 并排序工作方式在图 <a class="reference internal" href="#ex-oesort"><span class="std std-numref">Listing 2.8.8</span></a> 中给出，它递归地把输入列表拆为两部分，给每一部分排序，然 后再把有序的两部分归并起来。</p>
<div class="literal-block-wrapper docutils container" id="ex-bddsum">
<div class="code-block-caption"><span class="caption-number">Listing 2.8.9 </span><span class="caption-text">使用二元加法器网络表示势约束 (<a class="reference download internal" download="" href="downloads/2c5ebf61e9473bedabe0ecc7dd600962/bddsum.mzn"><tt class="xref download docutils literal">bddsum.mzn</tt></a>). <span class="mzn-playground-button"><a href="playground-bddsum.html" target="_blank" title="Open in Playground">&#9654;</a></span></span><a class="headerlink" href="#ex-bddsum" title="Link to this code"></a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% the sum of booleans x = s</span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">),</span>
<span class="s">           </span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">c</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">)]</span><span class="s"> </span>
<span class="s">     </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">     </span><span class="nf">rec_bool_sum_eq</span><span class="p">(</span><span class="nv">y</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="nv">s</span><span class="p">);</span>

<span class="k">predicate</span><span class="s"> </span><span class="nf">rec_bool_sum_eq</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">f</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span>
<span class="s">     </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">false</span><span class="s"> </span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">f</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="p">)</span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">f</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span>
<span class="s">          </span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="nv">f</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">rec_bool_sum_eq</span><span class="p">(</span><span class="nv">x</span><span class="p">,</span><span class="nv">f</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="nv">s</span><span class="o">-</span><span class="m">1</span><span class="p">))</span><span class="s"> </span><span class="o">\/</span>
<span class="s">          </span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="nv">f</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nf">rec_bool_sum_eq</span><span class="p">(</span><span class="nv">x</span><span class="p">,</span><span class="nv">f</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="nv">s</span><span class="p">))</span>
<span class="s">     </span><span class="k">elseif</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">f</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="k">then</span>
<span class="s">          </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">f</span><span class="o">..</span><span class="nv">c</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="l">true</span><span class="p">)</span>
<span class="s">     </span><span class="k">else</span><span class="s"> </span><span class="l">false</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span>
</pre></div>
</div>
</div>
<p>我们可以使用图 <a class="reference internal" href="#ex-bddsum"><span class="std std-numref">Listing 2.8.9</span></a> 中给出的二元决策图代码来实现 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">bool_sum_eq</span></code> 。势约束被分为两种情况：或者第一个元素 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span></code> 为 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="l">true</span></code> 并且剩下位的总和是 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s</span><span class="o">-</span><span class="m">1</span></code> ，或者 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span></code> 为 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="l">false</span></code> 并 且剩下位的总和是 <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s</span></code> 。它的效率的提高依赖于去除共同子表达式来避免产生太多的相同的约束。</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="efficient.html" class="btn btn-neutral float-left" title="2.7. MiniZinc中的有效建模实践" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="flattening.html" class="btn btn-neutral float-right" title="2.9. FlatZinc和展平" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016, 2017, 2018, 2019, 2020 Peter J. Stuckey, Kim Marriott, Guido Tack.</p>
  </div>

  
<a rel="license" href="http://creativecommons.org/licenses/by-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nd/4.0/80x15.png" /></a>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-63390311-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-63390311-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>