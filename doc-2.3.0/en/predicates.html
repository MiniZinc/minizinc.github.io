

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.3. Predicates and Functions &mdash; The MiniZinc Handbook 2.3.0</title>
  

  
  
  
  
    <link rel="canonical" href="http://www.minizinc.org/doc-latest/en/predicates.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="static/style.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2.4. Option Types" href="optiontypes.html" />
    <link rel="prev" title="2.2. More Complex Models" href="modelling2.html" />
    <link rel="apple-touch-icon" sizes="57x57" href="static/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="static/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="static/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="static/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="static/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="static/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="static/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="static/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="static/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="static/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="static/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/favicon/favicon-16x16.png">
    <link rel="manifest" href="static/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="static/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">


  
  <script src="static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="http://www.minizinc.org">
          
            
            <img src="static/MiniZn_logo_2.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
              <div class="version">
                2.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            <a href="index.html" class="reference internal icon icon-home"> The MiniZinc Handbook </a>
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="part_1_overview.html">1. Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="part_2_tutorial.html">2. A MiniZinc Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="modelling.html">2.1. Basic Modelling in MiniZinc</a></li>
<li class="toctree-l2"><a class="reference internal" href="modelling2.html">2.2. More Complex Models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.3. Predicates and Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#global-constraints">2.3.1. Global Constraints</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#alldifferent">2.3.1.1. Alldifferent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cumulative">2.3.1.2. Cumulative</a></li>
<li class="toctree-l4"><a class="reference internal" href="#table">2.3.1.3. Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#regular">2.3.1.4. Regular</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#defining-predicates">2.3.2. Defining Predicates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-functions">2.3.3. Defining Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reflection-functions">2.3.4. Reflection Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#local-variables">2.3.5. Local Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#context">2.3.6. Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="#local-constraints">2.3.7. Local Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#domain-reflection-functions">2.3.8. Domain Reflection Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scope">2.3.9. Scope</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="optiontypes.html">2.4. Option Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="mzn_search.html">2.5. Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="efficient.html">2.6. Effective Modelling Practices in MiniZinc</a></li>
<li class="toctree-l2"><a class="reference internal" href="sat.html">2.7. Boolean Satisfiability Modelling in MiniZinc</a></li>
<li class="toctree-l2"><a class="reference internal" href="flattening.html">2.8. FlatZinc and Flattening</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="part_3_user_manual.html">3. User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="part_4_reference.html">4. Reference Manual</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">The MiniZinc Handbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="part_2_tutorial.html">2. A MiniZinc Tutorial</a> &raquo;</li>
        
      <li>2.3. Predicates and Functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="predicates-and-functions">
<span id="sec-predicates"></span><span id="index-0"></span><h1>2.3. Predicates and Functions<a class="headerlink" href="#predicates-and-functions" title="Permalink to this headline">¶</a></h1>
<p>Predicates in MiniZinc
allow us to capture complex constraints of our model
in a succinct way.  Predicates in MiniZinc
are used to model with both predefined global
constraints, and to capture and define new complex constraints by the
modeller.
Functions are used in MiniZinc to capture common structures of models.
Indeed a predicate is just a function with output type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="s"></span></code>.</p>
<div class="section" id="global-constraints">
<span id="sec-globals"></span><h2>2.3.1. Global Constraints<a class="headerlink" href="#global-constraints" title="Permalink to this headline">¶</a></h2>
<p id="index-1">There are many global constraints defined in MiniZinc for use in modelling.
The definitive list is to be found in the documentation for the release, as
the list is slowly growing.
Below we discuss some of the most important global constraints.</p>
<div class="section" id="alldifferent">
<h3>2.3.1.1. Alldifferent<a class="headerlink" href="#alldifferent" title="Permalink to this headline">¶</a></h3>
<p id="index-2">The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code> constraint takes an array of variables and constrains them
to take different values.
A use of the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code> has the form</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="bp">alldifferent</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">)</span><span class="s"></span>
</pre></div>
</div>
<p>The argument is an array of integer variables.</p>
<p>The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code> constraint is one of the most studied and used global constraints in
constraint programming.  It is used to define assignment subproblems, and
efficient global propagators for <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code> exist.
The models <a class="reference download internal" href="downloads/send-more-money.mzn" download=""><tt class="xref download docutils literal">send-more-money.mzn</tt></a> (<a class="reference internal" href="modelling2.html#ex-smm"><span class="std std-numref">Listing 2.2.4</span></a>)
and <a class="reference download internal" href="downloads/sudoku.mzn" download=""><tt class="xref download docutils literal">sudoku.mzn</tt></a> (<a class="reference internal" href="modelling2.html#ex-sudoku"><span class="std std-numref">Listing 2.2.5</span></a>)
are examples of models using <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code>.</p>
</div>
<div class="section" id="cumulative">
<h3>2.3.1.2. Cumulative<a class="headerlink" href="#cumulative" title="Permalink to this headline">¶</a></h3>
<p id="index-3">The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">cumulative</span><span class="s"></span></code> constraint is used for describing cumulative resource
usage.</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="bp">cumulative</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">,</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">d</span><span class="p">,</span><span class="s"></span>
<span class="s">           </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">r</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="p">)</span><span class="s"></span>
</pre></div>
</div>
<p>It requires that a set of tasks given by start times <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s</span><span class="s"></span></code>, durations <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">d</span><span class="s"></span></code>,
and resource requirements <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">r</span><span class="s"></span></code>, never require more
than a global resource bound <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">b</span><span class="s"></span></code> at any one time.</p>
<div class="literal-block-wrapper docutils container" id="ex-moving">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.1 </span><span class="caption-text">Model for moving furniture using <tt class="docutils literal">cumulative</tt> (<a class="reference download internal" href="downloads/moving.mzn" download=""><tt class="xref download docutils literal">moving.mzn</tt></a>).</span><a class="headerlink" href="#ex-moving" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;cumulative.mzn&quot;</span><span class="p">;</span><span class="s"></span>

<span class="kt">enum</span><span class="s"> </span><span class="nv">OBJECTS</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">OBJECTS</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">duration</span><span class="p">;</span><span class="s"> </span><span class="c">% duration to move</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">OBJECTS</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">handlers</span><span class="p">;</span><span class="s"> </span><span class="c">% number of handlers required</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">OBJECTS</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">trolleys</span><span class="p">;</span><span class="s"> </span><span class="c">% number of trolleys required</span><span class="s"></span>

<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">available_handlers</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">available_trolleys</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">available_time</span><span class="p">;</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">OBJECTS</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">available_time</span><span class="p">:</span><span class="s"> </span><span class="nv">start</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">available_time</span><span class="p">:</span><span class="s"> </span><span class="nv">end</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="bp">cumulative</span><span class="p">(</span><span class="nv">start</span><span class="p">,</span><span class="s"> </span><span class="nv">duration</span><span class="p">,</span><span class="s"> </span><span class="nv">handlers</span><span class="p">,</span><span class="s"> </span><span class="nv">available_handlers</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="bp">cumulative</span><span class="p">(</span><span class="nv">start</span><span class="p">,</span><span class="s"> </span><span class="nv">duration</span><span class="p">,</span><span class="s"> </span><span class="nv">trolleys</span><span class="p">,</span><span class="s"> </span><span class="nv">available_trolleys</span><span class="p">);</span><span class="s"></span>
<span class="s"> </span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">o</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">OBJECTS</span><span class="p">)(</span><span class="nv">start</span><span class="p">[</span><span class="nv">o</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="nv">duration</span><span class="p">[</span><span class="nv">o</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">end</span><span class="p">);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">minimize</span><span class="s"> </span><span class="nv">end</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> &quot;start = </span><span class="p">\(</span><span class="nv">start</span><span class="p">)</span><span class="se">\n</span><span class="s">end = </span><span class="p">\(</span><span class="nv">end</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="ex-movingd">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.2 </span><span class="caption-text">Data for moving furniture using <tt class="docutils literal">cumulative</tt> (<a class="reference download internal" href="downloads/moving.dzn" download=""><tt class="xref download docutils literal">moving.dzn</tt></a>).</span><a class="headerlink" href="#ex-movingd" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">OBJECTS</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">piano</span><span class="p">,</span><span class="s"> </span><span class="nv">fridge</span><span class="p">,</span><span class="s"> </span><span class="nv">doublebed</span><span class="p">,</span><span class="s"> </span><span class="nv">singlebed</span><span class="p">,</span><span class="s"> </span>
<span class="s">            </span><span class="nv">wardrobe</span><span class="p">,</span><span class="s"> </span><span class="nv">chair1</span><span class="p">,</span><span class="s"> </span><span class="nv">chair2</span><span class="p">,</span><span class="s"> </span><span class="bp">table</span><span class="s"> </span><span class="p">};</span><span class="s"></span>

<span class="nv">duration</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="m">60</span><span class="p">,</span><span class="s"> </span><span class="m">45</span><span class="p">,</span><span class="s"> </span><span class="m">30</span><span class="p">,</span><span class="s"> </span><span class="m">30</span><span class="p">,</span><span class="s"> </span><span class="m">20</span><span class="p">,</span><span class="s"> </span><span class="m">15</span><span class="p">,</span><span class="s"> </span><span class="m">15</span><span class="p">,</span><span class="s"> </span><span class="m">15</span><span class="p">];</span><span class="s"></span>
<span class="nv">handlers</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">];</span><span class="s"></span>
<span class="nv">trolleys</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">];</span><span class="s"></span>

<span class="nv">available_time</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">180</span><span class="p">;</span><span class="s"></span>
<span class="nv">available_handlers</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">4</span><span class="p">;</span><span class="s"></span>
<span class="nv">available_trolleys</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">3</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The model in <a class="reference internal" href="#ex-moving"><span class="std std-numref">Listing 2.3.1</span></a> finds a schedule for moving furniture
so that each piece of furniture has enough handlers (people) and enough trolleys
available during the move. The available time, handlers
and trolleys are given, and the data gives for each object the move
duration,
the number of handlers and the number of trolleys required.
Using the data shown in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">ex</span><span class="o">-</span><span class="nv">movingd</span><span class="s"></span></code>, the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc moving.mzn moving.dzn
</pre></div>
</div>
<p>may result in the output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>start = [0, 60, 60, 90, 120, 0, 15, 105]
end = 140
----------
==========
</pre></div>
</div>
<p><a class="reference internal" href="#fig-histogram-a"><span class="std std-numref">Fig. 2.3.1</span></a> and <a class="reference internal" href="#fig-histogram-b"><span class="std std-numref">Fig. 2.3.2</span></a>
show the requirements for handlers and
trolleys at each time in the move for this solution.</p>
<div class="figure" id="id1">
<span id="fig-histogram-a"></span><img alt="images/handlers.svg" src="images/handlers.svg" /><p class="caption"><span class="caption-number">Fig. 2.3.1 </span><span class="caption-text">Histogram of usage of handlers in the move.</span></p>
</div>
<div class="figure" id="id2">
<span id="fig-histogram-b"></span><img alt="images/trolleys.svg" src="images/trolleys.svg" /><p class="caption"><span class="caption-number">Fig. 2.3.2 </span><span class="caption-text">Histogram of usage of trolleys in the move.</span></p>
</div>
</div>
<div class="section" id="table">
<h3>2.3.1.3. Table<a class="headerlink" href="#table" title="Permalink to this headline">¶</a></h3>
<p id="index-4">The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">table</span><span class="s"></span></code> constraint enforces that a tuple of variables
takes a value from a set of tuples. Since there are no tuples in MiniZinc
this is encoded using arrays. The usage of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">table</span><span class="s"></span></code>
has one of the forms</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="bp">table</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="p">)</span><span class="s"></span>
<span class="bp">table</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s">  </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s">  </span><span class="nv">t</span><span class="p">)</span><span class="s"></span>
</pre></div>
</div>
<p>depending on whether the tuples are Boolean or integer.
The constraint enforces <span class="math notranslate nohighlight">\(x \in t\)</span> where we consider <span class="math notranslate nohighlight">\(x\)</span>
and each row in <span class="math notranslate nohighlight">\(t\)</span> to be a tuple,
and <span class="math notranslate nohighlight">\(t\)</span> to be a set of tuples.</p>
<div class="literal-block-wrapper docutils container" id="ex-meal">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.3 </span><span class="caption-text">Model for meal planning using <tt class="docutils literal">table</tt> constraint (<a class="reference download internal" href="downloads/meal.mzn" download=""><tt class="xref download docutils literal">meal.mzn</tt></a>).</span><a class="headerlink" href="#ex-meal" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% Planning a balanced meal</span><span class="s"></span>
<span class="k">include</span><span class="s"> &quot;table.mzn&quot;</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">min_energy</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">min_protein</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">max_salt</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">max_fat</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">FOOD</span><span class="p">:</span><span class="s"> </span><span class="nv">desserts</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">FOOD</span><span class="p">:</span><span class="s"> </span><span class="nv">mains</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">FOOD</span><span class="p">:</span><span class="s"> </span><span class="nv">sides</span><span class="p">;</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">FEATURE</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">name</span><span class="p">,</span><span class="s"> </span><span class="nv">energy</span><span class="p">,</span><span class="s"> </span><span class="nv">protein</span><span class="p">,</span><span class="s"> </span><span class="nv">salt</span><span class="p">,</span><span class="s"> </span><span class="nv">fat</span><span class="p">,</span><span class="s"> </span><span class="nv">cost</span><span class="p">};</span><span class="s"> </span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">FOOD</span><span class="p">;</span><span class="s"> </span>
<span class="kt">array</span><span class="p">[</span><span class="nv">FOOD</span><span class="p">,</span><span class="nv">FEATURE</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">dd</span><span class="p">;</span><span class="s"> </span><span class="c">% food database</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">FEATURE</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">main</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">FEATURE</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">side</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">FEATURE</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">dessert</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">budget</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="nv">main</span><span class="p">[</span><span class="nv">name</span><span class="p">]</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">mains</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">side</span><span class="p">[</span><span class="nv">name</span><span class="p">]</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">sides</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">dessert</span><span class="p">[</span><span class="nv">name</span><span class="p">]</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">desserts</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="bp">table</span><span class="p">(</span><span class="nv">main</span><span class="p">,</span><span class="s"> </span><span class="nv">dd</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="bp">table</span><span class="p">(</span><span class="nv">side</span><span class="p">,</span><span class="s"> </span><span class="nv">dd</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="bp">table</span><span class="p">(</span><span class="nv">dessert</span><span class="p">,</span><span class="s"> </span><span class="nv">dd</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">main</span><span class="p">[</span><span class="nv">energy</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">side</span><span class="p">[</span><span class="nv">energy</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">dessert</span><span class="p">[</span><span class="nv">energy</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;=</span><span class="nv">min_energy</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">main</span><span class="p">[</span><span class="nv">protein</span><span class="p">]</span><span class="o">+</span><span class="nv">side</span><span class="p">[</span><span class="nv">protein</span><span class="p">]</span><span class="o">+</span><span class="nv">dessert</span><span class="p">[</span><span class="nv">protein</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;=</span><span class="nv">min_protein</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">main</span><span class="p">[</span><span class="nv">salt</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">side</span><span class="p">[</span><span class="nv">salt</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">dessert</span><span class="p">[</span><span class="nv">salt</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">max_salt</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">main</span><span class="p">[</span><span class="nv">fat</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">side</span><span class="p">[</span><span class="nv">fat</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">dessert</span><span class="p">[</span><span class="nv">fat</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">max_fat</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">budget</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">main</span><span class="p">[</span><span class="nv">cost</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">side</span><span class="p">[</span><span class="nv">cost</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">dessert</span><span class="p">[</span><span class="nv">cost</span><span class="p">];</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">minimize</span><span class="s"> </span><span class="nv">budget</span><span class="p">;</span><span class="s"> </span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;main = &quot;</span><span class="p">,</span><span class="nb">show</span><span class="p">(</span><span class="nf">to_enum</span><span class="p">(</span><span class="nv">FOOD</span><span class="p">,</span><span class="nv">main</span><span class="p">[</span><span class="nv">name</span><span class="p">])),</span><span class="s">&quot;, </span>
<span class="s">        &quot;</span><span class="p">,</span><span class="s"> </span><span class="nv">side</span><span class="s"> </span><span class="o">=</span><span class="s"> &quot;,show(to_enum(FOOD,side[name])),</span>
<span class="s">        &quot;</span><span class="p">,</span><span class="s"> </span><span class="nv">dessert</span><span class="s"> </span><span class="o">=</span><span class="s"> &quot;,show(to_enum(FOOD,dessert[name]))],</span>
<span class="s">        &quot;</span><span class="p">,</span><span class="s"> </span><span class="nv">cost</span><span class="s"> </span><span class="o">=</span><span class="s"> &quot;,show(budget), &quot;\</span><span class="nv">n</span><span class="s">&quot;];</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="ex-meald">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.4 </span><span class="caption-text">Data for meal planning defining the <tt class="docutils literal">table</tt> used (<a class="reference download internal" href="downloads/meal.dzn" download=""><tt class="xref download docutils literal">meal.dzn</tt></a>).</span><a class="headerlink" href="#ex-meald" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">FOODS</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">icecream</span><span class="p">,</span><span class="s"> </span><span class="nv">banana</span><span class="p">,</span><span class="s"> </span><span class="nv">chocolatecake</span><span class="p">,</span><span class="s"> </span><span class="nv">lasagna</span><span class="p">,</span><span class="s"> </span>
<span class="s">          </span><span class="nv">steak</span><span class="p">,</span><span class="s"> </span><span class="nv">rice</span><span class="p">,</span><span class="s"> </span><span class="nv">chips</span><span class="p">,</span><span class="s"> </span><span class="nv">brocolli</span><span class="p">,</span><span class="s"> </span><span class="nv">beans</span><span class="p">}</span><span class="s"> </span><span class="p">;</span><span class="s"></span>

<span class="nv">dd</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[|</span><span class="s"> </span><span class="nv">icecream</span><span class="p">,</span><span class="s">      </span><span class="m">1200</span><span class="p">,</span><span class="s">  </span><span class="m">50</span><span class="p">,</span><span class="s">  </span><span class="m">10</span><span class="p">,</span><span class="s"> </span><span class="m">120</span><span class="p">,</span><span class="s">  </span><span class="m">400</span><span class="s">     </span><span class="c">% icecream</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="nv">banana</span><span class="p">,</span><span class="s">         </span><span class="m">800</span><span class="p">,</span><span class="s"> </span><span class="m">120</span><span class="p">,</span><span class="s">   </span><span class="m">5</span><span class="p">,</span><span class="s">  </span><span class="m">20</span><span class="p">,</span><span class="s">  </span><span class="m">120</span><span class="s">     </span><span class="c">% banana</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="nv">chocolatecake</span><span class="p">,</span><span class="s"> </span><span class="m">2500</span><span class="p">,</span><span class="s"> </span><span class="m">400</span><span class="p">,</span><span class="s">  </span><span class="m">20</span><span class="p">,</span><span class="s"> </span><span class="m">100</span><span class="p">,</span><span class="s">  </span><span class="m">600</span><span class="s">     </span><span class="c">% chocolate cake</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="nv">lasagna</span><span class="p">,</span><span class="s">       </span><span class="m">3000</span><span class="p">,</span><span class="s"> </span><span class="m">200</span><span class="p">,</span><span class="s"> </span><span class="m">100</span><span class="p">,</span><span class="s"> </span><span class="m">250</span><span class="p">,</span><span class="s">  </span><span class="m">450</span><span class="s">     </span><span class="c">% lasagna</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="nv">steak</span><span class="p">,</span><span class="s">         </span><span class="m">1800</span><span class="p">,</span><span class="s"> </span><span class="m">800</span><span class="p">,</span><span class="s">  </span><span class="m">50</span><span class="p">,</span><span class="s"> </span><span class="m">100</span><span class="p">,</span><span class="s"> </span><span class="m">1200</span><span class="s">     </span><span class="c">% steak</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="nv">rice</span><span class="p">,</span><span class="s">          </span><span class="m">1200</span><span class="p">,</span><span class="s">  </span><span class="m">50</span><span class="p">,</span><span class="s">   </span><span class="m">5</span><span class="p">,</span><span class="s">  </span><span class="m">20</span><span class="p">,</span><span class="s">  </span><span class="m">100</span><span class="s">     </span><span class="c">% rice</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="nv">chips</span><span class="p">,</span><span class="s">         </span><span class="m">2000</span><span class="p">,</span><span class="s">  </span><span class="m">50</span><span class="p">,</span><span class="s"> </span><span class="m">200</span><span class="p">,</span><span class="s"> </span><span class="m">200</span><span class="p">,</span><span class="s">  </span><span class="m">250</span><span class="s">     </span><span class="c">% chips</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="nv">brocolli</span><span class="p">,</span><span class="s">       </span><span class="m">700</span><span class="p">,</span><span class="s"> </span><span class="m">100</span><span class="p">,</span><span class="s">  </span><span class="m">10</span><span class="p">,</span><span class="s">  </span><span class="m">10</span><span class="p">,</span><span class="s">  </span><span class="m">125</span><span class="s">     </span><span class="c">% brocolli</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="nv">beans</span><span class="p">,</span><span class="s">         </span><span class="m">1900</span><span class="p">,</span><span class="s"> </span><span class="m">250</span><span class="p">,</span><span class="s">  </span><span class="m">60</span><span class="p">,</span><span class="s">  </span><span class="m">90</span><span class="p">,</span><span class="s">  </span><span class="m">150</span><span class="s"> </span><span class="p">|];</span><span class="s"> </span><span class="c">% beans</span><span class="s"></span>

<span class="nv">min_energy</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">3300</span><span class="p">;</span><span class="s"></span>
<span class="nv">min_protein</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">500</span><span class="p">;</span><span class="s"></span>
<span class="nv">max_salt</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">180</span><span class="p">;</span><span class="s"></span>
<span class="nv">max_fat</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">320</span><span class="p">;</span><span class="s"></span>
<span class="nv">desserts</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">icecream</span><span class="p">,</span><span class="s"> </span><span class="nv">banana</span><span class="p">,</span><span class="s"> </span><span class="nv">chocolotecake</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
<span class="nv">mains</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">lasagna</span><span class="p">,</span><span class="s"> </span><span class="nv">steak</span><span class="p">,</span><span class="s"> </span><span class="nv">rice</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
<span class="nv">sides</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">chips</span><span class="p">,</span><span class="s"> </span><span class="nv">brocolli</span><span class="p">,</span><span class="s"> </span><span class="nv">beans</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The model in <a class="reference internal" href="#ex-meal"><span class="std std-numref">Listing 2.3.3</span></a> searches for balanced meals.
Each meal item has a name (encoded as an integer), a kilojoule count,
protein in grams, salt in milligrams, and fat in grams, as well as cost
in cents.  The relationship between these items is encoded using
a <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">table</span><span class="s"></span></code> constraint.
The model searches for a minimal cost meal
which has a minimum kilojoule count
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">min_energy</span><span class="s"></span></code>, a minimum amount of protein <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">min_protein</span><span class="s"></span></code>,
maximum amount of salt <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">max_salt</span><span class="s"></span></code> and fat <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">max_fat</span><span class="s"></span></code>.</p>
</div>
<div class="section" id="regular">
<h3>2.3.1.4. Regular<a class="headerlink" href="#regular" title="Permalink to this headline">¶</a></h3>
<p id="index-5">The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">regular</span><span class="s"></span></code> constraint is used to enforce that a sequence of
variables takes a value defined by a finite automaton.
The usage of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">regular</span><span class="s"></span></code> has the form</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="bp">regular</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">Q</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">S</span><span class="p">,</span><span class="s"></span>
<span class="s">        </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">d</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">q0</span><span class="p">,</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">F</span><span class="p">)</span><span class="s"></span>
</pre></div>
</div>
<p>It constrains that
the sequence of values in array <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> (which must all be in the <span class="target" id="index-6"></span>range
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">S</span><span class="s"></span></code>)
is accepted by the <span class="target" id="index-7"></span>DFA of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Q</span><span class="s"></span></code> states with input <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">S</span><span class="s"></span></code>
and transition function <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">d</span><span class="s"></span></code> (which maps <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">&lt;</span><span class="m">1</span><span class="o">..</span><span class="nv">Q</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">S</span><span class="o">&gt;</span><span class="s"></span></code> to
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">0</span><span class="o">..</span><span class="nv">Q</span><span class="s"></span></code>) and initial state
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">q0</span><span class="s"></span></code> (which must be in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">Q</span><span class="s"></span></code>) and accepting states <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">F</span><span class="s"></span></code>
(which all must be in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">Q</span><span class="s"></span></code>).
State 0 is reserved to be an always failing state.</p>
<div class="figure" id="id3">
<span id="fig-dfa"></span><img alt="images/dfa.svg" src="images/dfa.svg" /><p class="caption"><span class="caption-number">Fig. 2.3.3 </span><span class="caption-text">A DFA determining correct rosters.</span></p>
</div>
<p>Consider a nurse rostering problem. Each nurse is scheduled for each day as
either: (d) on day shift, (n) on night shift, or (o) off.
In each four day period a nurse must have at least one day off, and
no nurse can be scheduled for 3 night shifts in a row.
This can be encoded using the incomplete DFA shown in <a class="reference internal" href="#fig-dfa"><span class="std std-numref">Fig. 2.3.3</span></a>.
We can encode this DFA as having start state <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="s"></span></code>, final states <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="m">6</span><span class="s"></span></code>,
and transition function</p>
<table border="1" class="table-nonfluid table-bordered docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">d</th>
<th class="head">n</th>
<th class="head">o</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>2</td>
<td>3</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>4</td>
<td>4</td>
<td>1</td>
</tr>
<tr class="row-even"><td>3</td>
<td>4</td>
<td>5</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>6</td>
<td>6</td>
<td>1</td>
</tr>
<tr class="row-even"><td>5</td>
<td>6</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Note that state 0 in the table indicates an error state.
The model shown in <a class="reference internal" href="#ex-nurse"><span class="std std-numref">Listing 2.3.5</span></a> finds a schedule for
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">num_nurses</span><span class="s"></span></code> nurses over <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">num_days</span><span class="s"></span></code> days, where we
require <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">req_day</span><span class="s"></span></code> nurses on day shift each day, and
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">req_night</span><span class="s"></span></code> nurses on night shift, and that each nurse
takes at least <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">min_night</span><span class="s"></span></code> night shifts.</p>
<div class="literal-block-wrapper docutils container" id="ex-nurse">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.5 </span><span class="caption-text">Model for nurse rostering using <tt class="docutils literal">regular</tt> constraint (<a class="reference download internal" href="downloads/nurse.mzn" download=""><tt class="xref download docutils literal">nurse.mzn</tt></a>)</span><a class="headerlink" href="#ex-nurse" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% Simple nurse rostering</span><span class="s"></span>
<span class="k">include</span><span class="s"> &quot;regular.mzn&quot;</span><span class="p">;</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">NURSE</span><span class="p">;</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">DAY</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">req_day</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">req_night</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">min_night</span><span class="p">;</span><span class="s"></span>

<span class="kt">enum</span><span class="s"> </span><span class="nv">SHIFT</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">d</span><span class="p">,</span><span class="s"> </span><span class="nv">n</span><span class="p">,</span><span class="s"> </span><span class="nv">o</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">S</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">card</span><span class="p">(</span><span class="nv">SHIFT</span><span class="p">);</span><span class="s"></span>

<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">Q</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">6</span><span class="p">;</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">q0</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="p">;</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">STATE</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">Q</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">STATE</span><span class="p">,</span><span class="nv">SHIFT</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">     </span><span class="p">[|</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="s">    </span><span class="c">% state 1</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="s">    </span><span class="c">% state 2</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="s">    </span><span class="c">% state 3</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="s">    </span><span class="c">% state 4</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="s">    </span><span class="c">% state 5</span><span class="s"></span>
<span class="s">      </span><span class="p">|</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">|];</span><span class="s"> </span><span class="c">% state 6 </span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">NURSE</span><span class="p">,</span><span class="nv">DAY</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">SHIFT</span><span class="p">:</span><span class="s"> </span><span class="nv">roster</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">DAY</span><span class="p">)(</span><span class="s"></span>
<span class="s">             </span><span class="nb">sum</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NURSE</span><span class="p">)(</span><span class="nv">roster</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">d</span><span class="p">)</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">req_day</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">             </span><span class="nb">sum</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NURSE</span><span class="p">)(</span><span class="nv">roster</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">n</span><span class="p">)</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">req_night</span><span class="s"></span>
<span class="s">           </span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NURSE</span><span class="p">)(</span><span class="s"></span>
<span class="s">             </span><span class="bp">regular</span><span class="p">([</span><span class="nv">roster</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">DAY</span><span class="p">],</span><span class="s"> </span><span class="nv">Q</span><span class="p">,</span><span class="s"> </span><span class="nv">S</span><span class="p">,</span><span class="s"> </span><span class="nv">t</span><span class="p">,</span><span class="s"> </span><span class="nv">q0</span><span class="p">,</span><span class="s"> </span><span class="nv">STATE</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">             </span><span class="nb">sum</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">DAY</span><span class="p">)(</span><span class="nv">roster</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">n</span><span class="p">)</span><span class="s"> </span><span class="o">&gt;=</span><span class="s"> </span><span class="nv">min_night</span><span class="s"></span>
<span class="s">           </span><span class="p">);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">roster</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="o">==</span><span class="nb">card</span><span class="p">(</span><span class="nv">DAY</span><span class="p">)</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot; &quot; </span><span class="k">endif</span><span class="s"></span>
<span class="s">       </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NURSE</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">DAY</span><span class="s"> </span><span class="p">];</span><span class="s"> </span>
</pre></div>
</div>
</div>
<p>Running the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc nurse.mzn nurse.dzn
</pre></div>
</div>
<p>finds a 10 day schedule for 7 nurses, requiring 3 on each day shift
and 2 on each night shift, with a minimum 2 night shifts per nurse.
A possible output is</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>d o n o n o d n o o
d o d n n o d d n o
o d d n o n d n o n
o d d d o n n o n n
d d n o d d n o d d
n n o d d d o d d d
n n o d d d o d d d
----------
</pre></div>
</div>
<p>There is an alternate form of the regular constraint
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">regular_nfa</span><span class="s"></span></code> which specifies the regular
expression using an NFA (without <span class="math notranslate nohighlight">\(\epsilon\)</span> arcs).
This constraint has the form</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="bp">regular_nfa</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">Q</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">S</span><span class="p">,</span><span class="s"></span>
<span class="s">        </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">d</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">q0</span><span class="p">,</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">F</span><span class="p">)</span><span class="s"></span>
</pre></div>
</div>
<p>It constrains that
the sequence of values in array <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> (which must all be in the range
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">S</span><span class="s"></span></code>)
is accepted by the <span class="target" id="index-8"></span>NFA of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Q</span><span class="s"></span></code> states with input <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">S</span><span class="s"></span></code>
and transition function <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">d</span><span class="s"></span></code> (which maps <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">&lt;</span><span class="m">1</span><span class="o">..</span><span class="nv">Q</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">S</span><span class="o">&gt;</span><span class="s"></span></code> to
subsets of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">Q</span><span class="s"></span></code>) and initial state
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">q0</span><span class="s"></span></code> (which must be in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">Q</span><span class="s"></span></code>) and accepting states <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">F</span><span class="s"></span></code>
(which all must be in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">Q</span><span class="s"></span></code>).
There is no need for a failing state 0, since the transition function can
map to an empty set of states.</p>
</div>
</div>
<div class="section" id="defining-predicates">
<h2>2.3.2. Defining Predicates<a class="headerlink" href="#defining-predicates" title="Permalink to this headline">¶</a></h2>
<p id="index-9">One of the most powerful modelling features
of MiniZinc is the ability for
the modeller to define their own high-level constraints. This allows them to
abstract and modularise their model. It also allows re-use of constraints in
different models and allows the development of application specific
libraries defining the standard constraints and types.</p>
<div class="literal-block-wrapper docutils container" id="ex-jobshop2">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.6 </span><span class="caption-text">Model for job shop scheduling using predicates (<a class="reference download internal" href="downloads/jobshop2.mzn" download=""><tt class="xref download docutils literal">jobshop2.mzn</tt></a>)</span><a class="headerlink" href="#ex-jobshop2" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">jobs</span><span class="p">;</span><span class="s">                                    </span><span class="c">% no of jobs</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">JOB</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">jobs</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">tasks</span><span class="p">;</span><span class="s">                                   </span><span class="c">% no of tasks per job</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">TASK</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">tasks</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="s"> </span><span class="p">[</span><span class="nv">JOB</span><span class="p">,</span><span class="nv">TASK</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">d</span><span class="p">;</span><span class="s">                   </span><span class="c">% task durations</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">total</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="p">)(</span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]);</span><span class="c">% total duration</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">digs</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">ceil</span><span class="p">(</span><span class="nb">log</span><span class="p">(</span><span class="m">10.0</span><span class="p">,</span><span class="nv">total</span><span class="p">));</span><span class="s">            </span><span class="c">% digits for output</span><span class="s"></span>
<span class="kt">array</span><span class="s"> </span><span class="p">[</span><span class="nv">JOB</span><span class="p">,</span><span class="nv">TASK</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">total</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">;</span><span class="s">          </span><span class="c">% start times</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">total</span><span class="p">:</span><span class="s"> </span><span class="nv">end</span><span class="p">;</span><span class="s">                            </span><span class="c">% total end time</span><span class="s"></span>

<span class="c">% nooverlap</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">no_overlap</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s1</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">d1</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s2</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">d2</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">    </span><span class="nv">s1</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d1</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s2</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">s2</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d2</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s1</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="c">%% ensure the tasks occur in sequence</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">tasks</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="s"> </span>
<span class="s">            </span><span class="p">(</span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="m">1</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">        </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">tasks</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">tasks</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">end</span><span class="s"></span>
<span class="s">    </span><span class="p">);</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="c">%% ensure no overlap of tasks</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">k</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">            </span><span class="nf">no_overlap</span><span class="p">(</span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">],</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">],</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">k</span><span class="p">,</span><span class="nv">j</span><span class="p">],</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">k</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"></span>
<span class="s">        </span><span class="p">)</span><span class="s"></span>
<span class="s">    </span><span class="p">);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">minimize</span><span class="s"> </span><span class="nv">end</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;end = </span><span class="p">\(</span><span class="nv">end</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">]</span><span class="s"> </span><span class="o">++</span><span class="s"></span>
<span class="s">       </span><span class="p">[</span><span class="s"> </span><span class="nb">show_int</span><span class="p">(</span><span class="nv">digs</span><span class="p">,</span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">++</span><span class="s"> &quot; &quot; </span><span class="o">++</span><span class="s"> </span>
<span class="s">         </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">tasks</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span><span class="s"></span>
<span class="s">         </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="s"> </span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>We start with a simple example, revisiting the job shop scheduling problem
from the previous section.  The model is shown in
<a class="reference internal" href="#ex-jobshop2"><span class="std std-numref">Listing 2.3.6</span></a>. The item of interest is the
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">predicate</span><span class="s"></span></code>
item:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span><span class="s"> </span><span class="nf">no_overlap</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s1</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">d1</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s2</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">d2</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">    </span><span class="nv">s1</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d1</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s2</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">s2</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d2</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s1</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>This defines a new constraint that enforces that a task with start time
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s1</span><span class="s"></span></code> and duration <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">d1</span><span class="s"></span></code> does not overlap with a task with start
time <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s2</span><span class="s"></span></code> and duration <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">d2</span><span class="s"></span></code>.  This can now be used inside the
model anywhere any other <span class="target" id="index-10"></span>Boolean expression
(involving decision variables)
can be used.</p>
<p>As well as predicates the modeller can define new constraints that only
involve parameters. These are useful to write fixed tests for a
conditional expression. These are defined using the keyword <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">test</span><span class="s"></span></code>.
For example</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">test</span><span class="s"> </span><span class="nf">even</span><span class="p">(</span><span class="kt">int</span><span class="p">:</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<div class="admonition-predicate-definitions admonition" id="defblock-0">
<p class="first admonition-title">Predicate definitions</p>
<p id="index-11">Predicates are defined by a statement of the form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span><span class="s"> </span><span class="cs">&lt;pred-name&gt;</span><span class="s"> </span><span class="p">(</span><span class="s"> </span><span class="cs">&lt;arg-def&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;arg-def&gt;</span><span class="s"> </span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="cs">&lt;bool-exp&gt;</span><span class="s"></span>
</pre></div>
</div>
<p>The <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;pred-name&gt;</span><span class="s"></span></code> must be a valid MiniZinc identifier, and
each <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;arg-def&gt;</span><span class="s"></span></code> is a valid MiniZinc <span class="target" id="index-12"></span>type declaration.</p>
<p>One relaxation of <span class="target" id="index-13"></span>argument
definitions is that the index types for arrays
can be <span class="target" id="index-14"></span>unbounded, written <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">int</span><span class="s"></span></code>.</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="k">test</span><span class="s"> </span><span class="cs">&lt;pred-name&gt;</span><span class="s"> </span><span class="p">(</span><span class="s"> </span><span class="cs">&lt;arg-def&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;arg-def&gt;</span><span class="s"> </span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="cs">&lt;bool-exp&gt;</span><span class="s"></span>
</pre></div>
</div>
<p>The <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;bool-exp&gt;</span><span class="s"></span></code> of the body must be fixed.</p>
<p>We also introduce a new form of the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">assert</span><span class="s"></span></code> command for use in
predicates.</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="nb">assert</span><span class="s"> </span><span class="p">(</span><span class="s"> </span><span class="cs">&lt;bool-exp&gt;</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;string-exp&gt;</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;exp&gt;</span><span class="s"> </span><span class="p">)</span><span class="s"></span>
</pre></div>
</div>
<p class="last">The type of the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">assert</span><span class="s"></span></code>
<span class="target" id="index-15"></span>expression
is the same as the type of the
last argument.
The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">assert</span><span class="s"></span></code> expression checks whether the first argument is false,
and if so prints the second argument string. If the first argument is true
it returns the third argument.</p>
</div>
<p>Note that <span class="target" id="index-16"></span>assert expressions
are lazy in the third argument, that is if the
first argument is false they will not be evaluated.
Hence, they can be used for checking:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span><span class="s"> </span><span class="nf">lookup</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">    </span><span class="nb">assert</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">),</span><span class="s"> &quot;index out of range in lookup&quot;</span>
<span class="s">           </span><span class="nv">y</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"></span>
<span class="s">    </span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>This code will not evaluate <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"></span></code> if <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">i</span><span class="s"></span></code> is out of the range of the array
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code>.</p>
</div>
<div class="section" id="defining-functions">
<h2>2.3.3. Defining Functions<a class="headerlink" href="#defining-functions" title="Permalink to this headline">¶</a></h2>
<p id="index-17">Functions are defined in MiniZinc
similarly to predicates, but with a more
general return type.</p>
<p>The function below defines the index in a Sudoku matrix
of the <span class="math notranslate nohighlight">\(a1^{th}\)</span> row (or column) of the <span class="math notranslate nohighlight">\(a^{th}\)</span> subsquare.</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nf">posn</span><span class="p">(</span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">a</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">a1</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nv">a</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">S</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">a1</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>With this definition we can replace the last constraint in the
Sudoku problem shown in <a class="reference internal" href="modelling2.html#ex-sudoku"><span class="std std-numref">Listing 2.2.5</span></a> by</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">a</span><span class="p">,</span><span class="s"> </span><span class="nv">o</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">SubSquareRange</span><span class="p">)(</span><span class="s"></span>
<span class="s">                  </span><span class="bp">alldifferent</span><span class="p">([</span><span class="s"> </span><span class="nv">puzzle</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nf">posn</span><span class="p">(</span><span class="nv">a</span><span class="p">,</span><span class="nv">a1</span><span class="p">),</span><span class="s"> </span><span class="nf">posn</span><span class="p">(</span><span class="nv">o</span><span class="p">,</span><span class="nv">o1</span><span class="p">)</span><span class="s"> </span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"></span>
<span class="s">                                         </span><span class="nv">a1</span><span class="p">,</span><span class="s"> </span><span class="nv">o1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">SubSquareRange</span><span class="s"> </span><span class="p">]</span><span class="s"> </span><span class="p">)</span><span class="s"> </span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>Functions are useful for encoding complex expressions that
are used frequently in the model.  For example, imagine
placing the numbers 1 to <span class="math notranslate nohighlight">\(n\)</span> in different positions
in an <span class="math notranslate nohighlight">\(n \times n\)</span> grid such that
the Manhattan distance between any two numbers <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>
is greater than the maximum of the two numbers minus 1.
The aim is to minimize the total of the Manhattan distances
between the pairs.  The Manhattan distance function
can be expressed as:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nf">manhattan</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x1</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">y1</span><span class="p">,</span><span class="s"></span>
<span class="s">                            </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x2</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">y2</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">         </span><span class="nb">abs</span><span class="p">(</span><span class="nv">x1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">x2</span><span class="p">)</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nb">abs</span><span class="p">(</span><span class="nv">y1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">y2</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>The complete model is shown in <a class="reference internal" href="#ex-manhattan"><span class="std std-numref">Listing 2.3.7</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-manhattan">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.7 </span><span class="caption-text">Model for a number placement problem illustrating the use of functions (<a class="reference download internal" href="downloads/manhattan.mzn" download=""><tt class="xref download docutils literal">manhattan.mzn</tt></a>).</span><a class="headerlink" href="#ex-manhattan" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">NUM</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">;</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">NUM</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">NUM</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">NUM</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">NUM</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">NUM</span><span class="p">,</span><span class="nv">NUM</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">2</span><span class="o">*</span><span class="nv">n</span><span class="o">-</span><span class="m">2</span><span class="p">:</span><span class="s"> </span><span class="nv">dist</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s">     </span><span class="nb">array2d</span><span class="p">(</span><span class="nv">NUM</span><span class="p">,</span><span class="nv">NUM</span><span class="p">,[</span><span class="s"> </span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nf">manhattan</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="nv">x</span><span class="p">[</span><span class="nv">j</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">endif</span><span class="s"></span>
<span class="s">                     </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NUM</span><span class="s"> </span><span class="p">]);</span><span class="s"></span>

<span class="c">% manf</span><span class="s"></span>
<span class="k">function</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nf">manhattan</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x1</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">y1</span><span class="p">,</span><span class="s"></span>
<span class="s">                            </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x2</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">y2</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">         </span><span class="nb">abs</span><span class="p">(</span><span class="nv">x1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">x2</span><span class="p">)</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nb">abs</span><span class="p">(</span><span class="nv">y1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">y2</span><span class="p">);</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NUM</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="p">)</span><span class="s"></span>
<span class="s">                 </span><span class="p">(</span><span class="nv">dist</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;=</span><span class="s"> </span><span class="nb">max</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">)</span><span class="o">-</span><span class="m">1</span><span class="p">);</span><span class="s"></span>

<span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">obj</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NUM</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="p">)(</span><span class="nv">dist</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]);</span><span class="s"></span>
<span class="k">solve</span><span class="s"> </span><span class="k">minimize</span><span class="s"> </span><span class="nv">obj</span><span class="p">;</span><span class="s"> </span>

<span class="c">% simply to display result</span><span class="s"></span>
<span class="k">include</span><span class="s"> &quot;alldifferent_except_0.mzn&quot;</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">NUM</span><span class="p">,</span><span class="nv">NUM</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">n</span><span class="p">:</span><span class="s"> </span><span class="nv">grid</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NUM</span><span class="p">)(</span><span class="nv">grid</span><span class="p">[</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">],</span><span class="nv">y</span><span class="p">[</span><span class="nv">i</span><span class="p">]]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">i</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="bp">alldifferent_except_0</span><span class="p">([</span><span class="nv">grid</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NUM</span><span class="p">]);</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;obj = </span><span class="p">\(</span><span class="nv">obj</span><span class="p">)</span><span class="s">;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">]</span><span class="s"> </span><span class="o">++</span><span class="s"></span>
<span class="s">       </span><span class="p">[</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nb">fix</span><span class="p">(</span><span class="nv">grid</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">grid</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="k">else</span><span class="s"> &quot;.&quot; </span><span class="k">endif</span><span class="s"></span>
<span class="s">         </span><span class="o">++</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">n</span><span class="s">  </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"> </span>
<span class="s">       </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">NUM</span><span class="s"> </span><span class="p">];</span><span class="s"> </span>
</pre></div>
</div>
</div>
<div class="admonition-function-definitions admonition" id="defblock-1">
<p class="first admonition-title">Function definitions</p>
<p id="index-18">Functions are defined by a statement of the form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="s"> </span><span class="cs">&lt;ret-type&gt;</span><span class="s"> </span><span class="p">:</span><span class="s"> </span><span class="cs">&lt;func-name&gt;</span><span class="s"> </span><span class="p">(</span><span class="s"> </span><span class="cs">&lt;arg-def&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;arg-def&gt;</span><span class="s"> </span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="cs">&lt;exp&gt;</span><span class="s"></span>
</pre></div>
</div>
<p class="last">The <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;func-name&gt;</span><span class="s"></span></code> must be a valid MiniZinc identifier, and
each <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;arg-def&gt;</span><span class="s"></span></code> is a valid MiniZinc type declaration.
The <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;ret-type&gt;</span><span class="s"></span></code> is the return type of the function which must be
the type of <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;exp&gt;</span><span class="s"></span></code>. Arguments have the same restrictions as in
predicate definitions.</p>
</div>
<p>Functions in MiniZinc can have any return type, not just fixed
return types.
Functions are useful for defining and documenting complex expressions that
are used mulitple times in a model.</p>
</div>
<div class="section" id="reflection-functions">
<h2>2.3.4. Reflection Functions<a class="headerlink" href="#reflection-functions" title="Permalink to this headline">¶</a></h2>
<p>To help write generic tests and predicates, various reflection functions
return information about array index sets, var set domains and decision
variable ranges. Those for index sets are
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nb">index_set</span><span class="p">(</span><span class="cs">&lt;1-D array&gt;</span><span class="p">)</span><span class="s"></span></code>,
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nb">index_set_1of2</span><span class="p">(</span><span class="cs">&lt;2-D array&gt;</span><span class="p">)</span><span class="s"></span></code>,
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nb">index_set_2of2</span><span class="p">(</span><span class="cs">&lt;2-D array&gt;</span><span class="p">)</span><span class="s"></span></code>,
and so on for higher
dimensional arrays.</p>
<p>A better model of the job shop conjoins all the non-overlap constraints for a
single machine into a single disjunctive constraint.
An advantage of this approach is that while we may initially model this
simply as a conjunction of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">non</span><span class="o">-</span><span class="nv">overlap</span><span class="s"></span></code> constraints, if the underlying solver has a
better approach to solving disjunctive constraints we can use that instead,
with minimal changes to our model. The model is shown in
<a class="reference internal" href="#ex-jobshop3"><span class="std std-numref">Listing 2.3.8</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-jobshop3">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.8 </span><span class="caption-text">Model for job shop scheduling using <tt class="docutils literal">disjunctive</tt> predicate (<a class="reference download internal" href="downloads/jobshop3.mzn" download=""><tt class="xref download docutils literal">jobshop3.mzn</tt></a>).</span><a class="headerlink" href="#ex-jobshop3" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;disjunctive.mzn&quot;</span><span class="p">;</span><span class="s"></span>

<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">jobs</span><span class="p">;</span><span class="s">                                    </span><span class="c">% no of jobs</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">JOB</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">jobs</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">tasks</span><span class="p">;</span><span class="s">                                   </span><span class="c">% no of tasks per job</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">TASK</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">tasks</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="s"> </span><span class="p">[</span><span class="nv">JOB</span><span class="p">,</span><span class="nv">TASK</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">d</span><span class="p">;</span><span class="s">                   </span><span class="c">% task durations</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">total</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="p">)(</span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]);</span><span class="c">% total duration</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">digs</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">ceil</span><span class="p">(</span><span class="nb">log</span><span class="p">(</span><span class="m">10.0</span><span class="p">,</span><span class="nv">total</span><span class="p">));</span><span class="s">            </span><span class="c">% digits for output</span><span class="s"></span>
<span class="kt">array</span><span class="s"> </span><span class="p">[</span><span class="nv">JOB</span><span class="p">,</span><span class="nv">TASK</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">total</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">;</span><span class="s">          </span><span class="c">% start times</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">total</span><span class="p">:</span><span class="s"> </span><span class="nv">end</span><span class="p">;</span><span class="s">                            </span><span class="c">% total end time</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="c">%% ensure the tasks occur in sequence</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">tasks</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="s"> </span>
<span class="s">            </span><span class="p">(</span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="m">1</span><span class="p">])</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">        </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">tasks</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">tasks</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">end</span><span class="s"></span>
<span class="s">    </span><span class="p">);</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="c">%% ensure no overlap of tasks</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="bp">disjunctive</span><span class="p">([</span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">],</span><span class="s"> </span><span class="p">[</span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">])</span><span class="s"></span>
<span class="s">    </span><span class="p">);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">minimize</span><span class="s"> </span><span class="nv">end</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;end = </span><span class="p">\(</span><span class="nv">end</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">]</span><span class="s"> </span><span class="o">++</span><span class="s"></span>
<span class="s">       </span><span class="p">[</span><span class="s"> </span><span class="nb">show_int</span><span class="p">(</span><span class="nv">digs</span><span class="p">,</span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">++</span><span class="s"> &quot; &quot; </span><span class="o">++</span><span class="s"> </span>
<span class="s">         </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">tasks</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span><span class="s"></span>
<span class="s">         </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="s"> </span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p id="index-19">The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">disjunctive</span><span class="s"></span></code>
constraint takes an array of start times for each
task and an array of their durations and makes sure that only one task is
active at any one
time. We define the disjunctive constraint as a <span class="target" id="index-20"></span>predicate with
signature</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span><span class="s"> </span><span class="bp">disjunctive</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">,</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">d</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>We can use the disjunctive constraint to define the non-overlap of tasks as
shown in <a class="reference internal" href="#ex-jobshop3"><span class="std std-numref">Listing 2.3.8</span></a>.
We assume a definition for the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">disjunctive</span><span class="s"></span></code> predicate is given
by the file <a class="reference download internal" href="downloads/disjunctive.mzn" download=""><tt class="xref download docutils literal">disjunctive.mzn</tt></a> which is included in the model.
If the underlying system
supports <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">disjunctive</span><span class="s"></span></code> directly, it will include a file
<a class="reference download internal" href="downloads/disjunctive.mzn" download=""><tt class="xref download docutils literal">disjunctive.mzn</tt></a> in its globals directory (with contents
just the signature definition above).
If the system we are using does not support disjunctive directly
we can give our own definition by creating the file
<a class="reference download internal" href="downloads/disjunctive.mzn" download=""><tt class="xref download docutils literal">disjunctive.mzn</tt></a>.
The simplest implementation simply makes use of the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">no_overlap</span><span class="s"></span></code>
predicate defined above.
A better implementation is to make use of a global <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">cumulative</span><span class="s"></span></code>
constraint assuming it is supported by the underlying solver.
<a class="reference internal" href="#ex-disj"><span class="std std-numref">Listing 2.3.9</span></a> shows an implementation of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">disjunctive</span><span class="s"></span></code>.
Note how we use the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">index_set</span><span class="s"></span></code> reflection function to
(a) check that the arguments to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">disjunctive</span><span class="s"></span></code> make sense,
and (b) construct the array of resource utilisations of the appropriate
size for <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">cumulative</span><span class="s"></span></code>.
Note also that we use a ternary version of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">assert</span><span class="s"></span></code> here.</p>
<div class="literal-block-wrapper docutils container" id="ex-disj">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.9 </span><span class="caption-text">Defining a <tt class="docutils literal">disjunctive</tt> predicate using <tt class="docutils literal">cumulative</tt> (<a class="reference download internal" href="downloads/disjunctive.mzn" download=""><tt class="xref download docutils literal">disjunctive.mzn</tt></a>).</span><a class="headerlink" href="#ex-disj" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;cumulative.mzn&quot;</span><span class="p">;</span><span class="s"></span>

<span class="k">predicate</span><span class="s"> </span><span class="bp">disjunctive</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">s</span><span class="p">,</span><span class="s"> </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">d</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">          </span><span class="nb">assert</span><span class="p">(</span><span class="nb">index_set</span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">d</span><span class="p">),</span><span class="s"> &quot;disjunctive: &quot; </span><span class="o">++</span><span class="s"></span>
<span class="s">          &quot;first and second arguments must have the same index set&quot;</span><span class="p">,</span><span class="s"></span>
<span class="s">            </span><span class="bp">cumulative</span><span class="p">(</span><span class="nv">s</span><span class="p">,</span><span class="s"> </span><span class="nv">d</span><span class="p">,</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="p">],</span><span class="s"> </span><span class="m">1</span><span class="p">)</span><span class="s"></span>
<span class="s">          </span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="local-variables">
<h2>2.3.5. Local Variables<a class="headerlink" href="#local-variables" title="Permalink to this headline">¶</a></h2>
<p id="index-21">It is often useful to introduce <em>local variables</em> in a predicate,
function
or test.
The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">let</span><span class="s"></span></code> expression allows you to do so.
It can be used to introduce
both decision <span class="target" id="index-22"></span>variables
and
<span class="target" id="index-23"></span>parameters,
but parameters must be initialised. For example:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="s"> </span><span class="nv">s</span><span class="o">..</span><span class="nv">e</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">;</span><span class="s"></span>
<span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">l</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">;</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">u</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">e</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">;</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">l</span><span class="s"> .. </span><span class="nv">u</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">;}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">2</span><span class="o">*</span><span class="nv">y</span><span class="s"></span>
</pre></div>
</div>
<p>introduces parameters <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">l</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">u</span><span class="s"></span></code> and variable <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">y</span><span class="s"></span></code>.
While most useful in <span class="target" id="index-24"></span>predicate, <span class="target" id="index-25"></span>function
and test definitions,
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">let</span><span class="s"></span></code> expressions can also be used in other expressions, for example
for eliminating common subexpressions:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">x1</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">x2</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">x3</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">x4</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">           </span><span class="nv">l</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">u</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>Local variables can be used anywhere and can be quite useful
for simplifying complex expressions.
<a class="reference internal" href="#ex-wedding2"><span class="std std-numref">Listing 2.3.10</span></a>
gives a revised version of the wedding model, using local variables to
define the <span class="target" id="index-26"></span>objective function,
rather than adding lots of variables
to the model explicitly.</p>
<div class="literal-block-wrapper docutils container" id="ex-wedding2">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.10 </span><span class="caption-text">Using local variables to define a complex objective function (<a class="reference download internal" href="downloads/wedding2.mzn" download=""><tt class="xref download docutils literal">wedding2.mzn</tt></a>).</span><a class="headerlink" href="#ex-wedding2" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">enum</span><span class="s"> </span><span class="nv">Guests</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">bride</span><span class="p">,</span><span class="s"> </span><span class="nv">groom</span><span class="p">,</span><span class="s"> </span><span class="nv">bestman</span><span class="p">,</span><span class="s"> </span><span class="nv">bridesmaid</span><span class="p">,</span><span class="s"> </span><span class="nv">bob</span><span class="p">,</span><span class="s"> </span><span class="nv">carol</span><span class="p">,</span><span class="s"> </span>
<span class="s">  </span><span class="nv">ted</span><span class="p">,</span><span class="s"> </span><span class="nv">alice</span><span class="p">,</span><span class="s"> </span><span class="nv">ron</span><span class="p">,</span><span class="s"> </span><span class="nv">rona</span><span class="p">,</span><span class="s"> </span><span class="nv">ed</span><span class="p">,</span><span class="s"> </span><span class="nv">clara</span><span class="p">};</span><span class="s"> </span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">Seats</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">12</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">Hatreds</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">5</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Hatreds</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">Guests</span><span class="p">:</span><span class="s"> </span><span class="nv">h1</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">groom</span><span class="p">,</span><span class="s"> </span><span class="nv">carol</span><span class="p">,</span><span class="s"> </span><span class="nv">ed</span><span class="p">,</span><span class="s"> </span><span class="nv">bride</span><span class="p">,</span><span class="s"> </span><span class="nv">ted</span><span class="p">];</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Hatreds</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">Guests</span><span class="p">:</span><span class="s"> </span><span class="nv">h2</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">clara</span><span class="p">,</span><span class="s"> </span><span class="nv">bestman</span><span class="p">,</span><span class="s"> </span><span class="nv">ted</span><span class="p">,</span><span class="s"> </span><span class="nv">alice</span><span class="p">,</span><span class="s"> </span><span class="nv">ron</span><span class="p">];</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">Guests</span><span class="p">:</span><span class="s"> </span><span class="nv">Males</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="nv">groom</span><span class="p">,</span><span class="s"> </span><span class="nv">bestman</span><span class="p">,</span><span class="s"> </span><span class="nv">bob</span><span class="p">,</span><span class="s"> </span><span class="nv">ted</span><span class="p">,</span><span class="s"> </span><span class="nv">ron</span><span class="p">,</span><span class="nv">ed</span><span class="p">};</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">Guests</span><span class="p">:</span><span class="s"> </span><span class="nv">Females</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="nv">bride</span><span class="p">,</span><span class="nv">bridesmaid</span><span class="p">,</span><span class="nv">carol</span><span class="p">,</span><span class="nv">alice</span><span class="p">,</span><span class="nv">rona</span><span class="p">,</span><span class="nv">clara</span><span class="p">};</span><span class="s"> </span>

<span class="kt">array</span><span class="p">[</span><span class="nv">Guests</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">Seats</span><span class="p">:</span><span class="s"> </span><span class="nv">pos</span><span class="p">;</span><span class="s"> </span><span class="c">% seat of guest</span><span class="s"></span>

<span class="k">include</span><span class="s"> &quot;alldifferent.mzn&quot;</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="bp">alldifferent</span><span class="p">(</span><span class="nv">pos</span><span class="p">);</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">g</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Males</span><span class="p">)(</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">g</span><span class="p">]</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">g</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Females</span><span class="p">)(</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">g</span><span class="p">]</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="p">);</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">ed</span><span class="p">]</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="p">{</span><span class="m">1,6</span><span class="p">,</span><span class="m">7,12</span><span class="p">});</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nb">abs</span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">bride</span><span class="p">]</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">groom</span><span class="p">])</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span>
<span class="s">           </span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">bride</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">6</span><span class="s"> </span><span class="o">&lt;-&gt;</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">groom</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">6</span><span class="p">);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">maximize</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">h</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Hatreds</span><span class="p">)(</span><span class="s"></span>
<span class="s">          </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s">  </span><span class="kt">var</span><span class="s"> </span><span class="nv">Seats</span><span class="p">:</span><span class="s"> </span><span class="nv">p1</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">h1</span><span class="p">[</span><span class="nv">h</span><span class="p">]];</span><span class="s"></span>
<span class="s">                 </span><span class="kt">var</span><span class="s"> </span><span class="nv">Seats</span><span class="p">:</span><span class="s"> </span><span class="nv">p2</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">h2</span><span class="p">[</span><span class="nv">h</span><span class="p">]];</span><span class="s"></span>
<span class="s">                 </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">1</span><span class="p">:</span><span class="s"> </span><span class="nv">same</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">p1</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">6</span><span class="s"> </span><span class="o">&lt;-&gt;</span><span class="s"> </span><span class="nv">p2</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">6</span><span class="p">);</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s">   </span>
<span class="s">          </span><span class="nv">same</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nb">abs</span><span class="p">(</span><span class="nv">p1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">p2</span><span class="p">)</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="nv">same</span><span class="p">)</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="m">13</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">p1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">p2</span><span class="p">)</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1</span><span class="p">));</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">g</span><span class="p">)</span><span class="o">++</span><span class="s">&quot; &quot; </span><span class="p">|</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Seats</span><span class="p">,</span><span class="nv">g</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Guests</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nb">fix</span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">g</span><span class="p">])</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">s</span><span class="p">]</span><span class="s"></span>
<span class="s">       </span><span class="o">++</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">];</span><span class="s"> </span>
</pre></div>
</div>
</div>
<p>Using <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">let</span><span class="s"></span></code> expressions, it is possible to define a function whose result is not well-defined. For example, we could write the following:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nf">x_or_x_plus_1</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"></span>
<span class="s">  </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">1</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
<span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">x</span><span class="o">+</span><span class="nv">y</span><span class="p">;</span><span class="s"> </span><span class="c">% result is not well-defined!</span><span class="s"></span>
</pre></div>
</div>
<p>The result, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="o">+</span><span class="nv">y</span><span class="s"></span></code>, is indeed not functionally defined by the argument of the function, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code>. The MiniZinc compiler does not detect this, and <strong>the behaviour of the resulting model is undefined</strong>. In particular, calling this function twice with the same argument may or may not return the same result. It is therefore important to make sure that any function you define is indeed a function! <strong>If you need non-deterministic behaviour, use a predicate:</strong></p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span><span class="s"> </span><span class="nf">x_or_x_plus_1</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">z</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"></span>
<span class="s">  </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">1</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
<span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">z</span><span class="o">=</span><span class="nv">x</span><span class="o">+</span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
</div>
<div class="section" id="context">
<span id="pred-context"></span><h2>2.3.6. Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h2>
<p id="index-27">One limitation is that predicates and functions
containing decision variables that are not
initialised in the declaration cannot be used inside a negative
context.
The following is illegal:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span><span class="s"> </span><span class="nf">even</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">          </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="nf">even</span><span class="p">(</span><span class="nv">z</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>The reason for this is that solvers only solve existentially constrained
problems, and if we introduce a local variable in a negative context, then
the variable is <em>universally quantified</em> and hence out of scope of the
underlying solvers. For example the <span class="math notranslate nohighlight">\(\neg \mathit{even}(z)\)</span> is equivalent to
<span class="math notranslate nohighlight">\(\neg \exists y. z = 2y\)</span> which is equivalent to
<span class="math notranslate nohighlight">\(\forall y. z \neq 2y\)</span>.</p>
<p>If local variables are given values, then they can be used in negative
contexts. The following is legal</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span><span class="s"> </span><span class="nf">even</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">          </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="m">2</span><span class="p">;</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="nf">even</span><span class="p">(</span><span class="nv">z</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>Note that the meaning of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">even</span><span class="s"></span></code> is correct, since if <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> is even
then <span class="math notranslate nohighlight">\(x = 2 * (x ~\mbox{div}~ 2)\)</span>. Note that for this definition
<span class="math notranslate nohighlight">\(\neg \mathit{even}(z)\)</span> is equivalent to
<span class="math notranslate nohighlight">\(\neg \exists y. y = z ~\mbox{div}~ 2 \wedge z = 2y\)</span> which is equivalent to
<span class="math notranslate nohighlight">\(\exists y. y = z ~\mbox{div}~ 2 \wedge \neg z \neq 2y\)</span>, because <span class="math notranslate nohighlight">\(y\)</span> is
functionally defined by <span class="math notranslate nohighlight">\(z\)</span>.</p>
<p>Every expression in MiniZinc appears in one of the four
<em>contexts</em>: <span class="target" id="index-28"></span>root, <span class="target" id="index-29"></span>positive,
<span class="target" id="index-30"></span>negative,
or <span class="target" id="index-31"></span>mixed.
The context of a non-Boolean expression is simply the context of its nearest
enclosing Boolean expression. The one exception is that the objective
expression appears in a root context (since it has no enclosing Boolean expression).</p>
<p>For the purposes of defining contexts we assume implication expressions
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">-&gt;</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code> are rewritten equivalently as <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">not</span><span class="s"> </span><span class="nv">e1</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code>,
and similarly <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">&lt;-</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code> is rewritten as  <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code>.</p>
<p>The context for a Boolean expression is given by:</p>
<dl class="docutils">
<dt>root</dt>
<dd><p class="first">root context is the context for any expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e</span><span class="s"></span></code> appearing as
the argument of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">constraint</span><span class="s"></span></code> or as an
<span class="target" id="index-32"></span>assignment item, or appearing as a sub expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"></span></code>
or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e2</span><span class="s"></span></code> in an expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code> occuring in a root context.</p>
<p class="last">Root context Boolean expressions must hold in any model of the problem.</p>
</dd>
<dt>positive</dt>
<dd><p class="first">positive context is the context for any expression
appearing as a sub expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"></span></code>
or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e2</span><span class="s"></span></code> in an expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code> occuring in a root
or positive context,
appearing as a sub expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"></span></code>
or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e2</span><span class="s"></span></code> in an expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code> occuring in a positive context,
or appearing as a sub expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e</span><span class="s"></span></code> in an expression
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">not</span><span class="s"> </span><span class="nv">e</span><span class="s"></span></code> appearing in a negative context.</p>
<p class="last">Positive context Boolean expressions need not hold in a model, but
making them hold will only increase the possibility that the enclosing
constraint holds. A positive context expression has an even number of
negations in the path from the enclosing root context to the expression.</p>
</dd>
<dt>negative</dt>
<dd><p class="first">negative context is the context for any expression appearing as a sub expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"></span></code>
or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e2</span><span class="s"></span></code> in an expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code> or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code> occuring in a negative context,
or appearing as a sub expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e</span><span class="s"></span></code> in an expression
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">not</span><span class="s"> </span><span class="nv">e</span><span class="s"></span></code> appearing in a positive context.</p>
<p class="last">Negative context Boolean expressions need not hold in a model, but
making them false will increase the possibility that the enclosing
constraint holds. A negative context expression has an odd number of
negations in the path from the enclosing root context to the expression.</p>
</dd>
<dt>mixed</dt>
<dd><p class="first">mixed context is the context for any Boolean expression appearing
as a subexpression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"></span></code> or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e2</span><span class="s"></span></code> in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">&lt;-&gt;</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code>, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code>, or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">e</span><span class="p">)</span><span class="s"></span></code>.</p>
<p class="last">Mixed context expression are effectively both positive and
negative. This can be seen from the fact that <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e1</span><span class="s"> </span><span class="o">&lt;-&gt;</span><span class="s"> </span><span class="nv">e2</span><span class="s"></span></code> is equivalent
to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">(</span><span class="nv">e1</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">e2</span><span class="p">)</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="p">(</span><span class="o">not</span><span class="s"> </span><span class="nv">e1</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="nv">e2</span><span class="p">)</span><span class="s"></span></code> and
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">e</span><span class="p">)</span><span class="s"></span></code> is equivalent to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">(</span><span class="nv">e</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">x</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="p">(</span><span class="o">not</span><span class="s"> </span><span class="nv">e</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">x</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="s"></span></code>.</p>
</dd>
</dl>
<p>Consider the code fragment</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">4</span><span class="s"> </span><span class="o">-&gt;</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">x</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="nv">i</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">5</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>then <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="m">0</span><span class="s"></span></code> is in the root context, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">4</span><span class="gr">}</span><span class="s"></span></code> is in a negative
context,
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">x</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="nv">i</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">5</span><span class="s"></span></code>
is in a positive context, and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="nv">i</span><span class="s"></span></code> is in a mixed context.</p>
</div>
<div class="section" id="local-constraints">
<h2>2.3.7. Local Constraints<a class="headerlink" href="#local-constraints" title="Permalink to this headline">¶</a></h2>
<p id="index-33">Let expressions can also be used to include local constraints,
usually to constrain the behaviour of local variables.
For example, consider defining an integer square root function making use
of only multiplication:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nf">mysqrt</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">         </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">infinity</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
<span class="s">               </span><span class="k">constraint</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>The local constraints ensure
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">y</span><span class="s"></span></code> takes the correct value; which is then returned
by the function.</p>
<p>Local constraints can be used in any let expression,
though the most common
usage is in defining functions.
A function with local constraints is often <em>partial</em>, which means that it is not defined for all possible inputs. For example, the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">mysqrt</span><span class="s"></span></code> function above constrains its argument <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> to take a value that is in fact the square of an integer. The MiniZinc compiler handles these cases according to the <em>relational semantics</em>, which means that the result of applying a partial function may become false in its enclosing Boolean context. For example, consider the following model:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="p">(</span><span class="nv">x</span><span class="o">=</span><span class="m">3</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">y</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nf">mysqrt</span><span class="p">(</span><span class="nv">x</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>Clearly, the intention of the modeller is that <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="nv">y</span><span class="o">=</span><span class="m">0</span><span class="s"></span></code> should be a solution. This requires the compiler to take care not to “lift” the constraint <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="o">=</span><span class="nv">y</span><span class="o">*</span><span class="nv">y</span><span class="s"></span></code> out of the context of the function, because that would prevent it from finding any solution with <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="o">=</span><span class="m">3</span><span class="s"></span></code>. You can verify that the set of solutions contains <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="nv">y</span><span class="o">=</span><span class="m">0</span><span class="s"></span></code> as well as the expected <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="nv">y</span><span class="o">=</span><span class="m">1</span><span class="s"></span></code>, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="o">=</span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="nv">y</span><span class="o">=</span><span class="m">2</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="o">=</span><span class="m">9</span><span class="p">,</span><span class="s"> </span><span class="nv">y</span><span class="o">=</span><span class="m">3</span><span class="s"></span></code>.</p>
<p>If you define a <em>total</em> function using local constraints, you can give the compiler a hint that allows it to produce more efficient code. For example, you could write the square function (not square root, note the subtle difference) as follows:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nf">mysqr</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="p">::</span><span class="nv">promise_total</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">         </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">infinity</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
<span class="s">               </span><span class="k">constraint</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">x</span><span class="p">;</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>This function is indeed defined for any input value <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code>. The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">::</span><span class="nv">promise_total</span><span class="s"></span></code> annotation tells the compiler that it can safely lift all local constraints out of the context of the function call.</p>
<div class="admonition-let-expressions admonition" id="defblock-2">
<p class="first admonition-title">Let expressions</p>
<p id="index-34"><span class="target" id="index-35"></span>Local variables
can be introduced in any expression with a <em>let expression</em>
of the form:</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="cs">&lt;dec&gt;</span><span class="p">;</span><span class="s"> ... </span><span class="cs">&lt;dec&gt;</span><span class="s"> </span><span class="p">;</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="cs">&lt;exp&gt;</span><span class="s"></span>
</pre></div>
</div>
<p>The declarations <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;dec&gt;</span><span class="s"></span></code>
can be declarations of decision variables and
parameters (which must be initialised) or constraint items.
No declaration can make use of a newly declared variable
before it is introduced.</p>
<p class="last">Note that local variables and constraints
cannot occur in tests.
Local variables cannot occur in predicates
or functions that appear in a
<span class="target" id="index-36"></span>negative or <span class="target" id="index-37"></span>mixed context,
unless the variable is defined by an expression.</p>
</div>
</div>
<div class="section" id="domain-reflection-functions">
<h2>2.3.8. Domain Reflection Functions<a class="headerlink" href="#domain-reflection-functions" title="Permalink to this headline">¶</a></h2>
<p id="index-38">Other important reflection functions are those that allow us to access
the domains of variables. The expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">lb</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"></span></code>
returns
a value that is lower than or equal to any value that <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> may take in
a solution of the problem. Usually it will just be the
declared lower <span class="target" id="index-39"></span>bound of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code>.
If <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> is declared as a non-finite type, e.g.
simply <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="s"></span></code>
then it is an error.
Similarly the expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">dom</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"></span></code>
returns a (non-strict)
superset of the possible values of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> in any solution of the problem.
Again it is usually the declared values, and again if it is not
declared as finite then there is an error.</p>
<div class="literal-block-wrapper docutils container" id="ex-reflect">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.11 </span><span class="caption-text">Using reflection predicates (<a class="reference download internal" href="downloads/reflection.mzn" download=""><tt class="xref download docutils literal">reflection.mzn</tt></a>).</span><a class="headerlink" href="#ex-reflect" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="s"> </span><span class="o">-</span><span class="m">10</span><span class="o">..</span><span class="m">10</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">4</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">lb</span><span class="p">(</span><span class="nv">x</span><span class="p">);</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">D</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">dom</span><span class="p">(</span><span class="nv">x</span><span class="p">);</span><span class="s"></span>
<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>
<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;y = &quot;</span><span class="p">,</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">y</span><span class="p">),</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">D = &quot;</span><span class="p">,</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">D</span><span class="p">),</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>For example, the model show in <a class="reference internal" href="#ex-reflect"><span class="std std-numref">Listing 2.3.11</span></a>
may output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>y = -10
D = -10..10
----------
</pre></div>
</div>
<p>or</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>y = 0
D = {0, 1, 2, 3, 4}
----------
</pre></div>
</div>
<p>or any answer with
<span class="math notranslate nohighlight">\(-10 \leq y \leq 0\)</span> and
<span class="math notranslate nohighlight">\(\{0, \ldots, 4\} \subseteq D \subseteq \{-10, \ldots, 10\}\)</span>.</p>
<p>Variable domain reflection expressions should be used in a manner where they are
correct for any safe approximations, but note this is not checked!
For example the additional code</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="s"> </span><span class="o">-</span><span class="m">10</span><span class="o">..</span><span class="m">10</span><span class="p">:</span><span class="s"> </span><span class="nv">z</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">z</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>is not a safe usage of the domain information.
Since using the tighter (correct) approximation leads to
more solutions than the weaker initial approximation.</p>
<div class="admonition-domain-reflection admonition" id="defblock-3">
<p class="first admonition-title">Domain reflection</p>
<p id="index-40">There are reflection functions to interrogate
the possible values of expressions containing variables:</p>
<ul class="simple">
<li><code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nb">dom</span><span class="p">(</span><span class="cs">&lt;exp&gt;</span><span class="p">)</span><span class="s"></span></code>
returns a safe approximation to the possible values of the expression.</li>
<li><code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nb">lb</span><span class="p">(</span><span class="cs">&lt;exp&gt;</span><span class="p">)</span><span class="s"></span></code>
returns a safe approximation to the lower bound value of the expression.</li>
<li><code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nb">ub</span><span class="p">(</span><span class="cs">&lt;exp&gt;</span><span class="p">)</span><span class="s"></span></code>
returns a safe approximation to the upper bound value of the expression.</li>
</ul>
<p>The expressions for <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">lb</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">ub</span><span class="s"></span></code>
can only be of types <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">int</span><span class="s"></span></code>, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">bool</span><span class="s"></span></code>,
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">float</span><span class="s"></span></code> or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="s"></span></code>.
For <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">dom</span><span class="s"></span></code> the type cannot be <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">float</span><span class="s"></span></code>.
If one of the variables appearing in <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;exp&gt;</span><span class="s"></span></code> has a
<span class="target" id="index-41"></span>non-finite declared type
(e.g. <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="s"></span></code> or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">var</span><span class="s"> </span><span class="kt">float</span><span class="s"></span></code>)
then an error can occur.</p>
<p>There are also versions that work directly on arrays of expressions (with
similar restrictions):</p>
<ul class="last simple">
<li><code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nb">dom_array</span><span class="p">(</span><span class="cs">&lt;array-exp&gt;</span><span class="p">)</span><span class="s"></span></code>:
returns a safe approximation to the union of all
possible values of the expressions appearing in the array.</li>
<li><code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nb">lb_array</span><span class="p">(</span><span class="cs">&lt;array-exp&gt;</span><span class="p">)</span><span class="s"></span></code>
returns a safe approximation to the lower bound of all expressions appearing
in the array.</li>
<li><code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nb">ub_array</span><span class="p">(</span><span class="cs">&lt;array-exp&gt;</span><span class="p">)</span><span class="s"></span></code>
returns a safe approximation to the upper bound of all expressions appearing
in the array.</li>
</ul>
</div>
<p>The combinations of predicates, local variables and domain reflection
allows the definition of complex global constraints by decomposition.
We can define the time based decomposition
of the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">cumulative</span><span class="s"></span></code>
constraint using the code shown in <a class="reference internal" href="#ex-cumul"><span class="std std-numref">Listing 2.3.12</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-cumul">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.12 </span><span class="caption-text">Defining a <tt class="docutils literal">cumulative</tt> predicate by decomposition (<a class="reference download internal" href="downloads/cumulative.mzn" download=""><tt class="xref download docutils literal">cumulative.mzn</tt></a>).</span><a class="headerlink" href="#ex-cumul" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">%--------------------------------------------------------------------%</span><span class="s"></span>
<span class="c">% Requires that a set of tasks given by start times &#39;s&#39;, </span><span class="s"></span>
<span class="c">% durations &#39;d&#39;, and resource requirements &#39;r&#39;, </span><span class="s"></span>
<span class="c">% never require more than a global </span><span class="s"></span>
<span class="c">% resource bound &#39;b&#39; at any one time.</span><span class="s"></span>
<span class="c">% Assumptions:</span><span class="s"></span>
<span class="c">% - forall i, d[i] &gt;= 0 and r[i] &gt;= 0</span><span class="s"></span>
<span class="c">%--------------------------------------------------------------------%</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="bp">cumulative</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">,</span><span class="s"></span>
<span class="s">                     </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">d</span><span class="p">,</span><span class="s"></span>
<span class="s">                     </span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">r</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">   </span><span class="nb">assert</span><span class="p">(</span><span class="nb">index_set</span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">d</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span>
<span class="s">          </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">r</span><span class="p">),</span><span class="s"></span>
<span class="s">     &quot;cumulative: the array arguments must have identical index sets&quot;</span><span class="p">,</span><span class="s"></span>
<span class="s">   </span><span class="nb">assert</span><span class="p">(</span><span class="nb">lb_array</span><span class="p">(</span><span class="nv">d</span><span class="p">)</span><span class="s"> </span><span class="o">&gt;=</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nb">lb_array</span><span class="p">(</span><span class="nv">r</span><span class="p">)</span><span class="s"> </span><span class="o">&gt;=</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"></span>
<span class="s">     &quot;cumulative: durations and resource usages must be non-negative&quot;</span><span class="p">,</span><span class="s"></span>
<span class="s">           </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span>
<span class="s">               </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">times</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">                 </span><span class="nb">lb_array</span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="s"> ..</span>
<span class="s">                 </span><span class="nb">max</span><span class="p">([</span><span class="s"> </span><span class="nb">ub</span><span class="p">(</span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">])</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nb">ub</span><span class="p">(</span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">])</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="p">])</span><span class="s"> </span>
<span class="s">               </span><span class="p">}</span><span class="s"> </span>
<span class="s">           </span><span class="k">in</span><span class="s"></span>
<span class="s">              </span><span class="k">forall</span><span class="p">(</span><span class="s"> </span><span class="nv">t</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">times</span><span class="s"> </span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">                 </span><span class="nv">b</span><span class="s"> </span><span class="o">&gt;=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">                    </span><span class="nb">bool2int</span><span class="p">(</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">t</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">t</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="p">)</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">r</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"></span>
<span class="s">                 </span><span class="p">)</span><span class="s"></span>
<span class="s">              </span><span class="p">)</span><span class="s"></span>
<span class="s">       </span><span class="p">)</span><span class="s"></span>
<span class="s">   </span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The decomposition uses <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">lb</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">ub</span><span class="s"></span></code> to determine
the set of times <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">times</span><span class="s"></span></code> over which tasks could range.
It then asserts for each time <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">t</span><span class="s"></span></code> in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">times</span><span class="s"></span></code> that the
sum of resources for the active tasks at time <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">t</span><span class="s"></span></code> is less than
the bound <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">b</span><span class="s"></span></code>.</p>
</div>
<div class="section" id="scope">
<h2>2.3.9. Scope<a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h2>
<p id="index-42">It is worth briefly mentioning the scope of declarations in MiniZinc.
MiniZinc has a single namespace, so all variables appearing
in declarations are visible in every expression in the model.
MiniZinc introduces locally scoped
variables in a number of ways:</p>
<ul class="simple">
<li>as <span class="target" id="index-43"></span>iterator
variables in <span class="target" id="index-44"></span>comprehension expressions</li>
<li>using <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">let</span><span class="s"></span></code> expressions</li>
<li>as predicate and function <span class="target" id="index-45"></span>arguments</li>
</ul>
<p>Any local scoped variable overshadows the outer scoped variables
of the same name.</p>
<div class="literal-block-wrapper docutils container" id="ex-scope">
<div class="code-block-caption"><span class="caption-number">Listing 2.3.13 </span><span class="caption-text">A model for illustrating scopes of variables (<a class="reference download internal" href="downloads/scope.mzn" download=""><tt class="xref download docutils literal">scope.mzn</tt></a>).</span><a class="headerlink" href="#ex-scope" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">3</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">4</span><span class="p">;</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">smallx</span><span class="p">(</span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="nv">y</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="o">-</span><span class="nv">x</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">x</span><span class="p">;</span><span class="s"></span>
<span class="k">predicate</span><span class="s"> </span><span class="nf">p</span><span class="p">(</span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">u</span><span class="p">,</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s">      </span><span class="nf">exists</span><span class="p">(</span><span class="nv">x</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">u</span><span class="p">)(</span><span class="nv">y</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nf">smallx</span><span class="p">(</span><span class="nv">x</span><span class="p">));</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nf">p</span><span class="p">(</span><span class="nv">x</span><span class="p">,</span><span class="l">false</span><span class="p">);</span><span class="s"></span>
<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>For example, in the model shown in <a class="reference internal" href="#ex-scope"><span class="std std-numref">Listing 2.3.13</span></a>
the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">-</span><span class="nv">x</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">y</span><span class="s"></span></code> is the global <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code>,
the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> in
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nf">smallx</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"></span></code> is the iterator <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">u</span><span class="s"></span></code>,
while the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">y</span><span class="s"></span></code> in the disjunction is the second
argument of the predicate.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="optiontypes.html" class="btn btn-neutral float-right" title="2.4. Option Types" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="modelling2.html" class="btn btn-neutral" title="2.2. More Complex Models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, 2017, 2018, Peter J. Stuckey, Kim Marriott, Guido Tack.

    </p>
  </div>
<a rel="license" href="http://creativecommons.org/licenses/by-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nd/4.0/80x15.png" /></a>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.3.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="static/jquery.js"></script>
      <script type="text/javascript" src="static/underscore.js"></script>
      <script type="text/javascript" src="static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>