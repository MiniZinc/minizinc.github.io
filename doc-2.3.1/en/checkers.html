

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head><-- analytics -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-63390311-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-63390311-1');
</script>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.4. Automatic Solution Checking &mdash; The MiniZinc Handbook 2.3.1</title>
  

  
  
  
  
    <link rel="canonical" href="http://www.minizinc.org/doc-latest/en/checkers.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="static/style.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3.5. Globalizer" href="globalizer.html" />
    <link rel="prev" title="3.3. Solving Technologies and Solver Backends" href="solvers.html" />
    <link rel="apple-touch-icon" sizes="57x57" href="static/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="static/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="static/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="static/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="static/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="static/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="static/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="static/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="static/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="static/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="static/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/favicon/favicon-16x16.png">
    <link rel="manifest" href="static/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="static/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">


  
  <script src="static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="http://www.minizinc.org">
          
            
            <img src="static/MiniZn_logo_2.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
              <div class="version">
                2.3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            <a href="index.html" class="reference internal icon icon-home"> The MiniZinc Handbook </a>
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="part_1_overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="part_2_tutorial.html">2. A MiniZinc Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="part_3_user_manual.html">3. User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="command_line.html">3.1. The MiniZinc Command Line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="minizinc_ide.html">3.2. The MiniZinc IDE</a></li>
<li class="toctree-l2"><a class="reference internal" href="solvers.html">3.3. Solving Technologies and Solver Backends</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.4. Automatic Solution Checking</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-checker-models">3.4.1. Basic checker models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#detailed-feedback">3.4.2. Detailed feedback</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instance-data-in-checker-models">3.4.3. Instance data in checker models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checking-optimisation-problems">3.4.4. Checking optimisation problems</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hidden-variables">3.4.5. Hidden variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="globalizer.html">3.5. Globalizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="find_mus.html">3.6. FindMUS</a></li>
<li class="toctree-l2"><a class="reference internal" href="jupyter.html">3.7. Using MiniZinc in Jupyter Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html">3.8. Python Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation_detailed.html">3.9. Installation from Source Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="part_4_reference.html">4. Reference Manual</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">The MiniZinc Handbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="part_3_user_manual.html">3. User Manual</a> &raquo;</li>
        
      <li>3.4. Automatic Solution Checking</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="automatic-solution-checking">
<span id="ch-solution-checkers"></span><h1>3.4. Automatic Solution Checking<a class="headerlink" href="#automatic-solution-checking" title="Permalink to this headline">¶</a></h1>
<p>MiniZinc provides support for checking the correctness of solutions of a model by using a <em>checker model</em>. This approach has two main applications:</p>
<ul class="simple">
<li>Instructors can provide checker models for student assignments. This provides students with immediate, detailed feedback on their modelling attempts.</li>
<li>A simplified checker model can be used to verify a complex model used for solving. This can be useful when experimenting with new decompositions of constraints, or for post-processing solutions if some constraints cannot be added to the original model (e.g. in case the solver does not support certain constructs).</li>
</ul>
<p>Running MiniZinc with solution checking is easy. On the command line, simply pass the name of the checker model in addition to the problem model:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>minizinc model.mzn model.mzc.mzn data.dzn
</pre></div>
</div>
<p>Checker models can be pre-compiled in order to obfuscate their contents (e.g. if they contain clues to students how to model the problem):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>minizinc --compile-solution-checker model.mzc.mzn
</pre></div>
</div>
<p>This will create the compiled checker model <tt class="docutils literal">model.mzc</tt>, which can be used instead of the clear text version for checking:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>minizinc model.mzn model.mzc data.dzn
</pre></div>
</div>
<p>The MiniZinc IDE has built-in support for solution checkers. Whenever the current project contains a file with the same file name as the current model but file extension <tt class="docutils literal">.mzc</tt> or <tt class="docutils literal">.mzc.mzn</tt>, the “Run” button turns into a “Run+Check” button.</p>
<p>The rest of this section describes how to implement checker models.</p>
<div class="section" id="basic-checker-models">
<h2>3.4.1. Basic checker models<a class="headerlink" href="#basic-checker-models" title="Permalink to this headline">¶</a></h2>
<p>At its core, a checker model takes each solution that a solver produces as input, and outputs whether the solution is correct or not. Let’s use the simple map colouring model from the tutorial as an example. Here is the model again:</p>
<div class="literal-block-wrapper docutils container" id="ex-aust-2">
<div class="code-block-caption"><span class="caption-number">Listing 3.4.1 </span><span class="caption-text">A MiniZinc model <a class="reference download internal" href="downloads/aust.mzn" download=""><tt class="xref download docutils literal">aust.mzn</tt></a> for colouring the states and territories in Australia</span><a class="headerlink" href="#ex-aust-2" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% Colouring Australia using nc colours</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">nc</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">3</span><span class="p">;</span><span class="s"></span>

<span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">nc</span><span class="p">:</span><span class="s"> </span><span class="nv">wa</span><span class="p">;</span><span class="s">   </span><span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">nc</span><span class="p">:</span><span class="s"> </span><span class="nv">nt</span><span class="p">;</span><span class="s">  </span><span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">nc</span><span class="p">:</span><span class="s"> </span><span class="nv">sa</span><span class="p">;</span><span class="s">   </span><span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">nc</span><span class="p">:</span><span class="s"> </span><span class="nv">q</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">nc</span><span class="p">:</span><span class="s"> </span><span class="nv">nsw</span><span class="p">;</span><span class="s">  </span><span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">nc</span><span class="p">:</span><span class="s"> </span><span class="nv">v</span><span class="p">;</span><span class="s">   </span><span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">nc</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="p">;</span><span class="s"></span>

<span class="c">%constraint wa != nt;</span><span class="s"></span>
<span class="c">%constraint wa != sa;</span><span class="s"></span>
<span class="c">%constraint nt != sa;</span><span class="s"></span>
<span class="c">%constraint nt != q;</span><span class="s"></span>
<span class="c">%constraint sa != q;</span><span class="s"></span>
<span class="c">%constraint sa != nsw;</span><span class="s"></span>
<span class="c">%constraint sa != v;</span><span class="s"></span>
<span class="c">%constraint q != nsw;</span><span class="s"></span>
<span class="c">%constraint nsw != v;</span><span class="s"></span>
<span class="c">%solve satisfy;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;wa=</span><span class="p">\(</span><span class="nv">wa</span><span class="p">)</span><span class="se">\t</span><span class="s"> nt=</span><span class="p">\(</span><span class="nv">nt</span><span class="p">)</span><span class="se">\t</span><span class="s"> sa=</span><span class="p">\(</span><span class="nv">sa</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s"></span>
<span class="s">        &quot;q=</span><span class="p">\(</span><span class="nv">q</span><span class="p">)</span><span class="se">\t</span><span class="s"> nsw=</span><span class="p">\(</span><span class="nv">nsw</span><span class="p">)</span><span class="se">\t</span><span class="s"> v=</span><span class="p">\(</span><span class="nv">v</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s"></span>
<span class="s">         &quot;t=&quot;</span><span class="p">,</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">t</span><span class="p">),</span><span class="s">  &quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>A checker model for this model requires the values of the variables <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">wa</span><span class="s"></span></code>, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">nt</span><span class="s"></span></code>, and so on, for each solution, and then has to test whether all constraints hold. The output of the checker model should contain a line starting with <tt class="docutils literal">CORRECT</tt> if the solution passes the test, or <tt class="docutils literal">INCORRECT</tt> if it doesn’t.</p>
<p>Since these values will be fixed in any solution, checker models simply declare parameters with the same name as the model variables:</p>
<div class="literal-block-wrapper docutils container" id="ex-aust-check">
<div class="code-block-caption"><span class="caption-number">Listing 3.4.2 </span><span class="caption-text">A MiniZinc checker model <a class="reference download internal" href="downloads/aust.mzc.mzn" download=""><tt class="xref download docutils literal">aust.mzc.mzn</tt></a> for the map colouring problem</span><a class="headerlink" href="#ex-aust-check" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">wa</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">nt</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">sa</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">q</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">nsw</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">v</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nv">wa</span><span class="o">!=</span><span class="nv">nt</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">wa</span><span class="o">!=</span><span class="nv">sa</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">nt</span><span class="o">!=</span><span class="nv">sa</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">nt</span><span class="o">!=</span><span class="nv">q</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">sa</span><span class="o">!=</span><span class="nv">q</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">     </span><span class="nv">sa</span><span class="o">!=</span><span class="nv">nsw</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">sa</span><span class="o">!=</span><span class="nv">v</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">q</span><span class="o">!=</span><span class="nv">nsw</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">nsw</span><span class="o">!=</span><span class="nv">v</span><span class="s"></span>
<span class="s">  </span><span class="k">then</span><span class="s"> &quot;CORRECT</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">  </span><span class="k">else</span><span class="s"> &quot;INCORRECT</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">  </span><span class="k">endif</span><span class="s"></span>
<span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>Running the model and the checker will produce output like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>wa=3   nt=2    sa=1
q=3    nsw=2   v=3
t=3
% Solution checker report:
% CORRECT
----------
</pre></div>
</div>
<p>The solution checker report is embedded as comments in the original output.</p>
</div>
<div class="section" id="detailed-feedback">
<h2>3.4.2. Detailed feedback<a class="headerlink" href="#detailed-feedback" title="Permalink to this headline">¶</a></h2>
<p>The basic checker model above only reports whether the solutions satisfy the constraints, but it doesn’t provide any insights into the nature of the error if a constraint is violated.</p>
<p>We can use standard MiniZinc functionality to provide much more detailed feedback. The following checker model introduces a helper function <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">check</span><span class="s"></span></code> which outputs a detailed error message if a constraint doesn’t hold. The results of all the checks are combined, and if any of the constraints was violated, the output is <tt class="docutils literal">INCORRECT</tt>, otherwise it is <tt class="docutils literal">CORRECT</tt>.</p>
<div class="literal-block-wrapper docutils container" id="ex-aust-check-2">
<div class="code-block-caption"><span class="caption-number">Listing 3.4.3 </span><span class="caption-text">A checker model <a class="reference download internal" href="downloads/aust-2.mzc.mzn" download=""><tt class="xref download docutils literal">aust-2.mzc.mzn</tt></a> for the map colouring problem with more detailed error messages</span><a class="headerlink" href="#ex-aust-check-2" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">wa</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">nt</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">sa</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">q</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">nsw</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">v</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="p">;</span><span class="s"></span>

<span class="k">test</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="p">,</span><span class="kt">string</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nv">b</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nf">trace_stdout</span><span class="p">(</span><span class="s">&quot;ERROR: &quot;</span><span class="o">++</span><span class="nv">s</span><span class="o">++</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="l">false</span><span class="p">)</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nv">wa</span><span class="o">!=</span><span class="nv">nt</span><span class="p">,</span><span class="s"> &quot;wa and nt have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nv">wa</span><span class="o">!=</span><span class="nv">sa</span><span class="p">,</span><span class="s"> &quot;wa and sa have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nv">nt</span><span class="o">!=</span><span class="nv">sa</span><span class="p">,</span><span class="s"> &quot;nt and sa have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nv">nt</span><span class="o">!=</span><span class="nv">q</span><span class="p">,</span><span class="s"> &quot;nt and q have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nv">sa</span><span class="o">!=</span><span class="nv">q</span><span class="p">,</span><span class="s"> &quot;sa and q have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nv">sa</span><span class="o">!=</span><span class="nv">nsw</span><span class="p">,</span><span class="s"> &quot;sa and nsw have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nv">sa</span><span class="o">!=</span><span class="nv">v</span><span class="p">,</span><span class="s"> &quot;sa and v have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nv">q</span><span class="o">!=</span><span class="nv">nsw</span><span class="p">,</span><span class="s"> &quot;q and nsw have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nv">nsw</span><span class="o">!=</span><span class="nv">v</span><span class="p">,</span><span class="s"> &quot;nsw and v have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="k">then</span><span class="s"> &quot;CORRECT: all constraints hold.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">  </span><span class="k">else</span><span class="s"> &quot;INCORRECT</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">  </span><span class="k">endif</span><span class="s"></span>
<span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>However, the checker model will only report the first violated constraint, since the conjunction operator short-circuits the evaluation when one of its arguments is false. For example, if we remove all constraints from the original model, the output would be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>wa=3   nt=3    sa=3
q=3    nsw=3   v=3
t=3
% Solution checker report:
% ERROR: wa and nt have the same colour
% INCORRECT
----------
</pre></div>
</div>
<p>In order to get all error messages, we can force the evaluation of all checkers by creating an auxiliary array of check results:</p>
<div class="literal-block-wrapper docutils container" id="ex-aust-check-3">
<div class="code-block-caption"><span class="caption-number">Listing 3.4.4 </span><span class="caption-text">A checker model <a class="reference download internal" href="downloads/aust-3.mzc.mzn" download=""><tt class="xref download docutils literal">aust-3.mzc.mzn</tt></a> for the map colouring problem without short-circuit evaluation</span><a class="headerlink" href="#ex-aust-check-3" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">wa</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">nt</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">sa</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">q</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">nsw</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">v</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="p">;</span><span class="s"></span>

<span class="k">test</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="p">,</span><span class="kt">string</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nv">b</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nf">trace_stdout</span><span class="p">(</span><span class="s">&quot;ERROR: &quot;</span><span class="o">++</span><span class="nv">s</span><span class="o">++</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="l">false</span><span class="p">)</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">checks</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">wa</span><span class="o">!=</span><span class="nv">nt</span><span class="p">,</span><span class="s"> &quot;wa and nt have the same colour&quot;</span><span class="p">),</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">wa</span><span class="o">!=</span><span class="nv">sa</span><span class="p">,</span><span class="s"> &quot;wa and sa have the same colour&quot;</span><span class="p">),</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">nt</span><span class="o">!=</span><span class="nv">sa</span><span class="p">,</span><span class="s"> &quot;nt and sa have the same colour&quot;</span><span class="p">),</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">nt</span><span class="o">!=</span><span class="nv">q</span><span class="p">,</span><span class="s"> &quot;nt and q have the same colour&quot;</span><span class="p">),</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">sa</span><span class="o">!=</span><span class="nv">q</span><span class="p">,</span><span class="s"> &quot;sa and q have the same colour&quot;</span><span class="p">),</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">sa</span><span class="o">!=</span><span class="nv">nsw</span><span class="p">,</span><span class="s"> &quot;sa and nsw have the same colour&quot;</span><span class="p">),</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">sa</span><span class="o">!=</span><span class="nv">v</span><span class="p">,</span><span class="s"> &quot;sa and v have the same colour&quot;</span><span class="p">),</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">q</span><span class="o">!=</span><span class="nv">nsw</span><span class="p">,</span><span class="s"> &quot;q and nsw have the same colour&quot;</span><span class="p">),</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">nsw</span><span class="o">!=</span><span class="nv">v</span><span class="p">,</span><span class="s"> &quot;nsw and v have the same colour&quot;</span><span class="p">)</span><span class="s"></span>
<span class="p">];</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">checks</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="k">then</span><span class="s"> &quot;CORRECT: all constraints hold.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">  </span><span class="k">else</span><span class="s"> &quot;INCORRECT</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">  </span><span class="k">endif</span><span class="s"></span>
<span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>Now the output contains all error messages (for the case where the model has no constraints):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>wa=3   nt=3    sa=3
q=3    nsw=3   v=3
t=3
% Solution checker report:
% ERROR: nsw and v have the same colour
% ERROR: q and nsw have the same colour
% ERROR: sa and v have the same colour
% ERROR: sa and nsw have the same colour
% ERROR: sa and q have the same colour
% ERROR: nt and q have the same colour
% ERROR: nt and sa have the same colour
% ERROR: wa and sa have the same colour
% ERROR: wa and nt have the same colour
% INCORRECT
----------
</pre></div>
</div>
</div>
<div class="section" id="instance-data-in-checker-models">
<h2>3.4.3. Instance data in checker models<a class="headerlink" href="#instance-data-in-checker-models" title="Permalink to this headline">¶</a></h2>
<p>The map colouring example was quite simple because the model did not contain any parameter declarations. For a model that is parameterised, the checker model simply contains the same parameter declarations. MiniZinc will then pass the actual parameters of the instance being solved to the checker model.</p>
<p>For example, the following checker model could be used for the <em>n</em>-Queens problem.</p>
<div class="literal-block-wrapper docutils container" id="ex-nqueens-check">
<div class="code-block-caption"><span class="caption-number">Listing 3.4.5 </span><span class="caption-text">A checker model <a class="reference download internal" href="downloads/nqueens.mzc.mzn" download=""><tt class="xref download docutils literal">nqueens.mzc.mzn</tt></a> for the n-Queens problem</span><a class="headerlink" href="#ex-nqueens-check" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s"> </span><span class="c">% number of queens</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">ROW</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">COL</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">q</span><span class="p">;</span><span class="s"> </span><span class="c">% col of queen in each row</span><span class="s"></span>

<span class="k">test</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="p">,</span><span class="kt">string</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nv">b</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nf">trace_stdout</span><span class="p">(</span><span class="s">&quot;ERROR: &quot;</span><span class="o">++</span><span class="nv">s</span><span class="o">++</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="l">false</span><span class="p">)</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="nb">index_set</span><span class="p">(</span><span class="nv">q</span><span class="p">)</span><span class="o">=</span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="s"> &quot;ERROR: array q should have index set 1..</span><span class="p">\(</span><span class="nv">n</span><span class="p">)</span><span class="s">&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nf">check</span><span class="p">(</span><span class="nv">q</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">,</span><span class="s"> &quot;ERROR: q[</span><span class="p">\(</span><span class="nv">i</span><span class="p">)</span><span class="s">] should have a value in 1..</span><span class="p">\(</span><span class="nv">n</span><span class="p">)</span><span class="s">&quot;</span><span class="p">))</span><span class="s"></span>
<span class="s">  </span><span class="o">/\</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">r1</span><span class="p">,</span><span class="s"> </span><span class="nv">r2</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">r1</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">r2</span><span class="p">)</span><span class="s"></span>
<span class="s">           </span><span class="p">(</span><span class="nf">check</span><span class="p">(</span><span class="nv">q</span><span class="p">[</span><span class="nv">r1</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">q</span><span class="p">[</span><span class="nv">r2</span><span class="p">],</span><span class="s"></span>
<span class="s">            &quot;queens in rows </span><span class="p">\(</span><span class="nv">r1</span><span class="p">)</span><span class="s"> and </span><span class="p">\(</span><span class="nv">r2</span><span class="p">)</span><span class="s"> are on same column</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">            </span><span class="o">/\</span><span class="s"></span>
<span class="s">            </span><span class="nf">check</span><span class="p">(</span><span class="nv">q</span><span class="p">[</span><span class="nv">r1</span><span class="p">]</span><span class="o">+</span><span class="nv">r1</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">q</span><span class="p">[</span><span class="nv">r2</span><span class="p">]</span><span class="o">+</span><span class="nv">r2</span><span class="p">,</span><span class="s"></span>
<span class="s">            &quot;queens in rows </span><span class="p">\(</span><span class="nv">r1</span><span class="p">)</span><span class="s"> and </span><span class="p">\(</span><span class="nv">r2</span><span class="p">)</span><span class="s"> are on same up diagonal</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">            </span><span class="o">/\</span><span class="s"></span>
<span class="s">            </span><span class="nf">check</span><span class="p">(</span><span class="nv">q</span><span class="p">[</span><span class="nv">r1</span><span class="p">]</span><span class="o">-</span><span class="nv">r1</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">q</span><span class="p">[</span><span class="nv">r2</span><span class="p">]</span><span class="o">-</span><span class="nv">r2</span><span class="p">,</span><span class="s"></span>
<span class="s">            &quot;queens in rows </span><span class="p">\(</span><span class="nv">r1</span><span class="p">)</span><span class="s"> and </span><span class="p">\(</span><span class="nv">r2</span><span class="p">)</span><span class="s"> are on same down diagonal</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">           </span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="k">then</span><span class="s"> &quot;CORRECT: All constraints hold&quot;    </span>
<span class="s">  </span><span class="k">else</span><span class="s"> &quot;INCORRECT&quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The checker model first makes sure that the solution has the right dimensions (correct array index set, and each variable is assigned a value in the correct domain), and then uses standard MiniZinc constructs to check each constraint.</p>
</div>
<div class="section" id="checking-optimisation-problems">
<h2>3.4.4. Checking optimisation problems<a class="headerlink" href="#checking-optimisation-problems" title="Permalink to this headline">¶</a></h2>
<p>Optimisation problems pose a difficulty for automatic checking. When a solver claims to prove optimality, we cannot easily verify this claim without solving the problem again (using a different model that is known to be correct). At the moment, solution checking for optimisation problems is restricted to checking that the objective has been computed correctly.</p>
<p>To check that the objective value is calculated correctly, define a parameter called <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="s">_objective</span></code> of the appropriate type (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">int</span><span class="s"></span></code> or <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">float</span><span class="s"></span></code>) in the checker. The example in the next section illustrates this.</p>
</div>
<div class="section" id="hidden-variables">
<h2>3.4.5. Hidden variables<a class="headerlink" href="#hidden-variables" title="Permalink to this headline">¶</a></h2>
<p>For many models, the decision variables which describe the solution may not be the variables that are natural to describe the constraints. There may be other internal variables which are functionally defined by the decision variables, and which are likely to be used in the model for building constraints and/or are much more natural for describing the correctness of a candidate solution.</p>
<p>Consider the problem of lining up <em>n</em> people numbered from 1 to <em>n</em> for a photo
in a single line. We want to make sure that there are no more than two people of
the same gender (male, female or other) in sequence in the line. We want to
minimize the total distance between the pairs of people who are numbered
consecutively. The decisions are an array <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">pos</span><span class="s"></span></code> which for each person
gives their position in the line. A correct model for this is given in <a class="reference internal" href="#ex-photo"><span class="std std-numref">Listing 3.4.6</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-photo">
<div class="code-block-caption"><span class="caption-number">Listing 3.4.6 </span><span class="caption-text">A model <a class="reference download internal" href="downloads/photo.mzn" download=""><tt class="xref download docutils literal">photo.mzn</tt></a> for the photo lineup problem</span><a class="headerlink" href="#ex-photo" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s">                          </span><span class="c">% number of people</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">PERSON</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">;</span><span class="s">       </span><span class="c">% set of people</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">GENDER</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">M</span><span class="p">,</span><span class="s"> </span><span class="nv">F</span><span class="p">,</span><span class="s"> </span><span class="nv">O</span><span class="s"> </span><span class="p">};</span><span class="s">       </span><span class="c">% set of genders</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">PERSON</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">GENDER</span><span class="p">:</span><span class="s"> </span><span class="nv">g</span><span class="p">;</span><span class="s">      </span><span class="c">% the gender of each person</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">POSN</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">;</span><span class="s">         </span><span class="c">% set of positions</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">PERSON</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">POSN</span><span class="p">:</span><span class="s"> </span><span class="nv">pos</span><span class="p">;</span><span class="s">  </span><span class="c">% decisions: a position for each person</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">POSN</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">PERSON</span><span class="p">:</span><span class="s"> </span><span class="nv">who</span><span class="p">;</span><span class="s">  </span><span class="c">% view: a person for each position</span><span class="s"></span>
<span class="k">include</span><span class="s"> &quot;inverse.mzn&quot;</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="bp">inverse</span><span class="p">(</span><span class="nv">pos</span><span class="p">,</span><span class="nv">who</span><span class="p">);</span><span class="s">     </span><span class="c">% channel from decisions to view</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="o">-</span><span class="m">2</span><span class="p">)</span><span class="s"></span>
<span class="s">                 </span><span class="p">(</span><span class="nv">g</span><span class="p">[</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="p">]]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">g</span><span class="p">[</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">]]</span><span class="s"> </span><span class="o">\/</span><span class="s"> </span><span class="nv">g</span><span class="p">[</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">]]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">g</span><span class="p">[</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">2</span><span class="p">]]);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">minimize</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">)(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">]));</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>A critical part of learning how to model this problem is to realise
that it is worth introducing the inverse of the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">pos</span><span class="s"></span></code> variables, called <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">who</span><span class="s"></span></code> in this model. The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">who</span><span class="s"></span></code> array makes it much easier to specify that no more than two people of the same gender can be
adjacent. The checker model <strong>should not</strong> include the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">who</span><span class="s"></span></code> variables, because that would effectively give away the key to the solution.</p>
<p>The use of hidden variables (such as <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">who</span><span class="s"></span></code>) makes checking harder in two
ways. First, we may need to define these in the checker model as decision variables (rather than parameters), and MiniZinc will then need to invoke a solver to generate the values of these variables in order to check a given solution. Second, given an incorrect candidate solution, there may be
no possible value for these hidden variables, hence we have to guard the
checking to ensure we do not assume that there is some value for the hidden
variables.</p>
<p>Consider this data file for the photo problem:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">9</span><span class="p">;</span><span class="s"></span>
<span class="nv">g</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">M</span><span class="p">,</span><span class="nv">M</span><span class="p">,</span><span class="nv">M</span><span class="p">,</span><span class="nv">M</span><span class="p">,</span><span class="nv">F</span><span class="p">,</span><span class="nv">F</span><span class="p">,</span><span class="nv">F</span><span class="p">,</span><span class="nv">M</span><span class="p">,</span><span class="nv">M</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
<p>and assume that an incorrect model returns the erroneous candidate solution
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">pos</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="m">1,2</span><span class="p">,</span><span class="m">3,4</span><span class="p">,</span><span class="m">5,6</span><span class="p">,</span><span class="m">7,2</span><span class="p">,</span><span class="m">9</span><span class="p">];</span><span class="s"> _objective</span><span class="o">=</span><span class="m">25</span><span class="p">;</span><span class="s"></span></code>. If we simply assert <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">inverse</span><span class="p">(</span><span class="nv">pos</span><span class="p">,</span><span class="nv">who</span><span class="p">)</span><span class="s"></span></code> in the checker model, then this constraint will
fail since there is no inverse of this position array, because persons 2 and
8 are both at position 2.  Hence the checker must guard the inverse
constraint, and only when that succeeds use  the computed values of the
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">who</span><span class="s"></span></code> variables for checking the solution. A checking model for the photo problem might look like this:</p>
<div class="literal-block-wrapper docutils container" id="ex-photo-checker">
<div class="code-block-caption"><span class="caption-number">Listing 3.4.7 </span><span class="caption-text">A checker model <a class="reference download internal" href="downloads/photo.mzc.mzn" download=""><tt class="xref download docutils literal">photo.mzc.mzn</tt></a> for the photo lineup problem</span><a class="headerlink" href="#ex-photo-checker" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">PERSON</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">;</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">GENDER</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">M</span><span class="p">,</span><span class="s"> </span><span class="nv">F</span><span class="p">,</span><span class="s"> </span><span class="nv">O</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">PERSON</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">GENDER</span><span class="p">:</span><span class="s"> </span><span class="nv">g</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">POSN</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">pos</span><span class="p">;</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">POSN</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">PERSON</span><span class="p">:</span><span class="s"> </span><span class="nv">who</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> _objective</span><span class="p">;</span><span class="s"></span>

<span class="k">test</span><span class="s"> </span><span class="bp">alldifferent</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">                 </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="p">)(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">j</span><span class="p">]);</span><span class="s"></span>

<span class="k">include</span><span class="s"> &quot;inverse.mzn&quot;</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="bp">alldifferent</span><span class="p">(</span><span class="nv">pos</span><span class="p">)</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="bp">inverse</span><span class="p">(</span><span class="nv">pos</span><span class="p">,</span><span class="nv">who</span><span class="p">)</span><span class="s"> </span>
<span class="s">           </span><span class="k">else</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="p">)(</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="p">)</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="k">if</span><span class="s"> </span>
<span class="s">  </span><span class="nf">check_array</span><span class="p">(</span><span class="nv">pos</span><span class="p">,</span><span class="s"> </span><span class="nv">n</span><span class="p">,</span><span class="s"> </span><span class="nv">POSN</span><span class="p">,</span><span class="s"> &quot;pos&quot;</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">  </span><span class="nf">check_alldifferent</span><span class="p">(</span><span class="nv">pos</span><span class="p">,</span><span class="s">&quot;pos&quot;</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">  </span><span class="nf">check_array</span><span class="p">(</span><span class="nb">fix</span><span class="p">(</span><span class="nv">pos</span><span class="p">),</span><span class="s"> </span><span class="nv">n</span><span class="p">,</span><span class="s"> </span><span class="nv">PERSON</span><span class="p">,</span><span class="s"> &quot;who&quot;</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">  </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="o">-</span><span class="m">2</span><span class="p">)</span><span class="s"></span>
<span class="s">        </span><span class="p">(</span><span class="nf">check</span><span class="p">(</span><span class="nv">g</span><span class="p">[</span><span class="nb">fix</span><span class="p">(</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="p">])]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">g</span><span class="p">[</span><span class="nb">fix</span><span class="p">(</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">])]</span><span class="s"> </span><span class="o">\/</span><span class="s"></span>
<span class="s">               </span><span class="nv">g</span><span class="p">[</span><span class="nb">fix</span><span class="p">(</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">])]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">g</span><span class="p">[</span><span class="nb">fix</span><span class="p">(</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">2</span><span class="p">])],</span><span class="s"></span>
<span class="s">               &quot;three people of the same gender </span><span class="p">\(</span><span class="nv">g</span><span class="p">[</span><span class="nb">fix</span><span class="p">(</span><span class="nv">who</span><span class="p">[</span><span class="nv">i</span><span class="p">])])</span><span class="s"> in positions </span><span class="p">\(</span><span class="nv">i</span><span class="p">)</span><span class="s">..</span><span class="p">\(</span><span class="nv">i</span><span class="o">+</span><span class="m">2</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">  </span><span class="k">let</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">obj</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">)(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">]));</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="k">in</span><span class="s"></span>
<span class="s">    </span><span class="nf">check</span><span class="p">(</span><span class="nv">obj</span><span class="s"> </span><span class="o">=</span><span class="s"> _objective</span><span class="p">,</span><span class="s"> &quot;calculated objective </span><span class="p">\(</span><span class="nv">obj</span><span class="p">)</span><span class="s"> does not agree with objective from the model (</span><span class="p">\(</span><span class="s">_objective</span><span class="p">)</span><span class="s">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="s"></span>
<span class="s">  </span><span class="k">then</span><span class="s"></span>
<span class="s">    &quot;CORRECT: All constraints hold&quot;</span>
<span class="s">  </span><span class="k">else</span><span class="s">       </span>
<span class="s">    &quot;INCORRECT&quot;</span>
<span class="s">  </span><span class="k">endif</span><span class="p">];</span><span class="s"></span>
<span class="s">              </span>
<span class="k">test</span><span class="s"> </span><span class="nf">check</span><span class="p">(</span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nv">b</span><span class="p">,</span><span class="kt">string</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="k">if</span><span class="s"> </span><span class="nv">b</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nf">trace_stdout</span><span class="p">(</span><span class="s">&quot;ERROR: &quot;</span><span class="o">++</span><span class="nv">s</span><span class="o">++</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="l">false</span><span class="p">)</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>

<span class="k">test</span><span class="s"> </span><span class="nf">check_alldifferent</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">string</span><span class="p">:</span><span class="s"> </span><span class="nv">name</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="p">)</span><span class="s"></span>
<span class="s">        </span><span class="p">(</span><span class="nf">check</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">x</span><span class="p">[</span><span class="nv">j</span><span class="p">],</span><span class="s"> </span><span class="nv">name</span><span class="s"> </span><span class="o">++</span><span class="s"> &quot;[</span><span class="p">\(</span><span class="nv">i</span><span class="p">)</span><span class="s">] = </span><span class="p">\(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">])</span><span class="s"> = &quot; </span><span class="o">++</span><span class="s"> </span>
<span class="s">         </span><span class="nv">name</span><span class="s"> </span><span class="o">++</span><span class="s"> &quot;[</span><span class="p">\(</span><span class="nv">j</span><span class="p">)</span><span class="s">] &quot; </span><span class="o">++</span><span class="s"></span>
<span class="s">         &quot;when they should be different</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span><span class="s">              </span>
<span class="s"> </span>
<span class="k">test</span><span class="s"> </span><span class="nf">check_int</span><span class="p">(</span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">vals</span><span class="p">,</span><span class="s"> </span><span class="kt">string</span><span class="p">:</span><span class="s"> </span><span class="nv">name</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nv">x</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">vals</span><span class="p">,</span><span class="s"> &quot;integer </span><span class="p">\(</span><span class="nv">name</span><span class="p">)</span><span class="s"> is not in values </span><span class="p">\(</span><span class="nv">vals</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="s"></span>

<span class="k">function</span><span class="s"> </span><span class="kt">bool</span><span class="p">:</span><span class="s"> </span><span class="nf">check_array</span><span class="p">(</span><span class="kt">array</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">,</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nb">length</span><span class="p">,</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">vals</span><span class="p">,</span><span class="s"> </span><span class="kt">string</span><span class="p">:</span><span class="s"> </span><span class="nv">name</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="nf">check</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">length</span><span class="p">,</span><span class="s"> &quot;array </span><span class="p">\(</span><span class="nv">name</span><span class="p">)</span><span class="s"> is not of length </span><span class="p">\(</span><span class="nb">length</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">  </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">x</span><span class="p">))</span><span class="s"> </span>
<span class="s">        </span><span class="p">(</span><span class="nf">check</span><span class="p">(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">vals</span><span class="p">,</span><span class="s"> &quot;element </span><span class="p">\(</span><span class="nv">i</span><span class="p">)</span><span class="s"> of array </span><span class="p">\(</span><span class="nv">name</span><span class="p">)</span><span class="s">, </span><span class="p">\(</span><span class="nv">x</span><span class="p">[</span><span class="nv">i</span><span class="p">])</span><span class="s"> is not in values </span><span class="p">\(</span><span class="nv">vals</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span><span class="s">  </span>
</pre></div>
</div>
</div>
<p>The checker model first tests whether the given <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">pos</span><span class="s"></span></code> array satisfies the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code> property (using a custom <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">test</span><span class="s"></span></code> for <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code> on a par array). If it passes the test, the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">inverse</span><span class="s"></span></code> constraint is applied. Otherwise, the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">who</span><span class="s"></span></code> array is simply fixed to a list of ones.</p>
<p>The check for the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code> constraint is a good example for a checker that tries to give a detailed description of the error.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="globalizer.html" class="btn btn-neutral float-right" title="3.5. Globalizer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="solvers.html" class="btn btn-neutral" title="3.3. Solving Technologies and Solver Backends" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, 2017, 2018, Peter J. Stuckey, Kim Marriott, Guido Tack.

    </p>
  </div>
<a rel="license" href="http://creativecommons.org/licenses/by-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nd/4.0/80x15.png" /></a>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.3.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="static/jquery.js"></script>
      <script type="text/javascript" src="static/underscore.js"></script>
      <script type="text/javascript" src="static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>