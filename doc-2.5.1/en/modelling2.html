

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.2. More Complex Models &mdash; The MiniZinc Handbook 2.5.1</title>
  

  
  
  
  
    <link rel="canonical" href="http://www.minizinc.org/doc-latest/en/modelling2.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="static/style.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2.3. Predicates and Functions" href="predicates.html" />
    <link rel="prev" title="2.1. Basic Modelling in MiniZinc" href="modelling.html" />
    <link rel="apple-touch-icon" sizes="57x57" href="static/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="static/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="static/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="static/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="static/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="static/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="static/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="static/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="static/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="static/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="static/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/favicon/favicon-16x16.png">
    <link rel="manifest" href="static/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="static/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">


  
  <script src="static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
            <a href="http://www.minizinc.org">
          
            
            <img src="static/MiniZn_logo_2.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
              <div class="version">
                2.5.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            <a href="index.html" class="reference internal icon icon-home"> The MiniZinc Handbook </a>
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="part_1_overview.html">1. Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="part_2_tutorial.html">2. A MiniZinc Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="modelling.html">2.1. Basic Modelling in MiniZinc</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.2. More Complex Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#arrays-and-sets">2.2.1. Arrays and Sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#global-constraints">2.2.2. Global Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conditional-expressions">2.2.3. Conditional Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enumerated-types">2.2.4. Enumerated Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complex-constraints">2.2.5. Complex Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-constraints">2.2.6. Set Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#putting-it-all-together">2.2.7. Putting it all together</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="predicates.html">2.3. Predicates and Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="optiontypes.html">2.4. Option Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="mzn_search.html">2.5. Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="efficient.html">2.6. Effective Modelling Practices in MiniZinc</a></li>
<li class="toctree-l2"><a class="reference internal" href="sat.html">2.7. Boolean Satisfiability Modelling in MiniZinc</a></li>
<li class="toctree-l2"><a class="reference internal" href="flattening.html">2.8. FlatZinc and Flattening</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="part_3_user_manual.html">3. User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="part_4_reference.html">4. Reference Manual</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">The MiniZinc Handbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="part_2_tutorial.html">2. A MiniZinc Tutorial</a> &raquo;</li>
        
      <li>2.2. More Complex Models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="more-complex-models">
<h1>2.2. More Complex Models<a class="headerlink" href="#more-complex-models" title="Permalink to this headline">¶</a></h1>
<p>In the last section we introduced the basic structure of a MiniZinc
model. In this section we introduce the array and set data structures,
enumerated types and
more complex constraints.</p>
<div class="section" id="arrays-and-sets">
<span id="sec-arrayset"></span><h2>2.2.1. Arrays and Sets<a class="headerlink" href="#arrays-and-sets" title="Permalink to this headline">¶</a></h2>
<p>Almost always we are interested in building models where the number of
constraints and variables is dependent on the input data.
In order to do so we will usually use <span class="target" id="index-0"></span>arrays.</p>
<p>Consider a simple finite element model for modelling temperatures on a
rectangular sheet of metal.  We approximate the temperatures across the
sheet by breaking the sheet into a finite number of elements in a
two-dimensional matrix.
A model is shown in <a class="reference internal" href="#ex-laplace"><span class="std std-numref">Listing 2.2.1</span></a>.
It declares the width <tt class="docutils literal">w</tt> and height <tt class="docutils literal">h</tt>
of the finite element model.
The declaration</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">HEIGHT</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">h</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">CHEIGHT</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">h</span><span class="o">-</span><span class="m">1</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">WIDTH</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">w</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">CWIDTH</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">w</span><span class="o">-</span><span class="m">1</span><span class="p">;</span><span class="s">  </span>
<span class="kt">array</span><span class="p">[</span><span class="nv">HEIGHT</span><span class="p">,</span><span class="nv">WIDTH</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">float</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="p">;</span><span class="s"> </span><span class="c">% temperature at point (i,j)</span><span class="s"></span>
</pre></div>
</div>
<p>declares four fixed sets of integers describing the dimensions of the finite
element model: <tt class="docutils literal">HEIGHT</tt> is the whole height of the model, while <tt class="docutils literal">CHEIGHT</tt> is
the centre of the height omitting the top and bottom,
<tt class="docutils literal">WIDTH</tt> is the whole width of the model, while
<tt class="docutils literal">CWIDTH</tt> is the centre of the width omitting the left and right sides.
Finally a two dimensional array of float variables <tt class="docutils literal">t</tt>
with rows numbered
<span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(h\)</span> (<tt class="docutils literal">HEIGHT</tt>) and columns <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(w\)</span> (<tt class="docutils literal">WIDTH</tt>),
to represent the temperatures at each
point in the metal plate.
We can access the element of the array in the <span class="math notranslate nohighlight">\(i^{th}\)</span> row and <span class="math notranslate nohighlight">\(j^{th}\)</span> column
using an expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"></span></code>.</p>
<p>Laplace’s
equation states that when the plate reaches a steady state
the temperature at each internal point is the average of its orthogonal
neighbours. The constraint</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% Laplace equation: each internal temp. is average of its neighbours</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CHEIGHT</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CWIDTH</span><span class="p">)(</span><span class="s"></span>
<span class="s">              </span><span class="m">4.0</span><span class="o">*</span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="m">1</span><span class="p">]);</span><span class="s"></span>
</pre></div>
</div>
<p>ensures that each internal point <span class="math notranslate nohighlight">\((i,j)\)</span> is the
average of its four orthogonal neighbours.
The constraints</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% edge constraints</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CHEIGHT</span><span class="p">)(</span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="m">0</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">left</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CHEIGHT</span><span class="p">)(</span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">w</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">right</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CWIDTH</span><span class="p">)(</span><span class="nv">t</span><span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">top</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CWIDTH</span><span class="p">)(</span><span class="nv">t</span><span class="p">[</span><span class="nv">h</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">bottom</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>restrict the temperatures on each edge to be equal, and
gives these temperatures names: <tt class="docutils literal">left</tt>, <tt class="docutils literal">right</tt>, <tt class="docutils literal">top</tt>
and <tt class="docutils literal">bottom</tt>.
While the constraints</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% corner constraints</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="m">0,0</span><span class="p">]</span><span class="o">=</span><span class="m">0.0</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="nv">w</span><span class="p">]</span><span class="o">=</span><span class="m">0.0</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">h</span><span class="p">,</span><span class="m">0</span><span class="p">]</span><span class="o">=</span><span class="m">0.0</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">h</span><span class="p">,</span><span class="nv">w</span><span class="p">]</span><span class="o">=</span><span class="m">0.0</span><span class="p">;</span><span class="s"> </span>
</pre></div>
</div>
<p>ensure that the corners (which are irrelevant) are set to 0.0.
We can determine the temperatures in a plate broken into 5 <span class="math notranslate nohighlight">\(\times\)</span> 5
elements with left, right and bottom temperature 0 and top temperature 100
with the model shown in <a class="reference internal" href="#ex-laplace"><span class="std std-numref">Listing 2.2.1</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-laplace">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.1 </span><span class="caption-text">Finite element plate model for determining steady state temperatures (<a class="reference download internal" href="downloads/laplace.mzn" download=""><tt class="xref download docutils literal">laplace.mzn</tt></a>).</span><a class="headerlink" href="#ex-laplace" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">w</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">4</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">h</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">4</span><span class="p">;</span><span class="s"></span>

<span class="c">% arraydec</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">HEIGHT</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">h</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">CHEIGHT</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">h</span><span class="o">-</span><span class="m">1</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">WIDTH</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">w</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">CWIDTH</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">w</span><span class="o">-</span><span class="m">1</span><span class="p">;</span><span class="s">  </span>
<span class="kt">array</span><span class="p">[</span><span class="nv">HEIGHT</span><span class="p">,</span><span class="nv">WIDTH</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">float</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="p">;</span><span class="s"> </span><span class="c">% temperature at point (i,j)</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="kt">float</span><span class="p">:</span><span class="s"> </span><span class="nv">left</span><span class="p">;</span><span class="s">   </span><span class="c">% left   edge temperature</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="kt">float</span><span class="p">:</span><span class="s"> </span><span class="nv">right</span><span class="p">;</span><span class="s">  </span><span class="c">% right  edge temperature</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="kt">float</span><span class="p">:</span><span class="s"> </span><span class="nv">top</span><span class="p">;</span><span class="s">    </span><span class="c">% top    edge temperature</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="kt">float</span><span class="p">:</span><span class="s"> </span><span class="nv">bottom</span><span class="p">;</span><span class="s"> </span><span class="c">% bottom edge temperature</span><span class="s"></span>

<span class="c">% equation</span><span class="s"></span>
<span class="c">% Laplace equation: each internal temp. is average of its neighbours</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CHEIGHT</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CWIDTH</span><span class="p">)(</span><span class="s"></span>
<span class="s">              </span><span class="m">4.0</span><span class="o">*</span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="o">+</span><span class="m">1</span><span class="p">]);</span><span class="s"></span>
<span class="c">% sides</span><span class="s"></span>
<span class="c">% edge constraints</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CHEIGHT</span><span class="p">)(</span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="m">0</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">left</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CHEIGHT</span><span class="p">)(</span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">w</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">right</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CWIDTH</span><span class="p">)(</span><span class="nv">t</span><span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">top</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">CWIDTH</span><span class="p">)(</span><span class="nv">t</span><span class="p">[</span><span class="nv">h</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">bottom</span><span class="p">);</span><span class="s"></span>
<span class="c">% corners</span><span class="s"></span>
<span class="c">% corner constraints</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="m">0,0</span><span class="p">]</span><span class="o">=</span><span class="m">0.0</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="nv">w</span><span class="p">]</span><span class="o">=</span><span class="m">0.0</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">h</span><span class="p">,</span><span class="m">0</span><span class="p">]</span><span class="o">=</span><span class="m">0.0</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">h</span><span class="p">,</span><span class="nv">w</span><span class="p">]</span><span class="o">=</span><span class="m">0.0</span><span class="p">;</span><span class="s"> </span>
<span class="nv">left</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0.0</span><span class="p">;</span><span class="s"></span>
<span class="nv">right</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0.0</span><span class="p">;</span><span class="s"></span>
<span class="nv">top</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">100.0</span><span class="p">;</span><span class="s"></span>
<span class="nv">bottom</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">0.0</span><span class="p">;</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nb">show_float</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="nv">t</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">++</span><span class="s"> </span>
<span class="s">         </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">w</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot; &quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span><span class="s"></span>
<span class="s">         </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">HEIGHT</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">WIDTH</span><span class="s"></span>
<span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>Running the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc --solver cbc laplace.mzn
</pre></div>
</div>
<p>gives the output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> -0.00 100.00 100.00 100.00  -0.00
 -0.00  42.86  52.68  42.86  -0.00
 -0.00  18.75  25.00  18.75  -0.00
 -0.00   7.14   9.82   7.14  -0.00
 -0.00  -0.00  -0.00  -0.00  -0.00
----------
</pre></div>
</div>
<div class="admonition-sets admonition" id="defblock-0">
<p class="first admonition-title">Sets</p>
<p id="index-1">Set variables are declared with a declaration of the form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="cs">&lt;type-inst&gt;</span><span class="s"> </span><span class="p">:</span><span class="s"> </span><span class="cs">&lt;var-name&gt;</span><span class="s"> </span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>where sets of integers, enums (see later), floats or Booleans are allowed.
The only type allowed for decision variable sets are variable sets of
integers or enums.
Set literals are of the form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s"> </span><span class="cs">&lt;expr-1&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;expr-n&gt;</span><span class="s"> </span><span class="p">}</span><span class="s"></span>
</pre></div>
</div>
<p>or are <span class="target" id="index-2"></span>range expressions over either integers, enums or floats of the form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="cs">&lt;expr-1&gt;</span><span class="s"> .. </span><span class="cs">&lt;expr-2&gt;</span><span class="s"></span>
</pre></div>
</div>
<p>The standard <span class="target" id="index-3"></span>set operations
are provided: element membership
(<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">in</span><span class="s"></span></code>),
(non-strict) subset relationship (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">subset</span><span class="s"></span></code>),
(non-strict) superset relationship (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">superset</span><span class="s"></span></code>), union
(<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">union</span><span class="s"></span></code>),
intersection (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">intersect</span><span class="s"></span></code>),
set difference (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">diff</span><span class="s"></span></code>),
symmetric set difference (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">symdiff</span><span class="s"></span></code>)
and the number of elements in the
set (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">card</span><span class="s"></span></code>).</p>
<p class="last">As we have seen set variables and set literals (including ranges) can be
used as an implicit type in variable declarations in which case the variable
has the type of the elements in the set and the variable is implicitly
constrained to be a member of the set.</p>
</div>
<p>Our cake baking problem is an example of a very simple kind of production
planning problem.  In this kind of problem we wish to determine how much of
each kind of product to make to maximise the profit where manufacturing a
product consumes varying amounts of some fixed resources.  We can generalise
the MiniZinc model in <a class="reference internal" href="modelling.html#ex-cakes2"><span class="std std-numref">Listing 2.1.3</span></a> to handle this kind of problem
with a model that is generic in the kinds of resources and products.  The
model is shown in <a class="reference internal" href="#ex-prod-planning"><span class="std std-numref">Listing 2.2.2</span></a> and a sample data file (for
the cake baking example) is shown in <a class="reference internal" href="#fig-prod-planning-data"><span class="std std-numref">Listing 2.2.3</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-prod-planning">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.2 </span><span class="caption-text">Model for simple production planning (<a class="reference download internal" href="downloads/prod-planning.mzn" download=""><tt class="xref download docutils literal">prod-planning.mzn</tt></a>).</span><a class="headerlink" href="#ex-prod-planning" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% Products to be produced</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">Products</span><span class="p">;</span><span class="s">  </span>
<span class="c">% profit per unit for each product</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Products</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">profit</span><span class="p">;</span><span class="s"></span>
<span class="c">% Resources to be used</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">Resources</span><span class="p">;</span><span class="s"></span>
<span class="c">% amount of each resource available</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Resources</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">capacity</span><span class="p">;</span><span class="s"> </span>

<span class="c">% units of each resource required to produce 1 unit of product</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Products</span><span class="p">,</span><span class="s"> </span><span class="nv">Resources</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">consumption</span><span class="p">;</span><span class="s"> </span>
<span class="k">constraint</span><span class="s"> </span><span class="nb">assert</span><span class="p">(</span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Resources</span><span class="p">,</span><span class="s"> </span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Products</span><span class="p">)</span><span class="s"> </span>
<span class="s">           </span><span class="p">(</span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;=</span><span class="s"> </span><span class="m">0</span><span class="p">),</span><span class="s"> &quot;Error: negative consumption&quot;</span><span class="p">);</span><span class="s"></span>

<span class="c">% bound on number of Products</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">mproducts</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">max</span><span class="s"> </span><span class="p">(</span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Products</span><span class="p">)</span><span class="s"> </span>
<span class="s">                     </span><span class="p">(</span><span class="nb">min</span><span class="s"> </span><span class="p">(</span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Resources</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="m">0</span><span class="p">)</span><span class="s"> </span>
<span class="s">                          </span><span class="p">(</span><span class="nv">capacity</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="nv">r</span><span class="p">]));</span><span class="s"></span>

<span class="c">% Variables: how much should we make of each product</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Products</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">mproducts</span><span class="p">:</span><span class="s"> </span><span class="nv">produce</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Resources</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nb">max</span><span class="p">(</span><span class="nv">capacity</span><span class="p">):</span><span class="s"> </span><span class="nv">used</span><span class="p">;</span><span class="s"></span>

<span class="c">% Production cannot use more than the available Resources:</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Resources</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s">     </span>
<span class="s">      </span><span class="nv">used</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="s"> </span><span class="p">(</span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Products</span><span class="p">)(</span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="s"> </span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">produce</span><span class="p">[</span><span class="nv">p</span><span class="p">])</span><span class="s"> </span>
<span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Resources</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s">     </span>
<span class="s">      </span><span class="nv">used</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">capacity</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"></span>
<span class="p">);</span><span class="s">    </span>

<span class="c">% Maximize profit</span><span class="s"></span>
<span class="k">solve</span><span class="s"> </span><span class="k">maximize</span><span class="s"> </span><span class="nb">sum</span><span class="s"> </span><span class="p">(</span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Products</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">profit</span><span class="p">[</span><span class="nv">p</span><span class="p">]</span><span class="o">*</span><span class="nv">produce</span><span class="p">[</span><span class="nv">p</span><span class="p">]);</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> &quot;</span><span class="p">\(</span><span class="nv">p</span><span class="p">)</span><span class="s"> = </span><span class="p">\(</span><span class="nv">produce</span><span class="p">[</span><span class="nv">p</span><span class="p">])</span><span class="s">;</span><span class="se">\n</span><span class="s">&quot; </span><span class="p">|</span><span class="s"> </span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Products</span><span class="s"> </span><span class="p">]</span><span class="s"> </span><span class="o">++</span><span class="s"></span>
<span class="s">       </span><span class="p">[</span><span class="s"> &quot;</span><span class="p">\(</span><span class="nv">r</span><span class="p">)</span><span class="s"> = </span><span class="p">\(</span><span class="nv">used</span><span class="p">[</span><span class="nv">r</span><span class="p">])</span><span class="s">;</span><span class="se">\n</span><span class="s">&quot; </span><span class="p">|</span><span class="s"> </span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Resources</span><span class="s"> </span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="fig-prod-planning-data">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.3 </span><span class="caption-text">Example data file for the simple production planning problem (<a class="reference download internal" href="downloads/prod-planning-data.dzn" download=""><tt class="xref download docutils literal">prod-planning-data.dzn</tt></a>).</span><a class="headerlink" href="#fig-prod-planning-data" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="c">% Data file for simple production planning model</span><span class="s"></span>
<span class="nv">Products</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">BananaCake</span><span class="p">,</span><span class="s"> </span><span class="nv">ChocolateCake</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
<span class="nv">profit</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="m">400</span><span class="p">,</span><span class="s"> </span><span class="m">450</span><span class="p">];</span><span class="s"> </span><span class="c">% in cents</span><span class="s"></span>

<span class="nv">Resources</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">Flour</span><span class="p">,</span><span class="s"> </span><span class="nv">Banana</span><span class="p">,</span><span class="s"> </span><span class="nv">Sugar</span><span class="p">,</span><span class="s"> </span><span class="nv">Butter</span><span class="p">,</span><span class="s"> </span><span class="nv">Cocoa</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
<span class="nv">capacity</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="m">4000</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">2000</span><span class="p">,</span><span class="s"> </span><span class="m">500</span><span class="p">,</span><span class="s"> </span><span class="m">500</span><span class="p">];</span><span class="s"></span>

<span class="nv">consumption</span><span class="o">=</span><span class="s"> </span><span class="p">[|</span><span class="s"> </span><span class="m">250</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">75</span><span class="p">,</span><span class="s"> </span><span class="m">100</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"></span>
<span class="s">              </span><span class="p">|</span><span class="s"> </span><span class="m">200</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">150</span><span class="p">,</span><span class="s"> </span><span class="m">150</span><span class="p">,</span><span class="s"> </span><span class="m">75</span><span class="s"> </span><span class="p">|];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The new feature in this model is the use of <span class="target" id="index-4"></span>enumerated
types.
These allow us to treat the choice of resources and products as parameters to
the model.
The first item in the model</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">enum</span><span class="s"> </span><span class="nv">Products</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>declares <tt class="docutils literal">Products</tt> as an <em>unknown</em> set of products.</p>
<div class="admonition-enumerated-types admonition" id="defblock-1">
<p class="first admonition-title">Enumerated Types</p>
<p id="index-5">Enumerated types, which we shall refer to as <tt class="docutils literal">enums</tt>,
are declared with a declaration of the form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="kt">enum</span><span class="s"> </span><span class="cs">&lt;var-name&gt;</span><span class="s"> </span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>An enumerated type is defined by an assignment of the form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="kt">enum</span><span class="s"> </span><span class="cs">&lt;var-name&gt;</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="cs">&lt;var-name-1&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;var-name-n&gt;</span><span class="s"> </span><span class="p">}</span><span class="s"> </span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p class="last">where <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;var-name-1&gt;</span><span class="s"></span></code>, …, <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;var-name-n&gt;</span><span class="s"></span></code> are the elements of
the enumerated type, with name <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;var-name&gt;</span><span class="s"></span></code>.
Each of the elements of the enumerated type is also effectively declared by
this definition as a new constant of that type.
The declaration and definition can be combined into one line as usual.</p>
</div>
<p>The second item declares an array of integers:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="nv">Products</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">profit</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>The <span class="target" id="index-6"></span>index set
of the array <tt class="docutils literal">profit</tt> is <tt class="docutils literal">Products</tt>.
This means that only elements of the set <tt class="docutils literal">Products</tt>
can be used to index the array.</p>
<p>The elements of an enumerated type of <span class="math notranslate nohighlight">\(n\)</span> elements
act very similar to the integers <span class="math notranslate nohighlight">\(1\dots n\)</span>. They can be compared, they are
ordered, by the order they appear in the enumerated type definition,
they can be iterated over, they can appear as indices of arrays, in fact
they can appear anywhere an integer can appear.</p>
<p>In the example data file we have initialized the array using a list of
integers</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">Products</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">BananaCake</span><span class="p">,</span><span class="s"> </span><span class="nv">ChocolateCake</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
<span class="nv">profit</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="m">400,450</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
<p>meaning the profit for a banana cake is 400, while for a chocolate cake it
is 450.  Internally <tt class="docutils literal">BananaCake</tt> will be treated like the integer 1,
while <tt class="docutils literal">ChocolateCake</tt> will be treated like the integer 2.
The expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[</span><span class="m">400,500</span><span class="p">]</span><span class="s"></span></code> represents a literal one-dimensional array. In MiniZinc, the index set of literal arrays always starts at 1 (this is similar to other mathematically inspired languages such as MATLAB, Julia or Mathematica).
While MiniZinc does not provide an explicit list type, one-dimensional
arrays with an index set <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="s"></span></code> behave like lists, and we will sometimes
refer to them as <span class="target" id="index-7"></span>lists.</p>
<p>In a similar fashion, in the next two items we declare a set of resources
<tt class="docutils literal">Resources</tt>, and an array <tt class="docutils literal">capacity</tt> which gives the amount of
each resource that is available.</p>
<p>More interestingly, the item</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="nv">Products</span><span class="p">,</span><span class="s"> </span><span class="nv">Resources</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">consumption</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>declares a 2-D array <tt class="docutils literal">consumption</tt>. The value of
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="nv">r</span><span class="p">]</span><span class="s"></span></code> is the amount of resource <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">r</span><span class="s"></span></code> required to
produce one unit of product <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">p</span><span class="s"></span></code>. Note that the first index is the row
and the second is the column.</p>
<p>The data file contains an example initialization of a 2-D array:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">consumption</span><span class="o">=</span><span class="s"> </span><span class="p">[|</span><span class="s"> </span><span class="m">250</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">75</span><span class="p">,</span><span class="s">  </span><span class="m">100</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"></span>
<span class="s">              </span><span class="p">|</span><span class="s"> </span><span class="m">200</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">150</span><span class="p">,</span><span class="s"> </span><span class="m">150</span><span class="p">,</span><span class="s"> </span><span class="m">75</span><span class="s"> </span><span class="p">|];</span><span class="s"></span>
</pre></div>
</div>
<p>Notice how the delimiter <tt class="docutils literal">|</tt> is used to separate rows. As for one-dimensional array literals, indexing of two-dimensional array literals also starts at 1.</p>
<div class="admonition-arrays admonition" id="defblock-2">
<p class="first admonition-title">Arrays</p>
<p>Thus, MiniZinc provides one- and multi-dimensional arrays
which are declared using the type:</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="cs">&lt;index-set-1&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;index-set-n&gt;</span><span class="s"> </span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="cs">&lt;type-inst&gt;</span><span class="s"></span>
</pre></div>
</div>
<p>MiniZinc requires that the array declaration contains the index set of each
dimension and that the index set is either an integer range, a set
variable initialised to an integer range, or an <span class="target" id="index-8"></span>enumeration type.
Arrays can contain any of the base
types: integers, enums, Booleans, floats or strings.  These can be fixed or unfixed
except for strings which can only be parameters. Arrays can also contain
sets but they cannot contain arrays.</p>
<p><span class="target" id="index-9"></span>One-dimensional array literals are of form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s"> </span><span class="cs">&lt;expr-1&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;expr-n&gt;</span><span class="s"> </span><span class="p">]</span><span class="s"></span>
</pre></div>
</div>
<p>and their index sets are <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="s"></span></code>,
while <span class="target" id="index-10"></span>two-dimensional array literals are of form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="sr">[| &lt;expr-1-1&gt;, ..., &lt;expr-1-n&gt; |</span>
<span class="s">   ...                         </span><span class="gr">|</span><span class="s"></span>
<span class="s">   </span><span class="cs">&lt;expr-m-1&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;expr-m-n&gt;</span><span class="s"> </span><span class="gr">|]</span><span class="s"></span>
</pre></div>
</div>
<p>where the array has <tt class="docutils literal">m</tt> rows and <tt class="docutils literal">n</tt> columns, with index sets <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">m</span><span class="s"></span></code> for the first and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="nv">n</span><span class="s"></span></code> for the second dimension.</p>
<p>The family of built-in functions <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">array1d</span><span class="s"></span></code>,
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">array2d</span><span class="s"></span></code>, etc,
can be used to initialise an array of any dimension from a list (or more
exactly a one-dimensional array). The call:</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="cs">&lt;n&gt;</span><span class="nf">d</span><span class="p">(</span><span class="cs">&lt;index-set-1&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;index-set-n&gt;</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;list&gt;</span><span class="p">)</span><span class="s"></span>
</pre></div>
</div>
<p>returns an <tt class="docutils literal">n</tt> dimensional array with index sets given by the first <tt class="docutils literal">n</tt>
arguments and the last argument contains the elements of the array. For
instance, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">array2d</span><span class="p">(</span><span class="m">1</span><span class="o">..</span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">])</span><span class="s"></span></code> is equivalent to
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[|</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="p">|</span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="s"> </span><span class="p">|</span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">|]</span><span class="s"></span></code>.</p>
<p>Array elements are <span class="target" id="index-11"></span>accessed using bracket syntax: <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"></span></code> gives the
element at row index <span class="math notranslate nohighlight">\(i^{th}\)</span> and column index <span class="math notranslate nohighlight">\(j^{th}\)</span>.</p>
<p class="last">The concatenation operator <tt class="docutils literal">++</tt>
can be used to concatenate two
one-dimensional arrays together. The result is a list, i.e. a
one-dimensional array whose elements are indexed from 1.  For instance
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[</span><span class="m">4000</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">]</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="p">[</span><span class="m">2000</span><span class="p">,</span><span class="s"> </span><span class="m">500</span><span class="p">,</span><span class="s"> </span><span class="m">500</span><span class="p">]</span><span class="s"></span></code> evaluates to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[</span><span class="m">4000</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">2000</span><span class="p">,</span><span class="s"> </span><span class="m">500</span><span class="p">,</span><span class="s"> </span><span class="m">500</span><span class="p">]</span><span class="s"></span></code>.
The built-in function
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">length</span><span class="s"></span></code> returns the length
of a one-dimensional array.</p>
</div>
<p>The next item in the model defines the parameter <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">mproducts</span><span class="s"></span></code>. This is
set to an upper-bound on the number of products of any type that can be
produced. This is quite a complex example of nested
array comprehensions and aggregation operators.  We shall introduce these
before we try to understand this item and the rest of the model.</p>
<p>First, MiniZinc provides list comprehensions similar to those provided in
many functional programming languages, or Python. For example, the list comprehension
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[</span><span class="nv">i</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">3</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">i</span><span class="p">]</span><span class="s"></span></code> evaluates to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[</span><span class="m">2</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">2</span><span class="p">]</span><span class="s"></span></code>
which is <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">]</span><span class="s"></span></code>. Of course <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">]</span><span class="s"></span></code> is
simply an array with index set <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="m">1</span><span class="o">..</span><span class="m">3</span><span class="s"></span></code>.</p>
<p>MiniZinc also provides set comprehensions which have a similar syntax: for
instance, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">{</span><span class="nv">i</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">3</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">i</span><span class="p">}</span><span class="s"></span></code> evaluates to the set
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">{</span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">}</span><span class="s"></span></code>.</p>
<div class="admonition-list-and-set-comprehensions admonition" id="defblock-3">
<p class="first admonition-title">List and Set Comprehensions</p>
<p>The generic form of a list comprehension is</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s"> </span><span class="cs">&lt;expr&gt;</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="cs">&lt;generator-exp&gt;</span><span class="s"> </span><span class="p">]</span><span class="s"></span>
</pre></div>
</div>
<p>The expression <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;expr&gt;</span><span class="s"></span></code> specifies how to construct elements in the
output list from the elements generated by <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;generator-exp&gt;</span><span class="s"></span></code>.
The generator <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;generator-exp&gt;</span><span class="s"></span></code> consists of a comma separated sequence of
generator expressions optionally followed by a Boolean expression. The two forms are</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="cs">&lt;generator&gt;</span><span class="s"></span>
<span class="cs">&lt;generator&gt;</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="cs">&lt;bool-exp&gt;</span><span class="s"></span>
</pre></div>
</div>
<p>The optional <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;bool-exp&gt;</span><span class="s"></span></code> in the second form acts as a filter on
the generator expression: only elements satisfying the Boolean expression
are used to construct elements in the output list.  A <span class="target" id="index-12"></span>generator
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;generator&gt;</span><span class="s"></span></code>
has the form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="cs">&lt;identifier&gt;</span><span class="p">,</span><span class="s"> ...</span><span class="p">,</span><span class="s"> </span><span class="cs">&lt;identifier&gt;</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="cs">&lt;array-exp&gt;</span><span class="s"></span>
</pre></div>
</div>
<p>Each identifier is an <em>iterator</em>
which takes the values
of the array expression in turn, with the last identifier varying most rapidly.</p>
<p>The generators of a list comprehension and <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;bool-exp&gt;</span><span class="s"></span></code>
usually do not involve decision variables.
If they do involve decision variables
then the list produced is a list of <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="kt">var</span><span class="s"> </span><span class="nv">opt</span><span class="s"> </span><span class="cs">&lt;T&gt;</span><span class="s"></span></code> where <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;T&gt;</span><span class="s"></span></code> is the type
of the <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;expr&gt;</span><span class="s"></span></code>. See the discussion of <span class="target" id="index-13"></span>option types
in <a class="reference internal" href="optiontypes.html#sec-optiontypes"><span class="std std-ref">Option Types</span></a> for more details.</p>
<p class="last"><span class="target" id="index-14"></span>Set comprehensions
are almost identical to list comprehensions: the only
difference is the use of <tt class="docutils literal">{</tt> and <tt class="docutils literal">}</tt> to enclose the
expression rather than <tt class="docutils literal">[</tt> and <tt class="docutils literal">]</tt>.
The elements generated by a set comprehension must be
<span class="target" id="index-15"></span>fixed, i.e. free of decision variables.
Similarly the generators and optional <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;bool-exp&gt;</span><span class="s"></span></code>
for set comprehensions must be fixed.</p>
</div>
<p id="index-16">Second, MiniZinc provides a number of built-in functions that take a
one-dimensional array and aggregate the elements. Probably the most useful
of these is <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">forall</span><span class="s"></span></code>.
This takes an array of Boolean expressions
(that is, constraints) and returns a single Boolean expression which is the
logical conjunction of the Boolean expressions in the array.</p>
<p>For example, consider the expression</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">forall</span><span class="p">(</span><span class="s"> </span><span class="p">[</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">3</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="p">])</span><span class="s"></span>
</pre></div>
</div>
<p>where <tt class="docutils literal">a</tt> is an arithmetic array with index set <tt class="docutils literal">1..3</tt>. This
constrains the elements in <tt class="docutils literal">a</tt> to be pairwise different. The list
comprehension evaluates to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">3</span><span class="p">],</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="s"> </span><span class="p">]</span><span class="s"></span></code>
and so the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">forall</span><span class="s"></span></code> function returns the logical
conjunction <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">a</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="s"></span></code>.</p>
<div class="admonition-aggregation-functions admonition" id="defblock-4">
<p class="first admonition-title">Aggregation functions</p>
<p id="index-17">The <em>aggregation functions</em> for arithmetic arrays are:
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">sum</span><span class="s"></span></code> which adds the elements, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">product</span><span class="s"></span></code> which multiplies them together,
and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">min</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">max</span><span class="s"></span></code> which respectively return the least and
greatest element in the array. When applied to an empty array, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">min</span><span class="s"></span></code> and
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">max</span><span class="s"></span></code> give a run-time error, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">sum</span><span class="s"></span></code> returns 0 and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">product</span><span class="s"></span></code>
returns 1.</p>
<p class="last">MiniZinc provides four aggregation functions for arrays containing Boolean
expressions. As we have seen, the first of these,
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">forall</span><span class="s"></span></code>, returns
a single constraint which is the logical conjunction of the
constraints.
The second function, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">exists</span><span class="s"></span></code>,
returns the logical
disjunction of the constraints. Thus, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">forall</span><span class="s"></span></code> enforces that all
constraints in the array hold, while <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">exists</span><span class="s"></span></code> ensures that at least
one of the constraints holds.
The third function, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">xorall</span><span class="s"></span></code>,
ensures that an odd number of constraints hold.
The fourth function, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">iffall</span><span class="s"></span></code>,
ensures that an even number of constraints holds.</p>
</div>
<p>The third, and final, piece in the puzzle is that MiniZinc allows a special
syntax for aggregation functions when used with an array
comprehension. Instead of writing</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">forall</span><span class="p">(</span><span class="s"> </span><span class="p">[</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">3</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="p">])</span><span class="s"></span>
</pre></div>
</div>
<p>the modeller can instead write the more mathematical looking</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">3</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">j</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">a</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="nv">j</span><span class="p">])</span><span class="s"></span>
</pre></div>
</div>
<p>The two expressions are completely equivalent: the modeller is free to use
whichever they feel looks most natural.</p>
<div class="admonition-generator-call-expressions admonition" id="defblock-5">
<p class="first admonition-title">Generator call expressions</p>
<p id="index-18">A <em>generator call expression</em> has form</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="cs">&lt;agg-func&gt;</span><span class="s"> </span><span class="p">(</span><span class="s"> </span><span class="cs">&lt;generator-exp&gt;</span><span class="s"> </span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"> </span><span class="cs">&lt;exp&gt;</span><span class="s"> </span><span class="p">)</span><span class="s"></span>
</pre></div>
</div>
<p>The round brackets around the generator expression
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;generator-exp&gt;</span><span class="s"></span></code> and the constructor expression
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;exp&gt;</span><span class="s"></span></code> are not optional: they must be there.  This is
equivalent to writing</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="cs">&lt;agg-func&gt;</span><span class="s"> </span><span class="p">(</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="cs">&lt;exp&gt;</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="cs">&lt;generator-exp&gt;</span><span class="s"> </span><span class="p">]</span><span class="s"> </span><span class="p">)</span><span class="s"></span>
</pre></div>
</div>
<p class="last">The <span class="target" id="index-19"></span>aggregation function <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;agg-func&gt;</span><span class="s"></span></code> is any MiniZinc
function expecting a single array as argument.</p>
</div>
<p>We are now in a position to understand the rest of the simple production
planning model shown in <a class="reference internal" href="#ex-prod-planning"><span class="std std-numref">Listing 2.2.2</span></a>. For the moment ignore
the item defining <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">mproducts</span><span class="s"></span></code>.  The item afterwards:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="nv">Products</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">mproducts</span><span class="p">:</span><span class="s"> </span><span class="nv">produce</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>defines a one-dimensional array <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">produce</span><span class="s"></span></code> of decision variables.  The
value of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">produce</span><span class="p">[</span><span class="nv">p</span><span class="p">]</span><span class="s"></span></code> will be set to the amount of product <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">p</span><span class="s"></span></code>
in the optimal solution.
The next item</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="nv">Resources</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nb">max</span><span class="p">(</span><span class="nv">capacity</span><span class="p">):</span><span class="s"> </span><span class="nv">used</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>defines a set of auxiliary variables that record how much of each resource
is used.
The next two constraints</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Resources</span><span class="p">)</span><span class="s"></span>
<span class="s">           </span><span class="p">(</span><span class="nv">used</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="s"> </span><span class="p">(</span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Products</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="s"> </span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">produce</span><span class="p">[</span><span class="nv">p</span><span class="p">]));</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Resources</span><span class="p">)(</span><span class="nv">used</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">capacity</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>compute in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">used</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"></span></code>  the total consumption of the
resource <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">r</span><span class="s"></span></code> and ensure it is less than the available amount.
Finally, the item</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">solve</span><span class="s"> </span><span class="k">maximize</span><span class="s"> </span><span class="nb">sum</span><span class="s"> </span><span class="p">(</span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Products</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">profit</span><span class="p">[</span><span class="nv">p</span><span class="p">]</span><span class="o">*</span><span class="nv">produce</span><span class="p">[</span><span class="nv">p</span><span class="p">]);</span><span class="s"></span>
</pre></div>
</div>
<p>indicates that this is a maximisation problem and that the objective to be maximised is the total profit.</p>
<p>We now return to the definition of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">mproducts</span><span class="s"></span></code>. For each product
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">p</span><span class="s"></span></code> the expression</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">min</span><span class="s"> </span><span class="p">(</span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Resources</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="m">0</span><span class="p">)</span><span class="s"></span>
<span class="s">     </span><span class="p">(</span><span class="nv">capacity</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="nv">r</span><span class="p">]))</span><span class="s"></span>
</pre></div>
</div>
<p>determines the maximum amount of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">p</span><span class="s"></span></code> that can be produced taking into
account the amount of each resource <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">r</span><span class="s"></span></code> and how much of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">r</span><span class="s"></span></code> is
required to produce the product. Notice the use of the filter
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">where</span><span class="s"> </span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="m">0</span><span class="s"></span></code> to ensure that only resources required to make the
product are considered so as to avoid a division by zero error.  Thus, the
complete expression</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">mproducts</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">max</span><span class="s"> </span><span class="p">(</span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Products</span><span class="p">)</span><span class="s"></span>
<span class="s">                     </span><span class="p">(</span><span class="nb">min</span><span class="s"> </span><span class="p">(</span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Resources</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="m">0</span><span class="p">)</span><span class="s"></span>
<span class="s">                          </span><span class="p">(</span><span class="nv">capacity</span><span class="p">[</span><span class="nv">r</span><span class="p">]</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="nv">consumption</span><span class="p">[</span><span class="nv">p</span><span class="p">,</span><span class="nv">r</span><span class="p">]));</span><span class="s"></span>
</pre></div>
</div>
<p>computes the maximum amount of <em>any</em> product that can be produced, and
so this can be used as an upper bound on the domain of the decision
variables in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">produce</span><span class="s"></span></code>.</p>
<p>Finally notice the output item is more complex,
and uses <span class="target" id="index-20"></span>list comprehensions
to create an understandable output. Running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc --solver gecode prod-planning.mzn prod-planning-data.dzn
</pre></div>
</div>
<p>results in the output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>BananaCake = 2;
ChocolateCake = 2;
Flour = 900;
Banana = 4;
Sugar = 450;
Butter = 500;
Cocoa = 150;
----------
==========
</pre></div>
</div>
</div>
<div class="section" id="global-constraints">
<h2>2.2.2. Global Constraints<a class="headerlink" href="#global-constraints" title="Permalink to this headline">¶</a></h2>
<p>MiniZinc includes a library of global constraints which can also be used
to define models. An example is the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code>
constraint which requires
all the variables appearing in its argument to be pairwise different.</p>
<div class="literal-block-wrapper docutils container" id="ex-smm">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.4 </span><span class="caption-text">Model for the cryptarithmetic problem SEND+MORE=MONEY (<a class="reference download internal" href="downloads/send-more-money.mzn" download=""><tt class="xref download docutils literal">send-more-money.mzn</tt></a>)</span><a class="headerlink" href="#ex-smm" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;alldifferent.mzn&quot;</span><span class="p">;</span><span class="s"></span>

<span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">S</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">E</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">N</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">D</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">M</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">O</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">R</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">9</span><span class="p">:</span><span class="s"> </span><span class="nv">Y</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s">           </span><span class="m">1000</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">S</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">100</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">10</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">N</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">D</span><span class="s"></span>
<span class="s">                   </span><span class="o">+</span><span class="s"> </span><span class="m">1000</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">M</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">100</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">O</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">10</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">R</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">E</span><span class="s"></span>
<span class="s">       </span><span class="o">=</span><span class="s"> </span><span class="m">10000</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">M</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1000</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">O</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">100</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">N</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">10</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">E</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">Y</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="bp">alldifferent</span><span class="p">([</span><span class="nv">S</span><span class="p">,</span><span class="nv">E</span><span class="p">,</span><span class="nv">N</span><span class="p">,</span><span class="nv">D</span><span class="p">,</span><span class="nv">M</span><span class="p">,</span><span class="nv">O</span><span class="p">,</span><span class="nv">R</span><span class="p">,</span><span class="nv">Y</span><span class="p">]);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;   </span><span class="p">\(</span><span class="nv">S</span><span class="p">)\(</span><span class="nv">E</span><span class="p">)\(</span><span class="nv">N</span><span class="p">)\(</span><span class="nv">D</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s"></span>
<span class="s">        &quot;+  </span><span class="p">\(</span><span class="nv">M</span><span class="p">)\(</span><span class="nv">O</span><span class="p">)\(</span><span class="nv">R</span><span class="p">)\(</span><span class="nv">E</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s"></span>
<span class="s">        &quot;= </span><span class="p">\(</span><span class="nv">M</span><span class="p">)\(</span><span class="nv">O</span><span class="p">)\(</span><span class="nv">N</span><span class="p">)\(</span><span class="nv">E</span><span class="p">)\(</span><span class="nv">Y</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The SEND+MORE=MONEY problem requires assigning a different
digit to each letter so that the arithmetic constraint holds.
The model shown in <a class="reference internal" href="#ex-smm"><span class="std std-numref">Listing 2.2.4</span></a> uses the constraint expression
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="p">([</span><span class="nv">S</span><span class="p">,</span><span class="nv">E</span><span class="p">,</span><span class="nv">N</span><span class="p">,</span><span class="nv">D</span><span class="p">,</span><span class="nv">M</span><span class="p">,</span><span class="nv">O</span><span class="p">,</span><span class="nv">R</span><span class="p">,</span><span class="nv">Y</span><span class="p">])</span><span class="s"></span></code>
to ensure that each letter takes a different digit value.
The global constraint is made available
in the model using include item</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;alldifferent.mzn&quot;</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>which makes
the global constraint <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">alldifferent</span><span class="s"></span></code> usable by the model.
One could replace this line by</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;globals.mzn&quot;</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>which includes all globals.</p>
<p>A list of all the global constraints
defined for MiniZinc is included in the
release documentation. See <a class="reference internal" href="predicates.html#sec-globals"><span class="std std-ref">Global Constraints</span></a> for
a description of some important global constraints.</p>
</div>
<div class="section" id="conditional-expressions">
<h2>2.2.3. Conditional Expressions<a class="headerlink" href="#conditional-expressions" title="Permalink to this headline">¶</a></h2>
<p>MiniZinc provides a conditional <em>if-then-else-endif</em>
expression.
An example of its use is</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">r</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">x</span><span class="s"> </span><span class="o">div</span><span class="s"> </span><span class="nv">y</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">endif</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>which sets <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">r</span><span class="s"></span></code> to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> divided by <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">y</span><span class="s"></span></code> unless <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">y</span><span class="s"></span></code> is zero in which case
it sets it to zero.</p>
<div class="admonition-conditional-expressions admonition" id="defblock-6">
<p class="first admonition-title">Conditional expressions</p>
<p id="index-21">The form of a conditional expression is</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="s"> </span><span class="cs">&lt;bool-exp&gt;</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="cs">&lt;exp-1&gt;</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="cs">&lt;exp-2&gt;</span><span class="s"> </span><span class="k">endif</span><span class="s"></span>
</pre></div>
</div>
<p>It is a true expression rather than a control flow statement and so can be used in other expressions.
It evaluates to <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;exp-1&gt;</span><span class="s"></span></code> if the Boolean expression <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;bool-exp&gt;</span><span class="s"></span></code> is true and
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;exp-2&gt;</span><span class="s"></span></code> otherwise. The type of the conditional expression is that of
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;exp-1&gt;</span><span class="s"></span></code> and <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;exp-2&gt;</span><span class="s"></span></code> which must have the same
type.</p>
<p class="last">If the <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;bool-exp&gt;</span><span class="s"></span></code> contains decision variables, then the
type-inst
of the expression is <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="kt">var</span><span class="s"> </span><span class="cs">&lt;T&gt;</span><span class="s"></span></code> where <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;T&gt;</span><span class="s"></span></code> is the type of
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;exp-1&gt;</span><span class="s"></span></code> and <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;exp-2&gt;</span><span class="s"></span></code> even if both
expressions are fixed.</p>
</div>
<div class="literal-block-wrapper docutils container" id="ex-sudoku">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.5 </span><span class="caption-text">Model for generalized Sudoku problem (<a class="reference download internal" href="downloads/sudoku.mzn" download=""><tt class="xref download docutils literal">sudoku.mzn</tt></a>)</span><a class="headerlink" href="#ex-sudoku" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;alldifferent.mzn&quot;</span><span class="p">;</span><span class="s"></span>

<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">S</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">N</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">S</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nv">S</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">digs</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">ceil</span><span class="p">(</span><span class="nb">log</span><span class="p">(</span><span class="m">10.0</span><span class="p">,</span><span class="nb">int2float</span><span class="p">(</span><span class="nv">N</span><span class="p">)));</span><span class="s"> </span><span class="c">% digits for output</span><span class="s"></span>

<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">PuzzleRange</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">N</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">SubSquareRange</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">S</span><span class="p">;</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">N</span><span class="p">,</span><span class="m">1</span><span class="o">..</span><span class="nv">N</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">N</span><span class="p">:</span><span class="s"> </span><span class="nv">start</span><span class="p">;</span><span class="s"> </span><span class="c">%% initial board 0 = empty</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="nv">N</span><span class="p">,</span><span class="m">1</span><span class="o">..</span><span class="nv">N</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">PuzzleRange</span><span class="p">:</span><span class="s"> </span><span class="nv">puzzle</span><span class="p">;</span><span class="s"></span>

<span class="c">% fill initial board</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">PuzzleRange</span><span class="p">)(</span><span class="s"></span>
<span class="s">    </span><span class="k">if</span><span class="s"> </span><span class="nv">start</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">puzzle</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">start</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="k">endif</span><span class="s"> </span><span class="p">);</span><span class="s"></span>

<span class="c">% All different in rows </span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">PuzzleRange</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">                   </span><span class="bp">alldifferent</span><span class="p">(</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nv">puzzle</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">PuzzleRange</span><span class="s"> </span><span class="p">])</span><span class="s"> </span><span class="p">);</span><span class="s"> </span>

<span class="c">% All different in columns.</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">PuzzleRange</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">                   </span><span class="bp">alldifferent</span><span class="p">(</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nv">puzzle</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">PuzzleRange</span><span class="s"> </span><span class="p">])</span><span class="s"> </span><span class="p">);</span><span class="s"> </span>

<span class="c">% All different in sub-squares:</span><span class="s"></span>
<span class="k">constraint</span><span class="s"></span>
<span class="s">        </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">a</span><span class="p">,</span><span class="s"> </span><span class="nv">o</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">SubSquareRange</span><span class="p">)(</span><span class="s"></span>
<span class="s">                </span><span class="bp">alldifferent</span><span class="p">(</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nv">puzzle</span><span class="p">[(</span><span class="nv">a</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="s"> </span><span class="o">*</span><span class="nv">S</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">a1</span><span class="p">,</span><span class="s"> </span><span class="p">(</span><span class="nv">o</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">*</span><span class="nv">S</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">o1</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"></span>
<span class="s">                                        </span><span class="nv">a1</span><span class="p">,</span><span class="s"> </span><span class="nv">o1</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">SubSquareRange</span><span class="s"> </span><span class="p">]</span><span class="s"> </span><span class="p">)</span><span class="s"> </span><span class="p">);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s">  </span><span class="p">[</span><span class="s"> </span><span class="nb">show_int</span><span class="p">(</span><span class="nv">digs</span><span class="p">,</span><span class="nv">puzzle</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">++</span><span class="s"> &quot; &quot; </span><span class="o">++</span><span class="s"> </span>
<span class="s">         </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="nv">S</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot; &quot; </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"> </span><span class="o">++</span><span class="s"></span>
<span class="s">         </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">N</span><span class="s"> </span><span class="k">then</span><span class="s"></span>
<span class="s">             </span><span class="k">if</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">N</span><span class="s"> </span><span class="k">then</span><span class="s"> </span>
<span class="s">                </span><span class="k">if</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="nv">S</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">endif</span><span class="s"> </span>
<span class="s">         </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"> </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s">  </span>
<span class="s">         </span><span class="p">|</span><span class="s"> </span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">PuzzleRange</span><span class="s"> </span><span class="p">]</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="ex-sudokud">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.6 </span><span class="caption-text">Example data file for generalised Sudoku problem (<a class="reference download internal" href="downloads/sudoku.dzn" download=""><tt class="xref download docutils literal">sudoku.dzn</tt></a>)</span><a class="headerlink" href="#ex-sudokud" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">S</span><span class="o">=</span><span class="m">3</span><span class="p">;</span><span class="s"></span>
<span class="nv">start</span><span class="o">=</span><span class="p">[|</span><span class="s"></span>
<span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">|</span><span class="s"></span>
<span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">8</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">7</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">|</span><span class="s"></span>
<span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">8</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">|</span><span class="s"></span>
<span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">8</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">9</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">|</span><span class="s"></span>
<span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">7</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">9</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">|</span><span class="s"></span>
<span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">|</span><span class="s"></span>
<span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">|</span><span class="s"></span>
<span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">7</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">9</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">|</span><span class="s"></span>
<span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">,</span><span class="s"> </span><span class="m">0</span><span class="p">|];</span><span class="s"></span>
</pre></div>
</div>
</div>
<div class="figure" id="id1">
<span id="fig-sudoku"></span><img alt="images/sudoku.svg" src="images/sudoku.svg" /><p class="caption"><span class="caption-number">Fig. 2.2.1 </span><span class="caption-text">The problem represented by data file <a class="reference download internal" href="downloads/sudoku.dzn" download=""><tt class="xref download docutils literal">sudoku.dzn</tt></a></span></p>
</div>
<p>Conditional expressions are very useful in building complex models, or
complex output. Consider the model of Sudoku problems shown in
<a class="reference internal" href="#ex-sudoku"><span class="std std-numref">Listing 2.2.5</span></a>. The initial board positions are given by the
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">start</span><span class="s"></span></code> parameter where 0 represents an empty
board position. This is converted to constraints on the decision variables
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">puzzle</span><span class="s"></span></code> using the conditional expression</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">PuzzleRange</span><span class="p">)(</span><span class="s"></span>
<span class="s">     </span><span class="k">if</span><span class="s"> </span><span class="nv">start</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">&gt;</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nv">puzzle</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">start</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="l">true</span><span class="s"> </span><span class="k">endif</span><span class="s"> </span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>Conditional expressions are also very useful for
defining complex <span class="target" id="index-22"></span>output.
In the Sudoku model of <a class="reference internal" href="#ex-sudoku"><span class="std std-numref">Listing 2.2.5</span></a> the expression</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="nv">S</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot; &quot; </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"></span>
</pre></div>
</div>
<p>inserts an extra space between groups of size <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">S</span><span class="s"></span></code>.
The output expression also uses conditional expressions to
add blank lines
after each <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">S</span><span class="s"></span></code> lines. The resulting output is highly readable.</p>
<p>The remaining constraints ensure that the numbers appearing in each
row and column and <span class="math notranslate nohighlight">\(S \times S\)</span> subsquare are all different.</p>
<p id="index-23">One can use MiniZinc to search
for all solutions to a satisfaction problem (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="s"></span></code>). In the MiniZinc IDE, this can be achieved by setting the number of solutions to zero in the “User-defined behavior” part of the solver configuration pane (see <a class="reference internal" href="minizinc_ide.html#ide-solver-config"><span class="std std-numref">Section 3.2.2.2</span></a>). On the command line, one can use the flag <tt class="docutils literal">-a</tt>
or <tt class="docutils literal">--all-solutions</tt>. Running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc --solver gecode --all-solutions sudoku.mzn sudoku.dzn
</pre></div>
</div>
<p>results in</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> 5 9 3  7 6 2  8 1 4
 2 6 8  4 3 1  5 7 9
 7 1 4  9 8 5  2 3 6

 3 2 6  8 5 9  1 4 7
 1 8 7  3 2 4  9 6 5
 4 5 9  1 7 6  3 2 8

 9 4 2  6 1 8  7 5 3
 8 3 5  2 4 7  6 9 1
 6 7 1  5 9 3  4 8 2
----------
==========
</pre></div>
</div>
<p>The line <tt class="docutils literal">==========</tt>
is output when the system has output all possible
solutions, here verifying that there is exactly one.</p>
</div>
<div class="section" id="enumerated-types">
<span id="sec-enum"></span><h2>2.2.4. Enumerated Types<a class="headerlink" href="#enumerated-types" title="Permalink to this headline">¶</a></h2>
<p id="index-24">Enumerated types allows us to build models that depend on a set of objects
which are part of the data, or are named in the model, and hence make models
easier to understand and debug.
We have introduce enumerated types or enums briefly, in this subsection we
will explore how we can use them more fully, and show some of the built in
functions for dealing with enumerated types.</p>
<p>Let’s revisit the problem of coloring the graph of Australia from <a class="reference internal" href="modelling.html#sec-modelling"><span class="std std-ref">Basic Modelling in MiniZinc</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-aust-enum">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.7 </span><span class="caption-text">Model for coloring Australia using enumerated types (<a class="reference download internal" href="downloads/aust-enum.mzn" download=""><tt class="xref download docutils literal">aust-enum.mzn</tt></a>).</span><a class="headerlink" href="#ex-aust-enum" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">enum</span><span class="s"> </span><span class="nv">Color</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="nv">Color</span><span class="p">:</span><span class="s"> </span><span class="nv">wa</span><span class="p">;</span><span class="s"> </span>
<span class="kt">var</span><span class="s"> </span><span class="nv">Color</span><span class="p">:</span><span class="s"> </span><span class="nv">nt</span><span class="p">;</span><span class="s"> </span>
<span class="kt">var</span><span class="s"> </span><span class="nv">Color</span><span class="p">:</span><span class="s"> </span><span class="nv">sa</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="nv">Color</span><span class="p">:</span><span class="s"> </span><span class="nv">q</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="nv">Color</span><span class="p">:</span><span class="s"> </span><span class="nv">nsw</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="nv">Color</span><span class="p">:</span><span class="s"> </span><span class="nv">v</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="nv">Color</span><span class="p">:</span><span class="s"> </span><span class="nv">t</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">wa</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">nt</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">wa</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">sa</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">nt</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">sa</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">nt</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">q</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">sa</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">q</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nv">sa</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">nsw</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">sa</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">v</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">q</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">nsw</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span><span class="nv">nsw</span><span class="s"> </span><span class="o">!=</span><span class="s"> </span><span class="nv">v</span><span class="p">;</span><span class="s"> </span>
<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The model shown in <a class="reference internal" href="#ex-aust-enum"><span class="std std-numref">Listing 2.2.7</span></a> declares an enumerated type
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Color</span><span class="s"></span></code> which must be defined in the data file.  Each of the state
variables is declared to take a value from this enumerated type.
Running this program using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc --solver gecode -D<span class="s2">&quot;Color = { red, yellow, blue };&quot;</span> aust-enum.mzn
</pre></div>
</div>
<p>might result in output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>wa = blue;
nt = yellow;
sa = red;
q = blue;
nsw = yellow;
v = blue;
t = red;
</pre></div>
</div>
<div class="admonition-enumerated-type-variable-declarations admonition" id="defblock-7">
<p class="first admonition-title">Enumerated Type Variable Declarations</p>
<p id="index-25">An enumerated type parameter is declared as either:</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="cs">&lt;enum-name&gt;</span><span class="s"> </span><span class="p">:</span><span class="s"> </span><span class="cs">&lt;var-name&gt;</span><span class="s"></span>
<span class="cs">&lt;l&gt;</span><span class="s">..</span><span class="cs">&lt;u&gt;</span><span class="s"> </span><span class="p">:</span><span class="s"> </span><span class="cs">&lt;var-name&gt;</span><span class="s"></span>
</pre></div>
</div>
<p>where <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;enum-name&gt;</span><span class="s"></span></code> is the name of an enumerated type, and
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;l&gt;</span><span class="s"></span></code> and <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;u&gt;</span><span class="s"></span></code> are fixed enumerated type expressions of the same
enumerated type.</p>
<p>An enumerated type decision variable is declared
as either:</p>
<div class="highlight-minizincdef notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="s"> </span><span class="cs">&lt;enum-name&gt;</span><span class="s"> </span><span class="p">:</span><span class="s"> </span><span class="cs">&lt;var-name&gt;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="cs">&lt;l&gt;</span><span class="s">..</span><span class="cs">&lt;u&gt;</span><span class="s"> </span><span class="p">:</span><span class="s"> </span><span class="cs">&lt;var-name&gt;</span><span class="s"></span>
</pre></div>
</div>
<p class="last">where <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;enum-name&gt;</span><span class="s"></span></code> is the name of an enumerated type, and
<code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;l&gt;</span><span class="s"></span></code> and <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;u&gt;</span><span class="s"></span></code> are fixed enumerated type expressions of the same
enumerated type.</p>
</div>
<p>A key behaviour of enumerated types is that they are automatically coerced
to integers when they are used in a position expecting an integer.
For example, this allows us to use global constraints defined on integers,
such as</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="bp">global_cardinality_low_up</span><span class="p">([</span><span class="nv">wa</span><span class="p">,</span><span class="nv">nt</span><span class="p">,</span><span class="nv">sa</span><span class="p">,</span><span class="nv">q</span><span class="p">,</span><span class="nv">nsw</span><span class="p">,</span><span class="nv">v</span><span class="p">,</span><span class="nv">t</span><span class="p">],</span><span class="s"></span>
<span class="s">                          </span><span class="p">[</span><span class="nv">red</span><span class="p">,</span><span class="nv">yellow</span><span class="p">,</span><span class="nv">blue</span><span class="p">],[</span><span class="m">2,2</span><span class="p">,</span><span class="m">2</span><span class="p">],[</span><span class="m">2,2</span><span class="p">,</span><span class="m">3</span><span class="p">]);</span><span class="s"></span>
</pre></div>
</div>
<p>This requires at least two states to be colored each color and three to be
colored blue.</p>
<div class="admonition-enumerated-type-operations admonition" id="defblock-8">
<p class="first admonition-title">Enumerated Type Operations</p>
<p>There are a number of built in operations on enumerated types:</p>
<ul class="simple">
<li><code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nf">enum_next</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span><span class="nv">x</span><span class="p">)</span><span class="s"></span></code>: returns the next value after <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> in the
enumerated type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">X</span><span class="s"></span></code>. This is a partial function, if <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> is the last value in
the enumerated type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">X</span><span class="s"></span></code> then the function returns <span class="math notranslate nohighlight">\(\bot\)</span> causing the Boolean
expression containing the expression to evaluate to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="l">false</span><span class="s"></span></code>.</li>
<li><code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nf">enum_prev</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span><span class="nv">x</span><span class="p">)</span><span class="s"></span></code>:
returns the previous value before <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">x</span><span class="s"></span></code> in the
enumerated type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">X</span><span class="s"></span></code>. Similarly <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">enum_prev</span><span class="s"></span></code> is a partial function.</li>
<li><code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nf">to_enum</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span><span class="nv">i</span><span class="p">)</span><span class="s"></span></code>: maps an integer expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">i</span><span class="s"></span></code> to an
enumerated type value in type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">X</span><span class="s"></span></code> or evaluates to <span class="math notranslate nohighlight">\(\bot\)</span> if <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">i</span><span class="s"></span></code> is less
than or equal to 0 or greater than the number of elements in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">X</span><span class="s"></span></code>.</li>
</ul>
<p>Note also that a number of standard functions are applicable to enumerated
types:</p>
<ul class="last simple">
<li><code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">card</span><span class="p">(</span><span class="nv">X</span><span class="p">)</span><span class="s"></span></code>: returns the cardinality of an enumerated type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">X</span><span class="s"></span></code>.</li>
<li><code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">min</span><span class="p">(</span><span class="nv">X</span><span class="p">)</span><span class="s"></span></code>: returns the minimum element of of an enumerated type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">X</span><span class="s"></span></code>.</li>
<li><code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">max</span><span class="p">(</span><span class="nv">X</span><span class="p">)</span><span class="s"></span></code>: returns the maximum element of of an enumerated type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">X</span><span class="s"></span></code>.</li>
</ul>
</div>
<p>It is often useful to define an enumerated type by <em>extending</em> another enumerated type. A good example for this is adding a “don’t care” value to a type. For instance, consider a typical assignment problem, where we have to assign chores to flatmates. The names of the flatmates are given as an enumerated type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Flatmates</span><span class="s"></span></code>, and the chores as an enumerated type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Chores</span><span class="s"></span></code>.</p>
<p>In the case where not every flatmate needs to be assigned a job, and not every chore needs to be assigned to a flatmate, we need to introduce a value that signals “no assignment”. We can then use the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">alldifferent_except</span><span class="s"></span></code> constraint to constrain the assignment.</p>
<div class="literal-block-wrapper docutils container" id="ex-assignment-extend-enum">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.8 </span><span class="caption-text">Model for an assignment problem using extended enumerated types (<a class="reference download internal" href="downloads/assignment-extend-enum.mzn" download=""><tt class="xref download docutils literal">assignment-extend-enum.mzn</tt></a>).</span><a class="headerlink" href="#ex-assignment-extend-enum" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;alldifferent_except.mzn&quot;</span><span class="p">;</span><span class="s"></span>

<span class="kt">enum</span><span class="s"> </span><span class="nv">Flatmates</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">Anne</span><span class="p">,</span><span class="s"> </span><span class="nv">Bert</span><span class="p">,</span><span class="s"> </span><span class="nv">Ceci</span><span class="p">,</span><span class="s"> </span><span class="nv">Dave</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">Chores</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">Cooking</span><span class="p">,</span><span class="s"> </span><span class="nv">Vacuuming</span><span class="p">,</span><span class="s"> </span><span class="nv">Bathroom</span><span class="p">,</span><span class="s"> </span><span class="nv">Kitchen</span><span class="p">,</span><span class="s"> </span><span class="nv">Rubbish</span><span class="s"> </span><span class="p">};</span><span class="s"></span>

<span class="kt">enum</span><span class="s"> </span><span class="nv">ChoreOrNothing</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nf">C</span><span class="p">(</span><span class="nv">Chores</span><span class="p">)</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">Nothing</span><span class="s"> </span><span class="p">};</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">Flatmates</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">ChoreOrNothing</span><span class="p">:</span><span class="s"> </span><span class="nv">assignment</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="nf">alldifferent_except</span><span class="p">(</span><span class="nv">assignment</span><span class="p">,</span><span class="s"> </span><span class="p">{</span><span class="nv">Nothing</span><span class="p">});</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">f</span><span class="p">)</span><span class="o">++</span><span class="s">&quot;:</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">++</span><span class="s"></span>
<span class="s">         </span><span class="k">if</span><span class="s"> </span><span class="nb">fix</span><span class="p">(</span><span class="nv">assignment</span><span class="p">[</span><span class="nv">f</span><span class="p">])</span><span class="o">=</span><span class="nv">Nothing</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;Nothing</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">         </span><span class="k">else</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">C</span><span class="s">^</span><span class="o">-</span><span class="m">1</span><span class="p">(</span><span class="nv">assignment</span><span class="p">[</span><span class="nv">f</span><span class="p">]))</span><span class="o">++</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">endif</span><span class="s"></span>
<span class="s">       </span><span class="p">|</span><span class="s"> </span><span class="nv">f</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Flatmates</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The model is shown in <a class="reference internal" href="#ex-assignment-extend-enum"><span class="std std-numref">Listing 2.2.8</span></a>. It introduces a new enumerated type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">ChoreOrNothing</span><span class="s"></span></code>, which is a combination of the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Chores</span><span class="s"></span></code> type and a new constructor <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Nothing</span><span class="s"></span></code>. The <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Chores</span><span class="s"></span></code> type is <em>injected</em> into the new type via a <em>constructor function</em>. In this case, we chose the name <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">C</span><span class="s"></span></code> for the constructor function, but you can use any valid identifier you like. The constructor function can then be used to coerce a value of type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Chores</span><span class="s"></span></code> into a value of the new type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">ChoreOrNothing</span><span class="s"></span></code>. For example, we could write a constraint such as</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="nv">assignment</span><span class="p">[</span><span class="nv">Bert</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nf">C</span><span class="p">(</span><span class="nv">Vacuuming</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>This is required because the type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">ChoreOrNothing</span><span class="s"></span></code> is considered different from the type <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Chores</span><span class="s"></span></code> by the compiler, in order to avoid any ambiguities or accidental type conversions. The compiler also generates inverses of all constructor functions, to map back from the extended types into the base types. This can be seen in the output item, where <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">C</span><span class="s">^</span><span class="o">-</span><span class="m">1</span><span class="s"></span></code> is used to map from <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">ChoreOrNothing</span><span class="s"></span></code> back to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Chores</span><span class="s"></span></code>. The inverse function can be written as ASCII using the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="s">^</span><span class="o">-</span><span class="m">1</span><span class="s"></span></code> notation, or using the unicode symbols <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="s">⁻¹</span></code>, as in <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">C</span><span class="s">⁻¹</span></code>.</p>
<p>In the example above, we could have used option types, instead of adding a new value that acts essentially like the absent value <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">&lt;&gt;</span><span class="s"></span></code>. However, extended enum types have some advantages in this scenario. For example, we can extend a type by multiple extra values (say, different reasons for not being assigned any chore). We can also combine multiple enumerated types into one. Consider the scenario in <a class="reference internal" href="#ex-assignment-combine-enums"><span class="std std-numref">Listing 2.2.9</span></a> where we can assign chores to flatmates and/or robots. Flatmates have preferences for certain chores, while robots have integer benefits. The model also shows how to test if a value of the extended enum in fact belongs to the underlying enum: In the output item, the test <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">w</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nf">F</span><span class="p">(</span><span class="nv">Flatmates</span><span class="p">)</span><span class="s"></span></code> uses the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">F</span><span class="s"></span></code> constructor to translate the set <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Flatmates</span><span class="s"></span></code> into the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Worker</span><span class="s"></span></code> type, which enables the use of the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">in</span><span class="s"></span></code> operator.</p>
<div class="literal-block-wrapper docutils container" id="ex-assignment-combine-enums">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.9 </span><span class="caption-text">Model for an assignment problem using combined enumerated types (<a class="reference download internal" href="downloads/assignment-combine-enums.mzn" download=""><tt class="xref download docutils literal">assignment-combine-enums.mzn</tt></a>).</span><a class="headerlink" href="#ex-assignment-combine-enums" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;alldifferent_except.mzn&quot;</span><span class="p">;</span><span class="s"></span>

<span class="kt">enum</span><span class="s"> </span><span class="nv">Flatmates</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">Anne</span><span class="p">,</span><span class="s"> </span><span class="nv">Bert</span><span class="p">,</span><span class="s"> </span><span class="nv">Ceci</span><span class="p">,</span><span class="s"> </span><span class="nv">Dave</span><span class="s"> </span><span class="p">};</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">Robots</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">R2D2</span><span class="p">,</span><span class="s"> </span><span class="nv">C3PO</span><span class="p">,</span><span class="s"> </span><span class="nv">Marvin</span><span class="s"> </span><span class="p">};</span><span class="s"></span>

<span class="c">% Higher number = higher preference</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Flatmates</span><span class="p">,</span><span class="nv">Chores</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">preference</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="p">[|</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="s"> </span>
<span class="s">   </span><span class="p">|</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="s"> </span>
<span class="s">   </span><span class="p">|</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="s"> </span>
<span class="s">   </span><span class="p">|</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="s"> </span><span class="p">|];</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">Robots</span><span class="p">,</span><span class="nv">Chores</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">benefit</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="p">[|</span><span class="s"> </span><span class="m">20</span><span class="p">,</span><span class="s"> </span><span class="m">100</span><span class="p">,</span><span class="s"> </span><span class="m">20</span><span class="p">,</span><span class="s"> </span><span class="m">100</span><span class="p">,</span><span class="s"> </span><span class="m">30</span><span class="s"> </span>
<span class="s">   </span><span class="p">|</span><span class="s"> </span><span class="m">10</span><span class="p">,</span><span class="s"> </span><span class="m">120</span><span class="p">,</span><span class="s"> </span><span class="m">40</span><span class="p">,</span><span class="s"> </span><span class="m">40</span><span class="p">,</span><span class="s">  </span><span class="m">60</span><span class="s">  </span>
<span class="s">   </span><span class="p">|</span><span class="s"> </span><span class="m">50</span><span class="p">,</span><span class="s"> </span><span class="m">500</span><span class="p">,</span><span class="s"> </span><span class="m">30</span><span class="p">,</span><span class="s"> </span><span class="m">10</span><span class="p">,</span><span class="s">  </span><span class="m">70</span><span class="s"> </span><span class="p">|];</span><span class="s"></span>

<span class="kt">enum</span><span class="s"> </span><span class="nv">Chores</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">Cooking</span><span class="p">,</span><span class="s"> </span><span class="nv">Vacuuming</span><span class="p">,</span><span class="s"> </span><span class="nv">Bathroom</span><span class="p">,</span><span class="s"> </span><span class="nv">Kitchen</span><span class="p">,</span><span class="s"> </span><span class="nv">Rubbish</span><span class="s"> </span><span class="p">};</span><span class="s"></span>

<span class="kt">enum</span><span class="s"> </span><span class="nv">Workers</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nf">F</span><span class="p">(</span><span class="nv">Flatmates</span><span class="p">)</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="nf">R</span><span class="p">(</span><span class="nv">Robots</span><span class="p">);</span><span class="s"></span>

<span class="kt">enum</span><span class="s"> </span><span class="nv">ChoreOrNothing</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nf">C</span><span class="p">(</span><span class="nv">Chores</span><span class="p">)</span><span class="s"> </span><span class="o">++</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">Nothing</span><span class="s"> </span><span class="p">};</span><span class="s"></span>

<span class="c">% Create preference and benefit arrays with added values for Nothing</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">Flatmates</span><span class="p">,</span><span class="nv">ChoreOrNothing</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">prefWithNothing</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="nb">array2d</span><span class="p">(</span><span class="nv">Flatmates</span><span class="p">,</span><span class="nv">ChoreOrNothing</span><span class="p">,</span><span class="s"></span>
<span class="s">          </span><span class="p">[</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">c</span><span class="o">=</span><span class="nv">Nothing</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nv">preference</span><span class="p">[</span><span class="nv">f</span><span class="p">,</span><span class="nv">C</span><span class="s">^</span><span class="o">-</span><span class="m">1</span><span class="p">(</span><span class="nv">c</span><span class="p">)]</span><span class="s"> </span><span class="k">endif</span><span class="s"></span>
<span class="s">          </span><span class="p">|</span><span class="s"> </span><span class="nv">f</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Flatmates</span><span class="p">,</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">ChoreOrNothing</span><span class="p">]);</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">Robots</span><span class="p">,</span><span class="nv">ChoreOrNothing</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">benefitWithNothing</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="nb">array2d</span><span class="p">(</span><span class="nv">Robots</span><span class="p">,</span><span class="nv">ChoreOrNothing</span><span class="p">,</span><span class="s"></span>
<span class="s">          </span><span class="p">[</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">c</span><span class="o">=</span><span class="nv">Nothing</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nv">benefit</span><span class="p">[</span><span class="nv">r</span><span class="p">,</span><span class="nv">C</span><span class="s">^</span><span class="o">-</span><span class="m">1</span><span class="p">(</span><span class="nv">c</span><span class="p">)]</span><span class="s"> </span><span class="k">endif</span><span class="s"></span>
<span class="s">          </span><span class="p">|</span><span class="s"> </span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Robots</span><span class="p">,</span><span class="s"> </span><span class="nv">c</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">ChoreOrNothing</span><span class="p">]);</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">Workers</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">ChoreOrNothing</span><span class="p">:</span><span class="s"> </span><span class="nv">assignment</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="nf">alldifferent_except</span><span class="p">(</span><span class="nv">assignment</span><span class="p">,</span><span class="s"> </span><span class="p">{</span><span class="nv">Nothing</span><span class="p">});</span><span class="s"></span>

<span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">overall_preferences</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="nb">sum</span><span class="p">(</span><span class="nv">f</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Flatmates</span><span class="p">)(</span><span class="nv">prefWithNothing</span><span class="p">[</span><span class="nv">f</span><span class="p">,</span><span class="s"> </span><span class="nv">assignment</span><span class="p">[</span><span class="nf">F</span><span class="p">(</span><span class="nv">f</span><span class="p">)]]);</span><span class="s"></span>

<span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">overall_benefit</span><span class="s"> </span><span class="o">=</span><span class="s"></span>
<span class="s">  </span><span class="nb">sum</span><span class="p">(</span><span class="nv">r</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Robots</span><span class="p">)(</span><span class="nv">benefitWithNothing</span><span class="p">[</span><span class="nv">r</span><span class="p">,</span><span class="s"> </span><span class="nv">assignment</span><span class="p">[</span><span class="nf">R</span><span class="p">(</span><span class="nv">r</span><span class="p">)]]);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">maximize</span><span class="s"> </span><span class="nv">overall_benefit</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">overall_preferences</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="k">if</span><span class="s"> </span><span class="nv">w</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nf">F</span><span class="p">(</span><span class="nv">Flatmates</span><span class="p">)</span><span class="s"> </span><span class="k">then</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">F</span><span class="s">^</span><span class="o">-</span><span class="m">1</span><span class="p">(</span><span class="nv">w</span><span class="p">))</span><span class="s"> </span><span class="k">else</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">R</span><span class="s">^</span><span class="o">-</span><span class="m">1</span><span class="p">(</span><span class="nv">w</span><span class="p">))</span><span class="s"> </span><span class="k">endif</span><span class="o">++</span><span class="s">&quot;:</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">++</span><span class="s"></span>
<span class="s">         </span><span class="k">if</span><span class="s"> </span><span class="nb">fix</span><span class="p">(</span><span class="nv">assignment</span><span class="p">[</span><span class="nv">w</span><span class="p">])</span><span class="o">=</span><span class="nv">Nothing</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;Nothing</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">         </span><span class="k">else</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">C</span><span class="s">^</span><span class="o">-</span><span class="m">1</span><span class="p">(</span><span class="nv">assignment</span><span class="p">[</span><span class="nv">w</span><span class="p">]))</span><span class="o">++</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">endif</span><span class="s"></span>
<span class="s">       </span><span class="p">|</span><span class="s"> </span><span class="nv">w</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Workers</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="complex-constraints">
<span id="sec-complex"></span><h2>2.2.5. Complex Constraints<a class="headerlink" href="#complex-constraints" title="Permalink to this headline">¶</a></h2>
<p id="index-26">Constraints are the core of the MiniZinc model.
We have seen simple relational expressions but constraints can be considerably more powerful than this.
A constraint is allowed to be any Boolean expression.
Imagine a scheduling problem in which we have
two tasks that cannot overlap in time.
If <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s1</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s2</span><span class="s"></span></code> are the corresponding start times
and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">d1</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">d2</span><span class="s"></span></code> are the corresponding
durations
we can express this as:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="nv">s1</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d1</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s2</span><span class="s">  </span><span class="o">\/</span><span class="s"> </span><span class="nv">s2</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d2</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s1</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>which ensures that the tasks do not overlap.</p>
<div class="admonition-booleans admonition" id="defblock-9">
<p class="first admonition-title">Booleans</p>
<p class="last" id="index-27">Boolean expressions in MiniZinc can be written using a standard mathematical syntax.
The Boolean literals are <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="l">true</span><span class="s"></span></code> and
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="l">false</span><span class="s"></span></code>
and the Boolean
operators
are
conjunction, i.e. and  (<tt class="docutils literal">/\</tt>),
disjunction, i.e. or  (<tt class="docutils literal">\/</tt>),
only-if (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">&lt;-</span><span class="s"></span></code>),
implies (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">-&gt;</span><span class="s"></span></code>),
if-and-only-if (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">&lt;-&gt;</span><span class="s"></span></code>) and
negation (<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">not</span><span class="s"></span></code>).
Booleans can be automatically coerced to integers, but to make this
coercion explicit the
built-in function <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">bool2int</span><span class="s"></span></code> can be used: it
returns 1 if its argument is true and 0 otherwise.</p>
</div>
<div class="literal-block-wrapper docutils container" id="ex-jobshop">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.10 </span><span class="caption-text">Model for job-shop scheduling problems (<a class="reference download internal" href="downloads/jobshop.mzn" download=""><tt class="xref download docutils literal">jobshop.mzn</tt></a>).</span><a class="headerlink" href="#ex-jobshop" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">enum</span><span class="s"> </span><span class="nv">JOB</span><span class="p">;</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">TASK</span><span class="p">;</span><span class="s"></span>
<span class="nv">TASK</span><span class="p">:</span><span class="s"> </span><span class="nv">last</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">max</span><span class="p">(</span><span class="nv">TASK</span><span class="p">);</span><span class="s"></span>
<span class="kt">array</span><span class="s"> </span><span class="p">[</span><span class="nv">JOB</span><span class="p">,</span><span class="nv">TASK</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">d</span><span class="p">;</span><span class="s">                   </span><span class="c">% task durations</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">total</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="p">)(</span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]);</span><span class="c">% total duration</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">digs</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">ceil</span><span class="p">(</span><span class="nb">log</span><span class="p">(</span><span class="m">10.0</span><span class="p">,</span><span class="nb">int2float</span><span class="p">(</span><span class="nv">total</span><span class="p">)));</span><span class="s"> </span><span class="c">% digits for output</span><span class="s"></span>
<span class="kt">array</span><span class="s"> </span><span class="p">[</span><span class="nv">JOB</span><span class="p">,</span><span class="nv">TASK</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">total</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">;</span><span class="s">          </span><span class="c">% start times</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">total</span><span class="p">:</span><span class="s"> </span><span class="nv">end</span><span class="p">;</span><span class="s">                            </span><span class="c">% total end time</span><span class="s"></span>


<span class="k">constraint</span><span class="s"> </span><span class="c">%% ensure the tasks occur in sequence</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">last</span><span class="p">)</span><span class="s"> </span>
<span class="s">            </span><span class="p">(</span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nf">enum_next</span><span class="p">(</span><span class="nv">TASK</span><span class="p">,</span><span class="nv">j</span><span class="p">)])</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">        </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">last</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">last</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">end</span><span class="s"></span>
<span class="s">    </span><span class="p">);</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="c">%% ensure no overlap of tasks</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nv">i</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">k</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">            </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">k</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">\/</span><span class="s"></span>
<span class="s">            </span><span class="nv">s</span><span class="p">[</span><span class="nv">k</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">d</span><span class="p">[</span><span class="nv">k</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"></span>
<span class="s">        </span><span class="p">)</span><span class="s"></span>
<span class="s">    </span><span class="p">);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">minimize</span><span class="s"> </span><span class="nv">end</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;end = </span><span class="p">\(</span><span class="nv">end</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">]</span><span class="s"> </span><span class="o">++</span><span class="s"></span>
<span class="s">       </span><span class="p">[</span><span class="s"> </span><span class="nb">show_int</span><span class="p">(</span><span class="nv">digs</span><span class="p">,</span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">++</span><span class="s"> &quot; &quot; </span><span class="o">++</span><span class="s"> </span>
<span class="s">         </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">last</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span><span class="s"></span>
<span class="s">         </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">JOB</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">TASK</span><span class="s"> </span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="ex-jdata">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.11 </span><span class="caption-text">Data for job-shop scheduling problems (<a class="reference download internal" href="downloads/jdata.dzn" download=""><tt class="xref download docutils literal">jdata.dzn</tt></a>).</span><a class="headerlink" href="#ex-jdata" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">JOB</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nf">anon_enum</span><span class="p">(</span><span class="m">5</span><span class="p">);</span><span class="s"></span>
<span class="nv">TASK</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nf">anon_enum</span><span class="p">(</span><span class="m">5</span><span class="p">);</span><span class="s"></span>
<span class="nv">d</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[|</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="s"> </span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">7</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="s"></span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="s">  </span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">6</span><span class="p">,</span><span class="s"> </span><span class="m">8</span><span class="s"></span>
<span class="s">     </span><span class="p">|</span><span class="s"> </span><span class="m">7</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="p">|];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>The job shop scheduling model given in <a class="reference internal" href="#ex-jobshop"><span class="std std-numref">Listing 2.2.10</span></a>
gives a realistic example of the use of this disjunctive modelling
capability. In job shop scheduling we have a set of jobs, each consisting
of a sequence of tasks on separate machines: so task <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"></span></code> is the
task in the <span class="math notranslate nohighlight">\(i^{th}\)</span> job performed on the <span class="math notranslate nohighlight">\(j^{th}\)</span> machine.
Each sequence of tasks must be completed in order,
and no two tasks on the same machine can overlap in time.
Even for small instances of this problem it can be quite challenging to find
optimal solutions.</p>
<p>The command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc --solver gecode --all-solutions jobshop.mzn jdata.dzn
</pre></div>
</div>
<p>solves a small job shop scheduling problem, and illustrates the behaviour of
<tt class="docutils literal">--all-solutions</tt> for optimisation problems (note that when running this in the MiniZinc IDE, <tt class="docutils literal">--all-solutions</tt> is the default behaviour for optimisation problems).  Here the solver outputs increasingly better solutions as it finds them, rather than all possible optimal
solutions. The output from this command is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>end = 39
 5  9 13 22 30
 6 13 18 25 36
 0  4  8 12 16
 4  8 12 16 22
 9 16 25 27 38
----------
end = 37
 4  8 12 17 20
 5 13 18 26 34
 0  4  8 12 16
 8 12 17 20 26
 9 16 25 27 36
----------
end = 34
 0  1  5 10 13
 6 10 15 23 31
 2  6 11 19 27
 1  5 10 13 19
 9 16 22 24 33
----------
end = 30
 5  9 13 18 21
 6 13 18 25 27
 1  5  9 13 17
 0  1  2  3  9
 9 16 25 27 29
----------
==========
</pre></div>
</div>
<p>indicating an optimal solution with end time 30 is finally found,
and proved optimal.
We can generate all <em>optimal solutions</em>
by adding a constraint that
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">end</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">30</span><span class="s"></span></code> and changing the solve item to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="s"></span></code>
and then executing</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc --solver gecode --all-solutions jobshop.mzn jobshop.dzn
</pre></div>
</div>
<p>For this problem there are 3,444,375 optimal solutions. In the MiniZinc IDE, you would have to select “User-defined behavior” in the configuration pane and set the number of solutions to zero in order to display all solutions of this satisfaction problem.</p>
<div class="literal-block-wrapper docutils container" id="ex-stable-marriage">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.12 </span><span class="caption-text">Model for the stable marriage problem (<a class="reference download internal" href="downloads/stable-marriage.mzn" download=""><tt class="xref download docutils literal">stable-marriage.mzn</tt></a>).</span><a class="headerlink" href="#ex-stable-marriage" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s"></span>

<span class="kt">enum</span><span class="s"> </span><span class="nv">Men</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nf">anon_enum</span><span class="p">(</span><span class="nv">n</span><span class="p">);</span><span class="s"></span>
<span class="kt">enum</span><span class="s"> </span><span class="nv">Women</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nf">anon_enum</span><span class="p">(</span><span class="nv">n</span><span class="p">);</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">Women</span><span class="p">,</span><span class="s"> </span><span class="nv">Men</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">rankWomen</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Men</span><span class="p">,</span><span class="s"> </span><span class="nv">Women</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">rankMen</span><span class="p">;</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">Men</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">Women</span><span class="p">:</span><span class="s"> </span><span class="nv">wife</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Women</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">Men</span><span class="p">:</span><span class="s"> </span><span class="nv">husband</span><span class="p">;</span><span class="s"></span>

<span class="c">% assignment</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">m</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Men</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">husband</span><span class="p">[</span><span class="nv">wife</span><span class="p">[</span><span class="nv">m</span><span class="p">]]</span><span class="o">=</span><span class="nv">m</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">w</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Women</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">wife</span><span class="p">[</span><span class="nv">husband</span><span class="p">[</span><span class="nv">w</span><span class="p">]]</span><span class="o">=</span><span class="nv">w</span><span class="p">);</span><span class="s"></span>
<span class="c">% ranking</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">m</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Men</span><span class="p">,</span><span class="s"> </span><span class="nv">o</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Women</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">     </span><span class="nv">rankMen</span><span class="p">[</span><span class="nv">m</span><span class="p">,</span><span class="nv">o</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">rankMen</span><span class="p">[</span><span class="nv">m</span><span class="p">,</span><span class="nv">wife</span><span class="p">[</span><span class="nv">m</span><span class="p">]]</span><span class="s"> </span><span class="o">-&gt;</span><span class="s"> </span>
<span class="s">         </span><span class="nv">rankWomen</span><span class="p">[</span><span class="nv">o</span><span class="p">,</span><span class="nv">husband</span><span class="p">[</span><span class="nv">o</span><span class="p">]]</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">rankWomen</span><span class="p">[</span><span class="nv">o</span><span class="p">,</span><span class="nv">m</span><span class="p">]</span><span class="s"> </span><span class="p">);</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">w</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Women</span><span class="p">,</span><span class="s"> </span><span class="nv">o</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Men</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">     </span><span class="nv">rankWomen</span><span class="p">[</span><span class="nv">w</span><span class="p">,</span><span class="nv">o</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">rankWomen</span><span class="p">[</span><span class="nv">w</span><span class="p">,</span><span class="nv">husband</span><span class="p">[</span><span class="nv">w</span><span class="p">]]</span><span class="s"> </span><span class="o">-&gt;</span><span class="s"> </span>
<span class="s">         </span><span class="nv">rankMen</span><span class="p">[</span><span class="nv">o</span><span class="p">,</span><span class="nv">wife</span><span class="p">[</span><span class="nv">o</span><span class="p">]]</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">rankMen</span><span class="p">[</span><span class="nv">o</span><span class="p">,</span><span class="nv">w</span><span class="p">]</span><span class="s"> </span><span class="p">);</span><span class="s"></span>
<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;wives= </span><span class="p">\(</span><span class="nv">wife</span><span class="p">)</span><span class="se">\n</span><span class="s">husbands= </span><span class="p">\(</span><span class="nv">husband</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="ex-sm-data">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.13 </span><span class="caption-text">Example data for the stable marriage problem (<a class="reference download internal" href="downloads/stable-marriage.dzn" download=""><tt class="xref download docutils literal">stable-marriage.dzn</tt></a>).</span><a class="headerlink" href="#ex-sm-data" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">5</span><span class="p">;</span><span class="s"></span>
<span class="nv">rankWomen</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s"> </span><span class="p">[|</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"></span>
<span class="s">  </span><span class="p">|</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"></span>
<span class="s">  </span><span class="p">|</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"></span>
<span class="s">  </span><span class="p">|</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"></span>
<span class="s">  </span><span class="p">|</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="p">|];</span><span class="s"></span>
<span class="s">  </span>
<span class="nv">rankMen</span><span class="s"> </span><span class="o">=</span><span class="s"> </span>
<span class="s"> </span><span class="p">[|</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"></span>
<span class="s">  </span><span class="p">|</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"></span>
<span class="s">  </span><span class="p">|</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"></span>
<span class="s">  </span><span class="p">|</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="p">,</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"></span>
<span class="s">  </span><span class="p">|</span><span class="s"> </span><span class="m">4</span><span class="p">,</span><span class="s"> </span><span class="m">3</span><span class="p">,</span><span class="s"> </span><span class="m">2</span><span class="p">,</span><span class="s"> </span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="m">5</span><span class="s"> </span><span class="p">|];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>Another powerful modelling feature in MiniZinc is
that decision variables
can be used for <span class="target" id="index-28"></span>array access.
As an example, consider the
(old-fashioned) <em>stable marriage problem</em>. We have <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">n</span><span class="s"></span></code> (straight) women and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">n</span><span class="s"></span></code> (straight)
men. Each man has a ranked list of women and vice versa. We want to find a
husband/wife for each women/man so that all marriages are <em>stable</em> in
the sense that:</p>
<ul class="simple">
<li>whenever <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">m</span><span class="s"></span></code> prefers another women <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">o</span><span class="s"></span></code> to his wife <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">w</span><span class="s"></span></code>, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">o</span><span class="s"></span></code> prefers her husband to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">m</span><span class="s"></span></code>, and</li>
<li>whenever <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">w</span><span class="s"></span></code> prefers another man <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">o</span><span class="s"></span></code> to her husband <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">m</span><span class="s"></span></code>, <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">o</span><span class="s"></span></code> prefers his wife to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">w</span><span class="s"></span></code>.</li>
</ul>
<p>This can be elegantly modelled in
MiniZinc.
The model and sample data is shown in <a class="reference internal" href="#ex-stable-marriage"><span class="std std-numref">Listing 2.2.12</span></a> and <a class="reference internal" href="#ex-sm-data"><span class="std std-numref">Listing 2.2.13</span></a>.</p>
<p>The first three items in the model declare the number of men/women and the
set of men and women. Here we introduce the use of <em>anonymous enumerated types</em>.
Both <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Men</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Women</span><span class="s"></span></code> are sets of size
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">n</span><span class="s"></span></code>, but we do not wish to mix them up so we use an anonymous enumerated
type. This allows MiniZinc to detect modelling errors where we use
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Men</span><span class="s"></span></code> for <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Women</span><span class="s"></span></code> or vice versa.</p>
<p>The matrices <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">rankWomen</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">rankMen</span><span class="s"></span></code>,
respectively, give the women’s ranking  of the men and the men’s ranking of the women.
Thus, the entry  <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">rankWomen</span><span class="p">[</span><span class="nv">w</span><span class="p">,</span><span class="nv">m</span><span class="p">]</span><span class="s"></span></code>
gives the ranking by woman <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">w</span><span class="s"></span></code> of man <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">m</span><span class="s"></span></code>. The lower the number in the ranking, the more the man or women is preferred.</p>
<p>There are two arrays of decision variables: <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">wife</span><span class="s"></span></code> and
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">husband</span><span class="s"></span></code>. These, respectively, contain the wife of each man and the
husband of each women.</p>
<p>The first two constraints</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">m</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Men</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">husband</span><span class="p">[</span><span class="nv">wife</span><span class="p">[</span><span class="nv">m</span><span class="p">]]</span><span class="o">=</span><span class="nv">m</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">w</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Women</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">wife</span><span class="p">[</span><span class="nv">husband</span><span class="p">[</span><span class="nv">w</span><span class="p">]]</span><span class="o">=</span><span class="nv">w</span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>ensure that the assignment of husbands and wives is consistent: <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">w</span><span class="s"></span></code> is the
wife of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">m</span><span class="s"></span></code> implies <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">m</span><span class="s"></span></code> is the husband of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">w</span><span class="s"></span></code> and vice versa. Notice how in
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">husband</span><span class="p">[</span><span class="nv">wife</span><span class="p">[</span><span class="nv">m</span><span class="p">]]</span><span class="s"></span></code> the index expression <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">wife</span><span class="p">[</span><span class="nv">m</span><span class="p">]</span><span class="s"></span></code> is a
decision variable, not a parameter.</p>
<p>The next two constraints are a  direct encoding of the stability condition:</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">m</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Men</span><span class="p">,</span><span class="s"> </span><span class="nv">o</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Women</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">     </span><span class="nv">rankMen</span><span class="p">[</span><span class="nv">m</span><span class="p">,</span><span class="nv">o</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">rankMen</span><span class="p">[</span><span class="nv">m</span><span class="p">,</span><span class="nv">wife</span><span class="p">[</span><span class="nv">m</span><span class="p">]]</span><span class="s"> </span><span class="o">-&gt;</span><span class="s"> </span>
<span class="s">         </span><span class="nv">rankWomen</span><span class="p">[</span><span class="nv">o</span><span class="p">,</span><span class="nv">husband</span><span class="p">[</span><span class="nv">o</span><span class="p">]]</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">rankWomen</span><span class="p">[</span><span class="nv">o</span><span class="p">,</span><span class="nv">m</span><span class="p">]</span><span class="s"> </span><span class="p">);</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">w</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Women</span><span class="p">,</span><span class="s"> </span><span class="nv">o</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Men</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">     </span><span class="nv">rankWomen</span><span class="p">[</span><span class="nv">w</span><span class="p">,</span><span class="nv">o</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">rankWomen</span><span class="p">[</span><span class="nv">w</span><span class="p">,</span><span class="nv">husband</span><span class="p">[</span><span class="nv">w</span><span class="p">]]</span><span class="s"> </span><span class="o">-&gt;</span><span class="s"> </span>
<span class="s">         </span><span class="nv">rankMen</span><span class="p">[</span><span class="nv">o</span><span class="p">,</span><span class="nv">wife</span><span class="p">[</span><span class="nv">o</span><span class="p">]]</span><span class="s"> </span><span class="o">&lt;</span><span class="s"> </span><span class="nv">rankMen</span><span class="p">[</span><span class="nv">o</span><span class="p">,</span><span class="nv">w</span><span class="p">]</span><span class="s"> </span><span class="p">);</span><span class="s"></span>
</pre></div>
</div>
<p>This natural modelling of the stable marriage problem is made possible by
the ability to use decision variables as array indices and to construct
constraints using the standard Boolean connectives.
The alert reader may
be wondering at this stage, what happens if the array index variable takes a
value that is outside the index set of the array. MiniZinc treats this as
failure: an array access <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">a</span><span class="p">[</span><span class="nv">e</span><span class="p">]</span><span class="s"></span></code> implicitly adds the constraint
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">e</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nb">index_set</span><span class="p">(</span><span class="nv">a</span><span class="p">)</span><span class="s"></span></code>
to the closest surrounding Boolean context where
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">index_set</span><span class="p">(</span><span class="nv">a</span><span class="p">)</span><span class="s"></span></code>
gives the index set of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">a</span><span class="s"></span></code>.</p>
<div class="admonition-anonymous-enumerated-types admonition" id="defblock-10">
<p class="first admonition-title">Anonymous Enumerated Types</p>
<p id="index-29">An <em>anonymous enumerated type</em>
is of the form <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="nf">anon_enum</span><span class="p">(</span><span class="cs">&lt;n&gt;</span><span class="p">)</span><span class="s"></span></code> where <code class="code mzndef minizincdef docutils literal highlight highlight-minizincdef"><span></span><span class="cs">&lt;n&gt;</span><span class="s"></span></code> is a fixed integer
expression defining the size of the enumerated type.</p>
<p class="last">An anonymous enumerated type is just like any other enumerated type except
that we have no names for its elements. When printed out, they are given
unique names based on the enumerated type name.</p>
</div>
<p>Thus for example, consider the variable declarations</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">array</span><span class="p">[</span><span class="m">1</span><span class="o">..</span><span class="m">2</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">a</span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="m">2,3</span><span class="p">];</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">2</span><span class="p">:</span><span class="s"> </span><span class="nv">x</span><span class="p">;</span><span class="s"></span>
<span class="kt">var</span><span class="s"> </span><span class="m">2</span><span class="o">..</span><span class="m">3</span><span class="p">:</span><span class="s"> </span><span class="nv">y</span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
<p>The constraint <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">a</span><span class="p">[</span><span class="nv">x</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">y</span><span class="s"></span></code>
will succeed with <span class="math notranslate nohighlight">\(x=1 \wedge y=2\)</span> and <span class="math notranslate nohighlight">\(x=2 \wedge y=3\)</span>.
And the constraint <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="o">not</span><span class="s"> </span><span class="nv">a</span><span class="p">[</span><span class="nv">x</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">y</span><span class="s"></span></code> will succeed with
<span class="math notranslate nohighlight">\(x=0 \wedge y=2\)</span>, <span class="math notranslate nohighlight">\(x=0 \wedge y=3\)</span>, <span class="math notranslate nohighlight">\(x=1 \wedge y=3\)</span> and <span class="math notranslate nohighlight">\(x=2 \wedge y=2\)</span>.</p>
<p>In the case of invalid array accesses by a parameter, the formal semantics
of MiniZinc treats this as failure so as to ensure that the treatment of
parameters and decision variables is consistent, but a warning is issued
since it is almost always an error.</p>
<div class="literal-block-wrapper docutils container" id="ex-magic-series">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.14 </span><span class="caption-text">Model solving the magic series problem (<a class="reference download internal" href="downloads/magic-series.mzn" download=""><tt class="xref download docutils literal">magic-series.mzn</tt></a>).</span><a class="headerlink" href="#ex-magic-series" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">n</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="m">0</span><span class="o">..</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">n</span><span class="p">:</span><span class="s"> </span><span class="nv">s</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">   </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">)(</span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">s</span><span class="p">[</span><span class="nv">j</span><span class="p">]</span><span class="o">=</span><span class="nv">i</span><span class="p">))));</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s">   </span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> &quot;s = </span><span class="p">\(</span><span class="nv">s</span><span class="p">)</span><span class="s">;</span><span class="se">\n</span><span class="s">&quot; </span><span class="p">]</span><span class="s"> </span><span class="p">;</span><span class="s"></span>
</pre></div>
</div>
</div>
<p id="index-30">The coercion function
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">bool2int</span><span class="s"></span></code>
can be called with any Boolean
expression. This allows the MiniZinc
modeller to use so called <em>higher order constraints</em>.
As a simple example consider the <em>magic series problem</em>:
find a list of numbers <span class="math notranslate nohighlight">\(s= [s_0,\ldots,s_{n-1}]\)</span>
such that <span class="math notranslate nohighlight">\(s_i\)</span> is the number
of occurrences of <span class="math notranslate nohighlight">\(i\)</span> in <span class="math notranslate nohighlight">\(s\)</span>. An example is <span class="math notranslate nohighlight">\(s = [1,2,1,0]\)</span>.</p>
<p>A MiniZinc
model for this problem
is shown in <a class="reference internal" href="#ex-magic-series"><span class="std std-numref">Listing 2.2.14</span></a>. The use of
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">bool2int</span><span class="s"></span></code> allows us to sum up the number of times the constraint
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s</span><span class="p">[</span><span class="nv">j</span><span class="p">]</span><span class="o">=</span><span class="nv">i</span><span class="s"></span></code> is satisfied.
Executing the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc --solver gecode --all-solutions magic-series.mzn -D <span class="s2">&quot;n=4;&quot;</span>
</pre></div>
</div>
<p>leads to the output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>s = [1, 2, 1, 0];
----------
s = [2, 0, 2, 0];
----------
==========
</pre></div>
</div>
<p>indicating exactly two solutions to the problem (the effect of <tt class="docutils literal">--all-solutions</tt> can be achieved in the MiniZinc IDE using the “User-defined behavior” option in the solver configuration pane).</p>
<p>Note that MiniZinc will automatically coerce Booleans
to integers and integers to floats when required.
We could replace the the constraint item in <a class="reference internal" href="#ex-magic-series"><span class="std std-numref">Listing 2.2.14</span></a>
with</p>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">   </span><span class="nv">s</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="p">)(</span><span class="nv">s</span><span class="p">[</span><span class="nv">j</span><span class="p">]</span><span class="o">=</span><span class="nv">i</span><span class="p">)));</span><span class="s"></span>
</pre></div>
</div>
<p>and get identical results, since the Boolean expression
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s</span><span class="p">[</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">i</span><span class="s"></span></code> will be automatically coerced to an
integer, effectively by the MiniZinc system automatically adding the
missing <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">bool2int</span><span class="s"></span></code>.</p>
<div class="admonition-coercion admonition" id="defblock-11">
<p class="first admonition-title">Coercion</p>
<p id="index-31">In MiniZinc one can <em>coerce</em> a Boolean value to
an integer value using the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">bool2int</span><span class="s"></span></code> function.
Similarly one can coerce an integer value to a float value using
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">int2float</span><span class="s"></span></code>.
The instantiation of the coerced value is the same as the argument,
e.g. <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">par</span><span class="s"> </span><span class="kt">bool</span><span class="s"></span></code> is coerced to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">par</span><span class="s"> </span><span class="kt">int</span><span class="s"></span></code>, while
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">var</span><span class="s"> </span><span class="kt">bool</span><span class="s"></span></code> is coerced to <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">var</span><span class="s"> </span><span class="kt">int</span><span class="s"></span></code>.</p>
<p class="last">MiniZinc automatically coerces Boolean expressions to integer
expressions and integer expressions to float expressions,
by inserting <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">bool2int</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">int2float</span><span class="s"></span></code> in the model
appropriately.
Note that it will also coerce Booleans to floats using two steps.</p>
</div>
</div>
<div class="section" id="set-constraints">
<h2>2.2.6. Set Constraints<a class="headerlink" href="#set-constraints" title="Permalink to this headline">¶</a></h2>
<p id="index-32">Another powerful modelling feature of MiniZinc
is that it allows sets
containing integers to be decision variables:
this means that when the model is evaluated the solver will find which elements are in the set.</p>
<p>As a simple example, consider the <em>0/1 knapsack problem</em>. This is a
restricted form of the knapsack problem in which we can either choose to
place the item in the knapsack or not. Each item has a weight and a profit
and we want to find which choice of items leads to the maximum profit
subject to the knapsack not being too full.</p>
<p>It is natural to model this in MiniZinc with a single decision variable: <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">var</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">ITEM</span><span class="p">:</span><span class="s"> </span><span class="bp">knapsack</span><span class="s"></span></code>
where <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">ITEM</span><span class="s"></span></code> is the set of possible items. If the arrays
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">weight</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"></span></code> and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">profit</span><span class="p">[</span><span class="nv">i</span><span class="p">]</span><span class="s"></span></code> respectively give the weight and
profit of item <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">i</span><span class="s"></span></code>, and the maximum weight the knapsack can carry is
given by <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">capacity</span><span class="s"></span></code> then a natural model is given in
<a class="reference internal" href="#ex-knapsack-binary"><span class="std std-numref">Listing 2.2.15</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="ex-knapsack-binary">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.15 </span><span class="caption-text">Model for the 0/1 knapsack problem (<a class="reference download internal" href="downloads/knapsack.mzn" download=""><tt class="xref download docutils literal">knapsack.mzn</tt></a>).</span><a class="headerlink" href="#ex-knapsack-binary" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">enum</span><span class="s"> </span><span class="nv">ITEM</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">capacity</span><span class="p">;</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">ITEM</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">profits</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">ITEM</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">weights</span><span class="p">;</span><span class="s"></span>

<span class="kt">var</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">ITEM</span><span class="p">:</span><span class="s"> </span><span class="bp">knapsack</span><span class="p">;</span><span class="s"></span>

<span class="k">constraint</span><span class="s"> </span><span class="nb">sum</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="bp">knapsack</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">weights</span><span class="p">[</span><span class="nv">i</span><span class="p">])</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="nv">capacity</span><span class="p">;</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">maximize</span><span class="s"> </span><span class="nb">sum</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="bp">knapsack</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="nv">profits</span><span class="p">[</span><span class="nv">i</span><span class="p">])</span><span class="s"> </span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;knapsack = </span><span class="p">\(</span><span class="bp">knapsack</span><span class="p">)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>Notice that the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">var</span><span class="s"></span></code>
keyword comes before the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">set</span><span class="s"></span></code>
declaration indicating that the
set itself is the decision variable.
This contrasts with an array in which the <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="kt">var</span><span class="s"></span></code> keyword
qualifies the elements in the array rather than the array itself since the
basic structure of the array is fixed, i.e. its index set.</p>
<div class="literal-block-wrapper docutils container" id="ex-social-golfers">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.16 </span><span class="caption-text">Model for the social golfers problems (<a class="reference download internal" href="downloads/social-golfers.mzn" download=""><tt class="xref download docutils literal">social-golfers.mzn</tt></a>).</span><a class="headerlink" href="#ex-social-golfers" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="k">include</span><span class="s"> &quot;partition_set.mzn&quot;</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">weeks</span><span class="p">;</span><span class="s">    </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">WEEK</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">weeks</span><span class="p">;</span><span class="s"> </span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">groups</span><span class="p">;</span><span class="s">   </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">GROUP</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">groups</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">size</span><span class="p">;</span><span class="s">     </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">SIZE</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">size</span><span class="p">;</span><span class="s"></span>
<span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">ngolfers</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">groups</span><span class="o">*</span><span class="nv">size</span><span class="p">;</span><span class="s"> </span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">GOLFER</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">ngolfers</span><span class="p">;</span><span class="s"></span>

<span class="kt">array</span><span class="p">[</span><span class="nv">WEEK</span><span class="p">,</span><span class="nv">GROUP</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">GOLFER</span><span class="p">:</span><span class="s"> </span><span class="nv">Sched</span><span class="p">;</span><span class="s"></span>

<span class="c">% constraints</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span>
<span class="s">    </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">WEEK</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">GROUP</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">           </span><span class="nb">card</span><span class="p">(</span><span class="nv">Sched</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">size</span><span class="s"></span>
<span class="s">        </span><span class="o">/\</span><span class="s"> </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">k</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">j</span><span class="o">+</span><span class="m">1</span><span class="o">..</span><span class="nv">groups</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">                </span><span class="nv">Sched</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="o">intersect</span><span class="s"> </span><span class="nv">Sched</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">k</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{}</span><span class="s"></span>
<span class="s">           </span><span class="p">)</span><span class="s"></span>
<span class="s">    </span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">WEEK</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">          </span><span class="bp">partition_set</span><span class="p">([</span><span class="nv">Sched</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"> </span><span class="p">|</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">GROUP</span><span class="p">],</span><span class="s"> </span><span class="nv">GOLFER</span><span class="p">)</span><span class="s"></span>
<span class="s">    </span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="nv">weeks</span><span class="o">-</span><span class="m">1</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">i</span><span class="o">+</span><span class="m">1</span><span class="o">..</span><span class="nv">weeks</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">x</span><span class="p">,</span><span class="nv">y</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">GROUP</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">            </span><span class="nb">card</span><span class="p">(</span><span class="nv">Sched</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">x</span><span class="p">]</span><span class="s"> </span><span class="o">intersect</span><span class="s"> </span><span class="nv">Sched</span><span class="p">[</span><span class="nv">j</span><span class="p">,</span><span class="nv">y</span><span class="p">])</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">1</span><span class="s"></span>
<span class="s">        </span><span class="p">)</span><span class="s"></span>
<span class="s">    </span><span class="p">);</span><span class="s"></span>
<span class="c">% symmetry</span><span class="s"></span>
<span class="s">  </span><span class="k">constraint</span><span class="s"> </span>
<span class="s">    </span><span class="c">% Fix the first week %</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">GROUP</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">SIZE</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="p">((</span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">*</span><span class="nv">size</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="nv">j</span><span class="p">)</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Sched</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="nv">i</span><span class="p">]</span><span class="s"></span>
<span class="s">    </span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">    </span><span class="c">% Fix first group of second week %</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">SIZE</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="p">((</span><span class="nv">i</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">*</span><span class="nv">size</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1</span><span class="p">)</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Sched</span><span class="p">[</span><span class="m">2,1</span><span class="p">]</span><span class="s"></span>
<span class="s">    </span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">    </span><span class="c">% Fix first &#39;size&#39; players</span><span class="s"></span>
<span class="s">    </span><span class="k">forall</span><span class="s"> </span><span class="p">(</span><span class="nv">w</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="m">2</span><span class="o">..</span><span class="nv">weeks</span><span class="p">,</span><span class="s"> </span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">SIZE</span><span class="p">)</span><span class="s"> </span><span class="p">(</span><span class="s"></span>
<span class="s">        </span><span class="nv">p</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Sched</span><span class="p">[</span><span class="nv">w</span><span class="p">,</span><span class="nv">p</span><span class="p">]</span><span class="s"></span>
<span class="s">    </span><span class="p">);</span><span class="s"></span>
<span class="s">  </span>
<span class="k">solve</span><span class="s"> </span><span class="k">satisfy</span><span class="p">;</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">Sched</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">])</span><span class="s"> </span><span class="o">++</span><span class="s"> &quot; &quot; </span><span class="o">++</span><span class="s"></span>
<span class="s">         </span><span class="k">if</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">groups</span><span class="s"> </span><span class="k">then</span><span class="s"> &quot;</span><span class="se">\n</span><span class="s">&quot; </span><span class="k">else</span><span class="s"> &quot;&quot; </span><span class="k">endif</span><span class="s"> </span><span class="p">|</span><span class="s"></span>
<span class="s">         </span><span class="nv">i</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">WEEK</span><span class="p">,</span><span class="s"> </span><span class="nv">j</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">GROUP</span><span class="s"> </span><span class="p">];</span><span class="s"></span>
</pre></div>
</div>
</div>
<p>As a more complex example of set constraint consider the social golfers
problem shown in <a class="reference internal" href="#ex-social-golfers"><span class="std std-numref">Listing 2.2.16</span></a>.
The aim is to schedule a golf tournament over <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">weeks</span><span class="s"></span></code>
using <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">groups</span><span class="s"></span></code> <span class="math notranslate nohighlight">\(\times\)</span> <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">size</span><span class="s"></span></code> golfers. Each week we have to
schedule <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">groups</span><span class="s"></span></code> different groups each of size <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">size</span><span class="s"></span></code>.
No two pairs of golfers should ever play in two groups.</p>
<p>The variables in the model are sets of golfers <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">Sched</span><span class="p">[</span><span class="nv">i</span><span class="p">,</span><span class="nv">j</span><span class="p">]</span><span class="s"></span></code>
for the <span class="math notranslate nohighlight">\(i^{th}\)</span> week and <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">j</span><span class="s">^</span><span class="p">{</span><span class="nv">th</span><span class="p">}</span><span class="s"></span></code> group.</p>
<p>The constraints shown in lines 11-32
first enforces an ordering on the first
set in each week to remove symmetry in swapping weeks. Next they
enforce an ordering on the sets in each week, and make each set have a
cardinality of <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">size</span><span class="s"></span></code>.
They then ensure that each week is a partition of the set of golfers
using the global constraint
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="bp">partition_set</span><span class="s"></span></code>.
Finally the last constraint ensures that no two players play in two
groups together (since the cardinality of the intersection of any two groups
is at most 1).</p>
<p id="index-33">There are also symmetry breaking
initialisation constraints shown in lines 34-46:
the first week
is fixed to have all players in order; the second week is made up of the
first players of each of the first groups in the first week; finally the
model forces the first <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">size</span><span class="s"></span></code> players to appear in their corresponding
group number for the remaining weeks.</p>
<p>Executing the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc --solver gecode social-golfers.mzn social-golfers.dzn
</pre></div>
</div>
<p>where the data file defines a problem with 4 weeks, with 4 groups
of size 3 leads to the output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1..3 4..6 7..9 10..12
{1,4,7} {2,9,12} {3,5,10} {6,8,11}
{1,6,9} {2,8,10} {3,4,11} {5,7,12}
{1,5,8} {2,7,11} {3,6,12} {4,9,10}
----------
</pre></div>
</div>
<p>Notice hows sets which are ranges may be output in range format.</p>
</div>
<div class="section" id="putting-it-all-together">
<h2>2.2.7. Putting it all together<a class="headerlink" href="#putting-it-all-together" title="Permalink to this headline">¶</a></h2>
<p>We finish this section with a complex example illustrating most
of the features introduced in this chapter including
enumerated types, complex constraints, global constraints,
and complex output.</p>
<div class="literal-block-wrapper docutils container" id="ex-wedding">
<div class="code-block-caption"><span class="caption-number">Listing 2.2.17 </span><span class="caption-text">Planning wedding seating using enumerated types (<a class="reference download internal" href="downloads/wedding.mzn" download=""><tt class="xref download docutils literal">wedding.mzn</tt></a>).</span><a class="headerlink" href="#ex-wedding" title="Permalink to this code">¶</a></div>
<div class="highlight-minizinc notranslate"><div class="highlight"><pre><span></span><span class="kt">enum</span><span class="s"> </span><span class="nv">Guests</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="s"> </span><span class="nv">bride</span><span class="p">,</span><span class="s"> </span><span class="nv">groom</span><span class="p">,</span><span class="s"> </span><span class="nv">bestman</span><span class="p">,</span><span class="s"> </span><span class="nv">bridesmaid</span><span class="p">,</span><span class="s"> </span><span class="nv">bob</span><span class="p">,</span><span class="s"> </span><span class="nv">carol</span><span class="p">,</span><span class="s"> </span>
<span class="s">  </span><span class="nv">ted</span><span class="p">,</span><span class="s"> </span><span class="nv">alice</span><span class="p">,</span><span class="s"> </span><span class="nv">ron</span><span class="p">,</span><span class="s"> </span><span class="nv">rona</span><span class="p">,</span><span class="s"> </span><span class="nv">ed</span><span class="p">,</span><span class="s"> </span><span class="nv">clara</span><span class="p">};</span><span class="s"> </span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">Seats</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">12</span><span class="p">;</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">int</span><span class="p">:</span><span class="s"> </span><span class="nv">Hatreds</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="m">1</span><span class="o">..</span><span class="m">5</span><span class="p">;</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Hatreds</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">Guests</span><span class="p">:</span><span class="s"> </span><span class="nv">h1</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">groom</span><span class="p">,</span><span class="s"> </span><span class="nv">carol</span><span class="p">,</span><span class="s"> </span><span class="nv">ed</span><span class="p">,</span><span class="s"> </span><span class="nv">bride</span><span class="p">,</span><span class="s"> </span><span class="nv">ted</span><span class="p">];</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Hatreds</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">Guests</span><span class="p">:</span><span class="s"> </span><span class="nv">h2</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">[</span><span class="nv">clara</span><span class="p">,</span><span class="s"> </span><span class="nv">bestman</span><span class="p">,</span><span class="s"> </span><span class="nv">ted</span><span class="p">,</span><span class="s"> </span><span class="nv">alice</span><span class="p">,</span><span class="s"> </span><span class="nv">ron</span><span class="p">];</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">Guests</span><span class="p">:</span><span class="s"> </span><span class="nv">Males</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="nv">groom</span><span class="p">,</span><span class="s"> </span><span class="nv">bestman</span><span class="p">,</span><span class="s"> </span><span class="nv">bob</span><span class="p">,</span><span class="s"> </span><span class="nv">ted</span><span class="p">,</span><span class="s"> </span><span class="nv">ron</span><span class="p">,</span><span class="nv">ed</span><span class="p">};</span><span class="s"></span>
<span class="kt">set</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="nv">Guests</span><span class="p">:</span><span class="s"> </span><span class="nv">Females</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="p">{</span><span class="nv">bride</span><span class="p">,</span><span class="nv">bridesmaid</span><span class="p">,</span><span class="nv">carol</span><span class="p">,</span><span class="nv">alice</span><span class="p">,</span><span class="nv">rona</span><span class="p">,</span><span class="nv">clara</span><span class="p">};</span><span class="s"> </span>

<span class="kt">array</span><span class="p">[</span><span class="nv">Guests</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">Seats</span><span class="p">:</span><span class="s"> </span><span class="nv">pos</span><span class="p">;</span><span class="s"> </span><span class="c">% seat of guest</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Hatreds</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">Seats</span><span class="p">:</span><span class="s"> </span><span class="nv">p1</span><span class="p">;</span><span class="s">  </span><span class="c">% seat of guest 1 in hatred</span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Hatreds</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">Seats</span><span class="p">:</span><span class="s"> </span><span class="nv">p2</span><span class="p">;</span><span class="s">  </span><span class="c">% seat of guest 2 in hatred </span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Hatreds</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="m">0</span><span class="o">..</span><span class="m">1</span><span class="p">:</span><span class="s"> </span><span class="nv">sameside</span><span class="p">;</span><span class="s">  </span><span class="c">% seats of hatred on same side </span><span class="s"></span>
<span class="kt">array</span><span class="p">[</span><span class="nv">Hatreds</span><span class="p">]</span><span class="s"> </span><span class="kt">of</span><span class="s"> </span><span class="kt">var</span><span class="s"> </span><span class="nv">Seats</span><span class="p">:</span><span class="s"> </span><span class="nv">cost</span><span class="p">;</span><span class="s">  </span><span class="c">% penalty of hatred  </span><span class="s"></span>

<span class="k">include</span><span class="s"> &quot;alldifferent.mzn&quot;</span><span class="p">;</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="bp">alldifferent</span><span class="p">(</span><span class="nv">pos</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">g</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Males</span><span class="p">)(</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">g</span><span class="p">]</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">g</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Females</span><span class="p">)(</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">g</span><span class="p">]</span><span class="s"> </span><span class="o">mod</span><span class="s"> </span><span class="m">2</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="m">0</span><span class="s"> </span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="o">not</span><span class="s"> </span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">ed</span><span class="p">]</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="p">{</span><span class="m">1,6</span><span class="p">,</span><span class="m">7,12</span><span class="p">});</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="nb">abs</span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">bride</span><span class="p">]</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">groom</span><span class="p">])</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">1</span><span class="s"> </span><span class="o">/\</span><span class="s"> </span>
<span class="s">           </span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">bride</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">6</span><span class="s"> </span><span class="o">&lt;-&gt;</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">groom</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">6</span><span class="p">);</span><span class="s"></span>
<span class="k">constraint</span><span class="s"> </span><span class="k">forall</span><span class="p">(</span><span class="nv">h</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Hatreds</span><span class="p">)(</span><span class="s"></span>
<span class="s">               </span><span class="nv">p1</span><span class="p">[</span><span class="nv">h</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">h1</span><span class="p">[</span><span class="nv">h</span><span class="p">]]</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">               </span><span class="nv">p2</span><span class="p">[</span><span class="nv">h</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">pos</span><span class="p">[</span><span class="nv">h2</span><span class="p">[</span><span class="nv">h</span><span class="p">]]</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">               </span><span class="nv">sameside</span><span class="p">[</span><span class="nv">h</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nb">bool2int</span><span class="p">(</span><span class="nv">p1</span><span class="p">[</span><span class="nv">h</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">6</span><span class="s"> </span><span class="o">&lt;-&gt;</span><span class="s"> </span><span class="nv">p2</span><span class="p">[</span><span class="nv">h</span><span class="p">]</span><span class="s"> </span><span class="o">&lt;=</span><span class="s"> </span><span class="m">6</span><span class="p">)</span><span class="s"> </span><span class="o">/\</span><span class="s"></span>
<span class="s">               </span><span class="nv">cost</span><span class="p">[</span><span class="nv">h</span><span class="p">]</span><span class="s"> </span><span class="o">=</span><span class="s"> </span><span class="nv">sameside</span><span class="p">[</span><span class="nv">h</span><span class="p">]</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="nb">abs</span><span class="p">(</span><span class="nv">p1</span><span class="p">[</span><span class="nv">h</span><span class="p">]</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">p2</span><span class="p">[</span><span class="nv">h</span><span class="p">])</span><span class="s"> </span><span class="o">+</span><span class="s"></span>
<span class="s">                  </span><span class="p">(</span><span class="m">1</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">sameside</span><span class="p">[</span><span class="nv">h</span><span class="p">])</span><span class="s"> </span><span class="o">*</span><span class="s"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="m">13</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">p1</span><span class="p">[</span><span class="nv">h</span><span class="p">]</span><span class="s"> </span><span class="o">-</span><span class="s"> </span><span class="nv">p2</span><span class="p">[</span><span class="nv">h</span><span class="p">])</span><span class="s"> </span><span class="o">+</span><span class="s"> </span><span class="m">1</span><span class="p">)</span><span class="s"> </span><span class="p">);</span><span class="s"></span>

<span class="k">solve</span><span class="s"> </span><span class="k">maximize</span><span class="s"> </span><span class="nb">sum</span><span class="p">(</span><span class="nv">h</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Hatreds</span><span class="p">)(</span><span class="nv">cost</span><span class="p">[</span><span class="nv">h</span><span class="p">]);</span><span class="s"></span>

<span class="k">output</span><span class="s"> </span><span class="p">[</span><span class="s"> </span><span class="nb">show</span><span class="p">(</span><span class="nv">g</span><span class="p">)</span><span class="o">++</span><span class="s">&quot; &quot; </span><span class="p">|</span><span class="s"> </span><span class="nv">s</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Seats</span><span class="p">,</span><span class="nv">g</span><span class="s"> </span><span class="k">in</span><span class="s"> </span><span class="nv">Guests</span><span class="s"> </span><span class="k">where</span><span class="s"> </span><span class="nb">fix</span><span class="p">(</span><span class="nv">pos</span><span class="p">[</span><span class="nv">g</span><span class="p">])</span><span class="s"> </span><span class="o">==</span><span class="s"> </span><span class="nv">s</span><span class="p">]</span><span class="s"></span>
<span class="s">       </span><span class="o">++</span><span class="s"> </span><span class="p">[</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">];</span><span class="s"> </span>
</pre></div>
</div>
</div>
<p>The model of <a class="reference internal" href="#ex-wedding"><span class="std std-numref">Listing 2.2.17</span></a> arranges seats at the wedding table.
The table has 12 numbered seats in order around the table, 6 on each side.
Males must sit in odd numbered seats, and females in even.
Ed cannot sit at the end of the table because of a phobia,
and the bride and groom must
sit next to each other. The aim is to maximize the distance between known
hatreds. The distance between seats is the difference in seat number
if on the same side, otherwise its the distance to the opposite seat
+ 1.</p>
<p>Note that in the output statement we consider each seat <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">s</span><span class="s"></span></code> and search for a
guest <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nv">g</span><span class="s"></span></code> who is assigned to that seat. We make use of the built in function
<code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">fix</span><span class="s"></span></code> which checks if a decision variable is fixed and returns its
fixed value, and otherwise aborts.
This is always safe to use in output statements, since by the
time the output statement is run all decision variables should be fixed.</p>
<p>Running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ minizinc --solver gecode wedding.mzn
</pre></div>
</div>
<p>Results in the output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ted bride groom rona ed carol ron alice bob bridesmaid bestman clara
----------
==========
</pre></div>
</div>
<p>The resulting table placement is illustrated in <a class="reference internal" href="#fig-wedding"><span class="std std-numref">Fig. 2.2.2</span></a>
where the lines indicate hatreds. The total distance is 22.</p>
<div class="figure" id="id2">
<span id="fig-wedding"></span><img alt="images/wedding.svg" src="images/wedding.svg" /><p class="caption"><span class="caption-number">Fig. 2.2.2 </span><span class="caption-text">Seating arrangement at the wedding table</span></p>
</div>
<div class="admonition-fix admonition" id="defblock-12">
<p class="first admonition-title">Fix</p>
<p class="last" id="index-34">In output items the built-in function <code class="code mzn minizinc docutils literal highlight highlight-minizinc"><span></span><span class="nb">fix</span><span class="s"></span></code> checks that
the value of a decision variable is fixed
and coerces the instantiation from
decision variable to parameter.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="predicates.html" class="btn btn-neutral float-right" title="2.3. Predicates and Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="modelling.html" class="btn btn-neutral" title="2.1. Basic Modelling in MiniZinc" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, 2017, 2018, 2019, 2020 Peter J. Stuckey, Kim Marriott, Guido Tack.

    </p>
  </div>
<a rel="license" href="http://creativecommons.org/licenses/by-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nd/4.0/80x15.png" /></a>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.5.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="static/jquery.js"></script>
      <script type="text/javascript" src="static/underscore.js"></script>
      <script type="text/javascript" src="static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>